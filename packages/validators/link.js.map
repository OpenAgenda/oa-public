{"version":3,"file":"link.js","names":["_isString","_interopRequireDefault","require","_listify","_email","_params","validateEmail","emailValidator","isEmail","v","e","_default","config","params","cleanParams","error","code","message","shouldntMatch","validate","value","templateError","field","clean","_objectSpread2","default","origin","isString","_trim","call","replace","match","toLowerCase","length","Object","optional","undefined","test","startsWithProtocol","concat","indexOf","substr","forEach","rgx","urlToTest","startsWith","url","_url","type","list","listify","exports","module"],"sources":["src/link.js"],"sourcesContent":["import isString from 'lodash/isString';\nimport listify from './listify';\nimport emailValidator from './email';\nimport cleanParams from './lib/params';\n\nconst validateEmail = emailValidator();\n\nconst isEmail = (v) => {\n  try {\n    validateEmail(v);\n  } catch (e) {\n    return false;\n  }\n\n  return true;\n};\n\nexport default (config) => {\n  const params = cleanParams('link', config, {\n    error: {\n      code: 'link.invalid',\n      message: 'value is not a link',\n    },\n  });\n\n  const shouldntMatch = [/\\s/, /\\/:/, /;/];\n\n  const validate = (value) => {\n    const templateError = {\n      field: params.field,\n      code: 'link.invalid',\n      message: 'value is not a link',\n    };\n\n    let clean = value;\n\n    const error = [{\n      origin: value,\n      ...templateError,\n    }];\n\n    if (isString(value)) {\n      clean = value.trim();\n      // Normalize protocol to lowercase\n      clean = clean.replace(/^(HTTP|HTTPS):/i, (match) => match.toLowerCase());\n    }\n\n    if ((!value || !value.length) && !(value instanceof Object) && params.optional) {\n      return params.default !== undefined ? params.default : clean;\n    }\n\n    if (/^mailto:/.test(clean) && isEmail(clean.replace(/^mailto:/, ''))) {\n      return clean;\n    }\n\n    const startsWithProtocol = /^((http(s|):|)\\/\\/|mailto:)/.test(clean);\n\n    if (!startsWithProtocol && isEmail(clean)) throw error;\n\n    // add http:// if link is like www.google.com (protocol missing)\n    if (!startsWithProtocol) {\n      clean = `http://${clean}`;\n    }\n\n    if (clean.indexOf('.') === -1) {\n      throw error;\n    }\n\n    if (clean.substr(clean.length - 1, 1) === '.') {\n      throw error;\n    }\n\n    shouldntMatch.forEach((rgx) => {\n      if (rgx.test(clean)) {\n        throw error;\n      }\n    });\n\n    // Use native URL constructor for validation\n    try {\n      // Handle protocol-relative URLs by adding a temporary protocol\n      const urlToTest = clean.startsWith('//') ? `http:${clean}` : clean;\n      // eslint-disable-next-line no-unused-vars\n      const url = new URL(urlToTest);\n    } catch (e) {\n      throw error;\n    }\n\n    return clean;\n  };\n\n  validate.type = 'link';\n  validate.field = params.field;\n\n  return params.list ? listify(validate, params) : validate;\n};\n"],"mappings":"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","ignoreList":[]}