{"version":3,"file":"listify.js","names":["isNothing","validator","v","_context","_context2","_includes","default","call","type","undefined","_default","options","params","_objectSpread2","min","max","optional","list","Object","assign","clean","errors","value","Array","isArray","forEach","item","i","push","errs","concat","map","e","index","length","field","code","message","origin","exports","module"],"sources":["src/listify.js"],"sourcesContent":["/**\n * makes validator process lists\n */\n\nfunction isNothing(validator, v) {\n  if (['integer', 'number'].includes(validator.type) && v === '') {\n    return true;\n  }\n  return [undefined, null].includes(v);\n}\n\nexport default (validator, options) => {\n  const params = {\n    min: null,\n    max: null,\n    optional: options.optional === undefined ? true : !!options.optional,\n    ...options.list\n  };\n\n  return Object.assign(v => {\n    const clean = [];\n    let errors = [];\n\n    let value = isNothing(validator, v) ? [] : v;\n\n    if (params.default !== undefined) {\n      if (v === params.default) {\n        return params.default;\n      }\n      if (v === undefined) {\n        return params.default;\n      }\n    }\n\n    if (!Array.isArray(value)) {\n      value = [value];\n    }\n\n    value.forEach((item, i) => {\n      try {\n        clean.push(validator(item));\n      } catch (errs) {\n        errors = errors.concat(errs.map(e => ({\n          ...e,\n          index: i\n        })));\n      }\n    });\n\n    if (!params.optional && value.length === 0) {\n      errors.push({\n        field: validator.field,\n        code: 'list.required',\n        message: 'list cannot be empty',\n        origin: value\n      });\n    } else if (\n      (!params.optional || value.length > 0)\n      && params.min !== null\n      && value.length < params.min\n    ) {\n      errors.push({\n        field: validator.field,\n        code: 'list.tooshort',\n        message: 'list is too short',\n        origin: value\n      });\n    }\n\n    if (params.max !== null && value.length > params.max) {\n      errors.push({\n        field: validator.field,\n        code: 'list.toolong',\n        message: 'list is too long',\n        origin: value\n      });\n    }\n\n    if (errors.length) throw errors;\n\n    return clean;\n  }, {\n    type: validator.type,\n    field: validator.field\n  });\n};\n"],"mappings":"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","ignoreList":[]}