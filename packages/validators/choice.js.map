{"version":3,"file":"choice.js","names":["_params","_interopRequireDefault","require","_errors","preClean","params","value","optionsAreIntegers","options","filter","o","Number","isInteger","length","concat","map","v","valuePart","Object","key","indexOf","parseInt","matchingIndex","validator","config","arguments","undefined","cleanParams","field","optional","min","max","unique","assign","clean","default","errors","allowNull","values","type","_default","exports","module"],"sources":["src/choice.js"],"sourcesContent":["import cleanParams from './lib/params';\nimport errors from './lib/errors';\n\nfunction preClean(params, value) {\n  const optionsAreIntegers = params.options.filter(o => Number.isInteger(o)).length === params.options.length;\n\n  return [].concat(value)\n    .map(v => {\n      const valuePart = v instanceof Object ? v[params.key] : v;\n\n      return params.options.indexOf(optionsAreIntegers ? parseInt(valuePart, 10) : valuePart);\n    })\n    .filter(matchingIndex => matchingIndex !== -1)\n    .map(matchingIndex => params.options[matchingIndex]);\n}\n\nconst validator = (config = {}) => {\n  const params = cleanParams('choice', config, {\n    field: false,\n    options: [], // required. Put something\n    key: 'value', // optional. For when labeled objects are given\n    optional: true,\n    min: null,\n    max: null,\n    unique: false,\n  });\n\n  return Object.assign(value => {\n    const clean = preClean(params, value);\n\n    if ((value === undefined) && (params.default !== undefined)) {\n      return params.unique ? params.default : [].concat(params.default);\n    }\n\n    if (!params.optional && !clean.length) {\n      throw errors(params, value, 'choice.required', 'a (known) value must be chosen');\n    }\n\n    if (params.unique && params.optional && value === undefined) {\n      return params.default;\n    }\n\n    if (params.unique && params.optional && value === null && params.allowNull) {\n      return null;\n    }\n\n    if (params.unique) {\n      return clean.length >= 1 ? clean[0] : params.default;\n    }\n\n    if (params.min && clean.length < params.min) {\n      throw errors(params, value, 'choice.required.min', 'between %min% and %max% choices must be made', {\n        values: {\n          min: params.min,\n          max: params.max,\n        },\n      });\n    }\n\n    if (params.max && clean.length > params.max) {\n      throw errors(params, value, 'choice.required.max', 'between %min% and %max% choices must be made', {\n        values: {\n          max: params.max,\n          min: params.min,\n        },\n      });\n    }\n\n    return clean;\n  }, {\n    type: 'choice',\n    field: params.field,\n  });\n};\n\nexport default Object.assign(validator, {\n  preClean,\n});\n"],"mappings":"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","ignoreList":[]}