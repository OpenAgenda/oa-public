{"version":3,"file":"multilingual.js","names":["_text","_interopRequireDefault","require","_params","_errors","DEFAULT_LANGUAGE","_default","exports","default","config","arguments","length","undefined","params","cleanParams","field","defaultLanguage","forceCodesToLowerCase","languages","Object","assign","origin","clean","errors","value","_context","_reduce","call","c","l","_objectSpread2","Array","isArray","forEach","optional","keys","formatErrors","langValue","defaultValue","validateText","text","toLowerCase","lErrors","e","push","lang","type","module"],"sources":["src/multilingual.js"],"sourcesContent":["import text from './text';\nimport cleanParams from './lib/params';\nimport formatErrors from './lib/errors';\n\nconst DEFAULT_LANGUAGE = 'en';\n\nexport default (config = {}) => {\n  const params = cleanParams('multilingual', config, {\n    field: false,\n    defaultLanguage: null,\n    forceCodesToLowerCase: true,\n    languages: [],\n  });\n\n  return Object.assign((origin) => {\n    const clean = {};\n    const errors = [];\n    const value = {};\n\n    // if is provided with string, validator distributes value\n    // to all languages\n    if ((typeof origin === 'string') && params.languages.length) {\n      Object.assign(value, params.languages.reduce((c, l) => ({\n        ...c,\n        [l]: origin,\n      }), {}));\n    } else if (typeof origin === 'string') {\n      Object.assign(value, {\n        [params.defaultLanguage || DEFAULT_LANGUAGE]: origin,\n      });\n    } else {\n      Object.assign(value, origin || {});\n    }\n\n    // if languages have been pre-specified, they should be\n    // part of validation and sanitizing\n    if (Array.isArray(params.languages)) {\n      params.languages.forEach((l) => {\n        value[l] = value[l] === undefined ? '' : value[l];\n      });\n    }\n\n    if (!params.optional && !Object.keys(value).length) {\n      throw formatErrors(\n        params,\n        undefined,\n        'required',\n        'at least one language entry is required',\n      );\n    }\n\n    if (!Object.keys(value).length && (params.default !== undefined)) {\n      return params.default;\n    }\n\n    Object.keys(value).forEach((l) => {\n      const langValue = value[l];\n      if (params.optional && (langValue === undefined || langValue === null)) {\n        return;\n      }\n\n      try {\n        const defaultValue = typeof params.default === 'string' ? params.default : (params?.default || {})[l];\n\n        const validateText = text({\n          ...params,\n          default: defaultValue || null,\n        });\n\n        clean[params.forceCodesToLowerCase ? l.toLowerCase() : l] = validateText(langValue);\n      } catch (lErrors) {\n        lErrors.forEach((e) => {\n          errors.push({ ...e, lang: l });\n        });\n      }\n    });\n\n    if (errors.length) {\n      throw errors;\n    }\n\n    return clean;\n  }, {\n    type: 'multilingual',\n    field: params.field,\n  });\n};\n"],"mappings":"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","ignoreList":[]}