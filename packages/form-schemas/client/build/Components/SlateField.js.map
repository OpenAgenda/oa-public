{"version":3,"file":"SlateField.js","names":["Component","createEditor","Transforms","Editor","Node","ReactEditor","Slate","Editable","withReact","withHistory","HistoryEditor","classNames","richTextLabels","formSchemaLabels","makeLabelGetter","flatten","nl2br","bodyScroll","flattenFieldLabels","FieldCounter","Info","Sub","jsxDEV","_jsxDEV","Fragment","_Fragment","getLabel","DEFAULT_VALUE","type","children","text","DEFAULT_NODE_TYPE","SHORTCUTS","label","keys","method","withInlines","editor","isInline","normalizeNode","element","entry","node","path","isEmpty","unwrapNodes","at","SlateField","constructor","props","_defineProperty","newValue","onChange","raw","changed","alreadyChanged","value","oldValue","state","JSON","stringify","setState","e","ctrlKey","match","find","s","_context","_includesInstanceProperty","_keysInstanceProperty","call","key","preventDefault","fullscreen","disable","enable","_ref","attributes","_objectSpread","fileName","_jsxFileName","lineNumber","columnNumber","href","url","_ref2","leaf","child","bold","italic","mark","isActive","isMarkActive","removeMark","addMark","nodes","n","universal","isBlockActive","isList","toggleLink","split","setNodes","wrapNodes","isLink","window","prompt","selection","linkNode","string","insertNodes","undo","length","_SHORTCUTS$find","isListItem","title","className","onMouseDown","toggleBlock","onClick","setFullscreen","_SHORTCUTS$find2","toggleMark","concat","field","fieldFromProps","lang","htmlFor","info","parentValue","error","max","sub","initialValue","parse","Array","isArray","document","render","placeholder","labels","renderFullscreenTop","renderBlockButton","heading","subHeading","renderMarkButton","renderFullscreenButton","onKeyDown","focus","spellCheck","renderElement","renderLeaf","renderFullscreenBottom"],"sources":["../../src/Components/SlateField.js"],"sourcesContent":["// import _ from 'lodash';\n\n// import debug from 'debug';\nimport { Component } from 'react';\nimport { createEditor, Transforms, Editor, Node } from 'slate';\nimport { ReactEditor, Slate, Editable, withReact } from 'slate-react';\nimport { withHistory, HistoryEditor } from 'slate-history';\nimport classNames from 'classnames';\n\nimport richTextLabels from '@openagenda/labels/form-schemas/richText.js';\nimport formSchemaLabels from '@openagenda/labels/form-schemas/index.js';\nimport makeLabelGetter from '@openagenda/labels';\nimport flatten from '@openagenda/labels/flatten.js';\nimport { nl2br, bodyScroll } from '@openagenda/react-shared';\n\nimport flattenFieldLabels from '../lib/flatten.js';\nimport FieldCounter from './FieldCounter.js';\nimport Info from './Info.js';\nimport Sub from './Sub.js';\n\nconst getLabel = makeLabelGetter(formSchemaLabels);\n\n// const log = debug('SlateField');\n\nconst DEFAULT_VALUE = [\n  {\n    type: 'paragraph',\n    children: [{ text: '' }],\n  },\n];\n\nconst DEFAULT_NODE_TYPE = 'paragraph';\n\nconst SHORTCUTS = [\n  {\n    type: 'undo',\n    label: 'ctrl+z',\n    keys: ['z'],\n    method: 'undo',\n  },\n  {\n    type: 'redo',\n    label: 'ctrl+y',\n    keys: ['y'],\n    method: 'redo',\n  },\n  {\n    type: 'heading-two',\n    label: 'ctrl+1',\n    keys: ['1', '&'],\n    method: 'toggleBlock',\n  },\n  {\n    type: 'heading-three',\n    label: 'ctrl+2',\n    keys: ['2', 'é'],\n    method: 'toggleBlock',\n  },\n  {\n    type: 'bold',\n    label: 'ctrl+b',\n    keys: ['b'],\n    method: 'toggleMark',\n  },\n  {\n    type: 'italic',\n    label: 'ctrl+i',\n    keys: ['i'],\n    method: 'toggleMark',\n  },\n  {\n    type: 'link',\n    label: 'ctrl+k',\n    keys: ['k'],\n    method: 'toggleBlock',\n  },\n  {\n    type: 'bulleted-list',\n    label: 'ctrl+l',\n    keys: ['l'],\n    method: 'toggleBlock',\n  },\n];\n\nfunction withInlines(editor) {\n  const { isInline, normalizeNode } = editor;\n  editor.isInline = (element) =>\n    (element.type === 'link' ? true : isInline(element));\n\n  editor.normalizeNode = (entry) => {\n    const [node, path] = entry;\n\n    if (node.type === 'link' && Editor.isEmpty(editor, node)) {\n      Transforms.unwrapNodes(editor, { at: path });\n      return;\n    }\n\n    normalizeNode(entry);\n  };\n  return editor;\n}\n\nexport default class SlateField extends Component {\n  constructor(props) {\n    super(props);\n\n    this.editor = withInlines(withReact(withHistory(createEditor())));\n\n    const { value } = this.props;\n\n    let initialValue;\n\n    if (!value) {\n      initialValue = DEFAULT_VALUE;\n    } else if (typeof value === 'string') {\n      try {\n        initialValue = JSON.parse(value);\n      } catch (e) {\n        initialValue = DEFAULT_VALUE;\n      }\n    } else if (Array.isArray(value)) {\n      initialValue = value;\n    } else {\n      initialValue = value.document\n        ? value.document.nodes || DEFAULT_VALUE\n        : DEFAULT_VALUE;\n    }\n\n    this.state = {\n      value: initialValue,\n      changed: false,\n      fullscreen: false, // Pour la gestion de l’écran plein\n    };\n  }\n\n  onChange = (newValue) => {\n    const { onChange, raw } = this.props;\n    const { changed: alreadyChanged, value: oldValue } = this.state;\n\n    const changed = alreadyChanged || JSON.stringify(newValue) !== JSON.stringify(oldValue);\n\n    this.setState({ value: newValue, changed });\n\n    if (!changed) return;\n\n    onChange(raw ? newValue : newValue);\n  };\n\n  onKeyDown = (e) => {\n    if (!e.ctrlKey) {\n      return;\n    }\n\n    const match = SHORTCUTS.find((s) => s.keys.includes(e.key));\n\n    if (!match) {\n      return;\n    }\n\n    e.preventDefault();\n\n    this[match.method](match.type);\n  };\n\n  setFullscreen = (fullscreen) => {\n    if (fullscreen) {\n      bodyScroll.disable();\n    } else {\n      bodyScroll.enable();\n    }\n\n    this.setState({\n      fullscreen,\n    });\n  };\n\n  // eslint-disable-next-line class-methods-use-this\n  renderElement = ({ attributes, children, element }) => {\n    switch (element.type) {\n      case 'heading-two':\n        return <h2 {...attributes}>{children}</h2>;\n      case 'heading-three':\n        return <h3 {...attributes}>{children}</h3>;\n      case 'bulleted-list':\n        return <ul {...attributes}>{children}</ul>;\n      case 'list-item':\n        return <li {...attributes}>{children}</li>;\n      case 'link':\n        return (\n          <a {...attributes} href={element.url}>\n            {children}\n          </a>\n        );\n      default:\n        return <p {...attributes}>{children}</p>;\n    }\n  };\n\n  // eslint-disable-next-line class-methods-use-this\n  renderLeaf = ({ attributes, children, leaf }) => {\n    let child = children;\n    if (leaf.bold) {\n      child = <strong>{child}</strong>;\n    }\n    if (leaf.italic) {\n      child = <em>{child}</em>;\n    }\n    return <span {...attributes}>{child}</span>;\n  };\n\n  toggleMark = (mark) => {\n    const isActive = this.isMarkActive(mark);\n\n    if (isActive) {\n      Editor.removeMark(this.editor, mark);\n    } else {\n      Editor.addMark(this.editor, mark, true);\n    }\n  };\n\n  isMarkActive = (mark) => {\n    const [match] = Editor.nodes(this.editor, {\n      match: (n) => n[mark] === true,\n      universal: true,\n    });\n    return !!match;\n  };\n\n  toggleBlock = (type) => {\n    const isActive = this.isBlockActive(type);\n    const isList = this.isBlockActive('list-item');\n\n    if (type === 'link') {\n      // On gère les liens de façon particulière\n      this.toggleLink();\n    } else if (type === 'bulleted-list') {\n      // Gestion d'une liste non ordonnée\n      if (isList) {\n        // On unwrap la liste si elle est déjà active\n        Transforms.unwrapNodes(this.editor, {\n          match: (n) => n.type === 'bulleted-list',\n          split: true,\n        });\n        // On repasse en type paragraph\n        Transforms.setNodes(this.editor, { type: DEFAULT_NODE_TYPE });\n      } else {\n        // On set le bloc courant en list-item\n        Transforms.setNodes(this.editor, { type: 'list-item' });\n        // On wrap le tout dans 'bulleted-list'\n        Transforms.wrapNodes(this.editor, {\n          type: 'bulleted-list',\n          children: [],\n        });\n      }\n    } else {\n      // Pour un heading-two, heading-three, etc.\n      Transforms.setNodes(this.editor, {\n        type: isActive ? DEFAULT_NODE_TYPE : type,\n      });\n    }\n  };\n\n  isBlockActive = (type) => {\n    const [match] = Editor.nodes(this.editor, {\n      match: (n) => n.type === type,\n    });\n    return !!match;\n  };\n\n  toggleLink = () => {\n    const isLink = this.isBlockActive('link');\n\n    if (isLink) {\n      Transforms.unwrapNodes(this.editor, { match: (n) => n.type === 'link' });\n    } else {\n      const url = window.prompt('Enter the URL of the link:');\n      if (!url) return;\n\n      const { selection } = this.editor;\n\n      const linkNode = {\n        type: 'link',\n        url,\n        children: [],\n      };\n\n      if (selection && Editor.string(this.editor, selection) === '') {\n        Transforms.insertNodes(this.editor, {\n          type: 'link',\n          url,\n          children: [{ text: url }],\n        });\n      } else {\n        Transforms.wrapNodes(this.editor, linkNode, { split: true });\n      }\n    }\n  };\n\n  // eslint-disable-next-line react/no-unused-class-component-methods\n  undo = () => {\n    HistoryEditor.undo(this.editor);\n  };\n\n  // eslint-disable-next-line react/no-unused-class-component-methods\n  redo = () => {\n    HistoryEditor.undo(this.editor);\n  };\n\n  isEmpty = () => {\n    const { value } = this.state;\n    if (!value || value.length === 0) return true;\n\n    if (value.length === 1 && Node.string(value[0]) === '') {\n      return true;\n    }\n\n    return false;\n  };\n\n  renderBlockButton = (type, label) => {\n    let isActive = this.isBlockActive(type);\n\n    if (type === 'bulleted-list') {\n      const isListItem = this.isBlockActive('list-item');\n      isActive = isListItem && isActive;\n    }\n\n    return (\n      <button\n        type=\"button\"\n        title={SHORTCUTS.find((s) => s.type === type)?.label}\n        className={classNames('btn', {\n          'btn-default': !isActive,\n          'btn-primary': isActive,\n        })}\n        onMouseDown={(e) => {\n          e.preventDefault();\n          this.toggleBlock(type);\n        }}\n      >\n        {label}\n      </button>\n    );\n  };\n\n  renderFullscreenButton = () => {\n    const { fullscreen = false } = this.state;\n\n    return (\n      <button\n        type=\"button\"\n        className=\"btn btn-default pull-right\"\n        onClick={() => this.setFullscreen(!fullscreen)}\n        aria-label={getLabel('fullscreen')}\n      >\n        <i\n          className={classNames('fa', {\n            'fa-maximize': !fullscreen,\n            'fa-minimize': fullscreen,\n          })}\n        />\n      </button>\n    );\n  };\n\n  renderMarkButton = (type) => {\n    const isActive = this.isMarkActive(type);\n    const label = SHORTCUTS.find((s) => s.type === type)?.label;\n\n    return (\n      <button\n        type=\"button\"\n        aria-label={label}\n        title={label}\n        className={classNames('btn', {\n          'btn-default': !isActive,\n          'btn-primary': isActive,\n        })}\n        onMouseDown={(e) => {\n          e.preventDefault();\n          this.toggleMark(type);\n        }}\n      >\n        <i className={`fa fa-${type}`} />\n      </button>\n    );\n  };\n\n  renderFullscreenTop = () => {\n    const { field: fieldFromProps, lang } = this.props;\n\n    const field = flattenFieldLabels(fieldFromProps, lang);\n\n    return (\n      <>\n        <label htmlFor={field.field} className=\"control-label\">\n          {field.label}\n        </label>\n        {field.info ? <Info value={field.info} /> : null}\n      </>\n    );\n  };\n\n  renderFullscreenBottom = () => {\n    const { field: fieldFromProps, lang, parentValue, error } = this.props;\n\n    const field = flattenFieldLabels(fieldFromProps, lang);\n\n    return (\n      <>\n        {field.max ? (\n          <FieldCounter value={parentValue} max={field.max} />\n        ) : null}\n        {field.sub || field.error ? (\n          <Sub label={field.sub} error={error} />\n        ) : null}\n      </>\n    );\n  };\n\n  render() {\n    const { value, fullscreen } = this.state;\n\n    const { lang, field } = this.props;\n\n    const { placeholder } = field;\n\n    const labels = flatten(richTextLabels, lang, true);\n\n    return (\n      <div\n        className={classNames('rich-textarea margin-top-xs', {\n          fullscreen,\n        })}\n      >\n        {fullscreen ? this.renderFullscreenTop() : null}\n        <div className=\"toolbar\">\n          {this.renderBlockButton('heading-two', labels.heading)}\n          {this.renderBlockButton('heading-three', labels.subHeading)}\n          {this.renderMarkButton('bold')}\n          {this.renderMarkButton('italic')}\n          {this.renderBlockButton(\n            'bulleted-list',\n            <i className=\"fa fa-list\" />,\n          )}\n          {this.renderBlockButton('link', <i className=\"fa fa-link\" />)}\n          {this.renderFullscreenButton()}\n        </div>\n        <div className=\"textarea-canvas\">\n          {this.isEmpty() && placeholder ? (\n            <button\n              type=\"button\"\n              onKeyDown={() => ReactEditor.focus(this.editor)}\n              onClick={() => ReactEditor.focus(this.editor)}\n              className=\"textarea-placeholder\"\n            >\n              {nl2br(placeholder)}\n            </button>\n          ) : null}\n          <Slate\n            editor={this.editor}\n            initialValue={value}\n            onChange={this.onChange}\n          >\n            <Editable\n              spellCheck={false}\n              renderElement={this.renderElement}\n              renderLeaf={this.renderLeaf}\n              onKeyDown={this.onKeyDown}\n              // placeholder={placeholder} // Slate gère aussi un placeholder natif si besoin\n            />\n          </Slate>\n        </div>\n        {fullscreen ? this.renderFullscreenBottom() : null}\n      </div>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}