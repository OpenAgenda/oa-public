{"version":3,"file":"HTMLSerializer.js","names":["MARK_TAGS","strong","em","u","s","code","BLOCK_TAGS","p","li","ul","ol","blockquote","pre","h1","h2","h3","h4","h5","h6","escapeHtml","str","replace","applyMarkToDescendants","node","markType","text","undefined","_objectSpread","children","Array","isArray","map","child","serializeNode","bold","concat","italic","underline","childrenHtml","join","type","url","deserializeElements","domNodes","array","forEach","domNode","nodeType","nodeValue","_trimInstanceProperty","call","push","tag","nodeName","toLowerCase","from","childNodes","blockType","length","href","getAttribute","deserialize","html","parser","DOMParser","doc","parseFromString","nodes","body","serialize"],"sources":["../../src/Components/HTMLSerializer.js"],"sourcesContent":["const MARK_TAGS = {\n  strong: 'bold',\n  em: 'italic',\n  u: 'underline',\n  s: 'strikethrough',\n  code: 'code',\n};\n\nconst BLOCK_TAGS = {\n  p: 'paragraph',\n  li: 'list-item',\n  ul: 'bulleted-list',\n  ol: 'numbered-list',\n  blockquote: 'quote',\n  pre: 'code-block',\n  h1: 'heading-one',\n  h2: 'heading-two',\n  h3: 'heading-three',\n  h4: 'heading-four',\n  h5: 'heading-five',\n  h6: 'heading-six',\n};\n\nfunction escapeHtml(str) {\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n\nfunction applyMarkToDescendants(node, markType) {\n  if (node.text !== undefined) {\n    return { ...node, [markType]: true };\n  }\n  if (node.children && Array.isArray(node.children)) {\n    return {\n      ...node,\n      children: node.children.map((child) =>\n        applyMarkToDescendants(child, markType)),\n    };\n  }\n  return node;\n}\n\nfunction serializeNode(node) {\n  if (node.text !== undefined) {\n    let text = escapeHtml(node.text);\n\n    if (node.bold) {\n      text = `<strong>${text}</strong>`;\n    }\n    if (node.italic) {\n      text = `<em>${text}</em>`;\n    }\n    if (node.underline) {\n      text = `<u>${text}</u>`;\n    }\n\n    return text;\n  }\n\n  const childrenHtml = (node.children || []).map(serializeNode).join('');\n\n  switch (node.type) {\n    case 'paragraph':\n      return `<p>${childrenHtml}</p>`;\n    case 'heading-one':\n      return `<h1>${childrenHtml}</h1>`;\n    case 'heading-two':\n      return `<h2>${childrenHtml}</h2>`;\n    case 'heading-three':\n      return `<h3>${childrenHtml}</h3>`;\n    case 'bulleted-list':\n      return `<ul>${childrenHtml}</ul>`;\n    case 'numbered-list':\n      return `<ol>${childrenHtml}</ol>`;\n    case 'list-item':\n      return `<li>${childrenHtml}</li>`;\n    case 'quote':\n      return `<blockquote>${childrenHtml}</blockquote>`;\n    case 'code-block':\n      return `<pre><code>${childrenHtml}</code></pre>`;\n    case 'link': {\n      const url = node.url || '#';\n      return `<a href=\"${escapeHtml(url)}\">${childrenHtml}</a>`;\n    }\n    default:\n      return childrenHtml;\n  }\n}\n\nfunction deserializeElements(domNodes) {\n  const array = [];\n\n  domNodes.forEach((domNode) => {\n    // TEXT_NODE\n    if (domNode.nodeType === 3) {\n      const text = domNode.nodeValue;\n      if (!text.trim() && text !== ' ') {\n        return;\n      }\n\n      array.push({ text });\n      return;\n    }\n\n    // ELEMENT_NODE\n    if (domNode.nodeType === 1) {\n      const tag = domNode.nodeName.toLowerCase();\n\n      // MARKS: <strong>, <em>, etc.\n      if (MARK_TAGS[tag]) {\n        const markType = MARK_TAGS[tag];\n        const children = deserializeElements(\n          Array.from(domNode.childNodes),\n        ).map((child) => {\n          if (child.text !== undefined) {\n            return { ...child, [markType]: true };\n          }\n          return applyMarkToDescendants(child, markType);\n        });\n        array.push(...children);\n        return;\n      }\n\n      // BLOCKS: <p>, <h1>, <ul>, <li>, ...\n      if (BLOCK_TAGS[tag]) {\n        const blockType = BLOCK_TAGS[tag];\n        const children = deserializeElements(Array.from(domNode.childNodes));\n\n        if (children.length === 0) {\n          children.push({ text: '' });\n        }\n\n        array.push({\n          type: blockType,\n          children,\n        });\n        return;\n      }\n\n      // LINK / Inline <a> ?\n      if (tag === 'a') {\n        const href = domNode.getAttribute('href') || '';\n        const children = deserializeElements(Array.from(domNode.childNodes));\n\n        if (children.length === 0) {\n          children.push({ text: href });\n        }\n\n        array.push({\n          type: 'link',\n          url: href,\n          children,\n        });\n        return;\n      }\n\n      const children = deserializeElements(Array.from(domNode.childNodes));\n\n      if (children.length) {\n        array.push(...children);\n      }\n    }\n  });\n\n  return array;\n}\n\nfunction deserialize(html) {\n  if (!html || typeof html !== 'string') {\n    return [\n      {\n        type: 'paragraph',\n        children: [{ text: '' }],\n      },\n    ];\n  }\n\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(html, 'text/html');\n\n  const nodes = deserializeElements(Array.from(doc.body.childNodes));\n\n  return nodes.length > 0\n    ? nodes\n    : [\n      {\n        type: 'paragraph',\n        children: [{ text: '' }],\n      },\n    ];\n}\n\nfunction serialize(nodes) {\n  if (!Array.isArray(nodes)) {\n    return '';\n  }\n  return nodes.map((node) => serializeNode(node)).join('');\n}\n\nexport default {\n  serialize,\n  deserialize,\n};\n"],"mappings":"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","ignoreList":[]}