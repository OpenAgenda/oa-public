{"version":3,"file":"getSchemaArgs.js","names":["schema","getValidatorFromField","isObject","fields","_context","accessType","arguments","length","undefined","al","options","params","_objectSpread","includeUnspecified","custom","draft","register","accessLevel","concat","_reduceInstanceProperty","filter","f","_get","t","_includesInstanceProperty","call","type","fieldType","map","validatorConfiguration","schemaConfiguration","_set","field"],"sources":["../../src/iso/getSchemaArgs.js"],"sourcesContent":["import _ from 'lodash';\nimport schema from '@openagenda/validators/schema/index.js';\nimport getValidatorFromField from './getValidatorFromField.js';\nimport isObject from './isObject.js';\n\nexport default (fields, accessType = null, al = null, options = {}) => {\n  const params = {\n    includeUnspecified: true,\n    custom: {},\n    draft: false,\n    ...options,\n  };\n\n  if (isObject(params.custom)) {\n    schema.register(params.custom);\n  }\n\n  const accessLevel = al === null ? [] : [].concat(al);\n\n  return fields\n    .filter((f) => {\n      if (accessType === null) return true;\n\n      if (f[accessType] === null && params.includeUnspecified) return true;\n\n      return !!(_.get(f, accessType, []) || []).filter((t) =>\n        accessLevel.includes(t)).length;\n    })\n    .filter((f) => {\n      if (f.type && f.type !== 'field') {\n        return false;\n      }\n      return f.fieldType !== 'abstract';\n    })\n    .map((f) => {\n      const validatorConfiguration = getValidatorFromField(f, params);\n      return validatorConfiguration;\n    })\n    .reduce(\n      (schemaConfiguration, f) => _.set(schemaConfiguration, f.field, f),\n      {},\n    );\n};\n"],"mappings":";;;;;AACA,OAAOA,MAAM,MAAM,wCAAwC;AAC3D,OAAOC,qBAAqB,MAAM,4BAA4B;AAC9D,OAAOC,QAAQ,MAAM,eAAe;AAEpC,gBAAe,UAACC,MAAM,EAAiD;EAAA,IAAAC,QAAA;EAAA,IAA/CC,UAAU,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EAAA,IAAEG,EAAE,GAAAH,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EAAA,IAAEI,OAAO,GAAAJ,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EAChE,MAAMK,MAAM,GAAAC,aAAA;IACVC,kBAAkB,EAAE,IAAI;IACxBC,MAAM,EAAE,CAAC,CAAC;IACVC,KAAK,EAAE;EAAK,GACTL,OAAO,CACX;EAED,IAAIR,QAAQ,CAACS,MAAM,CAACG,MAAM,CAAC,EAAE;IAC3Bd,MAAM,CAACgB,QAAQ,CAACL,MAAM,CAACG,MAAM,CAAC;EAChC;EAEA,MAAMG,WAAW,GAAGR,EAAE,KAAK,IAAI,GAAG,EAAE,GAAG,EAAE,CAACS,MAAM,CAACT,EAAE,CAAC;EAEpD,OAAOU,uBAAA,CAAAf,QAAA,GAAAD,MAAM,CACViB,MAAM,CAAEC,CAAC,IAAK;IACb,IAAIhB,UAAU,KAAK,IAAI,EAAE,OAAO,IAAI;IAEpC,IAAIgB,CAAC,CAAChB,UAAU,CAAC,KAAK,IAAI,IAAIM,MAAM,CAACE,kBAAkB,EAAE,OAAO,IAAI;IAEpE,OAAO,CAAC,CAAC,CAACS,IAAA,CAAMD,CAAC,EAAEhB,UAAU,EAAE,EAAE,CAAC,IAAI,EAAE,EAAEe,MAAM,CAAEG,CAAC,IACjDC,yBAAA,CAAAP,WAAW,EAAAQ,IAAA,CAAXR,WAAW,EAAUM,CAAC,CAAC,CAAC,CAAChB,MAAM;EACnC,CAAC,CAAC,CACDa,MAAM,CAAEC,CAAC,IAAK;IACb,IAAIA,CAAC,CAACK,IAAI,IAAIL,CAAC,CAACK,IAAI,KAAK,OAAO,EAAE;MAChC,OAAO,KAAK;IACd;IACA,OAAOL,CAAC,CAACM,SAAS,KAAK,UAAU;EACnC,CAAC,CAAC,CACDC,GAAG,CAAEP,CAAC,IAAK;IACV,MAAMQ,sBAAsB,GAAG5B,qBAAqB,CAACoB,CAAC,EAAEV,MAAM,CAAC;IAC/D,OAAOkB,sBAAsB;EAC/B,CAAC,CAAC,EAAAJ,IAAA,CAAArB,QAAA,EAEA,CAAC0B,mBAAmB,EAAET,CAAC,KAAKU,IAAA,CAAMD,mBAAmB,EAAET,CAAC,CAACW,KAAK,EAAEX,CAAC,CAAC,EAClE,CAAC,CACH,CAAC;AACL,CAAC","ignoreList":[]}