{"version":3,"file":"getDecorate.js","names":["update","assign","get","isArray","isObject","mapKeys","omit","find","flattenLabels","_","_decorateOption","labelsAsValues","options","id","option","o","decoratedOption","label","decorate","fields","data","arguments","length","undefined","lang","labelsAsKeys","ignoreNonArrayObjects","changes","cleanFields","map","f","forEach","field","$set","bind","updatedValues","filter","v","k"],"sources":["../../src/iso/getDecorate.js"],"sourcesContent":["/**\n * returns function that decorates valid data for a form-schema with full option values and labels\n */\n\nimport update from 'immutability-helper';\n\nimport assign from 'lodash/assign.js';\nimport get from 'lodash/get.js';\nimport isArray from 'lodash/isArray.js';\nimport isObject from 'lodash/isObject.js';\nimport mapKeys from 'lodash/mapKeys.js';\nimport omit from 'lodash/omit.js';\nimport find from 'lodash/find.js';\n\nimport flattenLabels from '../lib/flatten.js';\n\nconst _ = {\n  assign,\n  get,\n  isArray,\n  isObject,\n  mapKeys,\n  omit,\n  find,\n};\n\nfunction _decorateOption(labelsAsValues, options, id) {\n  const option = options.find((o) => o.id === id);\n\n  const decoratedOption = typeof option === 'undefined' || option === null\n    ? null\n    : _.omit(option, ['legacyId']);\n\n  if (labelsAsValues && _.get(decoratedOption, 'label')) return decoratedOption.label;\n\n  return decoratedOption;\n}\n\nfunction decorate(fields, data, options = {}) {\n  const { lang, labelsAsKeys, labelsAsValues, ignoreNonArrayObjects } = _.assign(\n    {\n      lang: null,\n      labelsAsKeys: false,\n      labelsAsValues: false,\n      ignoreNonArrayObjects: false,\n    },\n    options,\n  );\n\n  const changes = {};\n\n  const cleanFields = fields.map((f) =>\n    (lang || labelsAsKeys ? flattenLabels(f, lang) : f));\n\n  cleanFields.forEach((f) => {\n    if (!f.options) return;\n\n    if (data[f.field] === undefined) return;\n\n    if (_.isArray(data[f.field])) {\n      changes[f.field] = {\n        $set: data[f.field].map(\n          _decorateOption.bind(null, labelsAsValues, f.options),\n        ),\n      };\n    } else {\n      changes[f.field] = {\n        $set: _decorateOption(labelsAsValues, f.options, data[f.field]),\n      };\n    }\n  });\n\n  let updatedValues = update(data, changes);\n\n  if (ignoreNonArrayObjects) {\n    updatedValues = _.omit(\n      updatedValues,\n      cleanFields\n        .filter(\n          (f) =>\n            !_.isArray(updatedValues[f.field])\n            && _.isObject(updatedValues[f.field]),\n        )\n        .map((f) => f.field),\n    );\n  }\n\n  if (!labelsAsKeys) return updatedValues;\n\n  return _.omit(\n    _.mapKeys(updatedValues, (v, k) =>\n      _.get(_.find(cleanFields, { field: k }), 'label', '$remove')),\n    ['$remove'],\n  );\n}\n\nexport default (fields) => decorate.bind(null, fields);\nexport { decorate };\n"],"mappings":"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","ignoreList":[]}