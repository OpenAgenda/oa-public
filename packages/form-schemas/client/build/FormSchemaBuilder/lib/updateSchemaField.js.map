{"version":3,"file":"updateSchemaField.js","names":["ih","debug","isFieldOptional","isSameFormItem","getFormItemType","log","standardFieldKeys","updateSchemaField","schema","field","updatedFieldValues","parentsMergedSchema","fieldIndex","_findIndex","fields","sf","Error","updatedField","isAbstract","_context","update","_reduceInstanceProperty","Object","keys","call","carry","fieldKey","_includesInstanceProperty","parentsField","find","f","_objectSpread","$set","_assign","$splice"],"sources":["../../../src/FormSchemaBuilder/lib/updateSchemaField.js"],"sourcesContent":["import _ from 'lodash';\nimport ih from 'immutability-helper';\nimport debug from 'debug';\nimport { isFieldOptional } from '../FieldPreview/utils.js';\nimport isSameFormItem from './isSameFormItem.js';\nimport getFormItemType from './getFormItemType.js';\n\nconst log = debug('FormSchemaBuilder/lib/updateSchemaField');\n\nconst standardFieldKeys = [\n  'options',\n  'max',\n  'min',\n  'fieldType',\n  'origin',\n  'optional',\n  'field',\n  'languages',\n  'read',\n  'write',\n  'enableWith',\n  'optionalWith',\n];\n\nexport default function updateSchemaField(\n  schema,\n  field,\n  updatedFieldValues,\n  parentsMergedSchema,\n) {\n  const fieldIndex = _.findIndex(schema.fields, (sf) =>\n    isSameFormItem(sf, field));\n\n  if (fieldIndex === -1) {\n    throw new Error('Did not find field to update in schema');\n  }\n\n  let updatedField = field;\n\n  const isAbstract = getFormItemType(schema.fields[fieldIndex]) === 'abstract';\n\n  if (isAbstract) {\n    log(\n      'field %s is abstract, updating labels, display and default only',\n      field.field,\n    );\n    log(updatedField, updatedFieldValues);\n    const update = Object.keys(updatedFieldValues).reduce((carry, fieldKey) => {\n      if (standardFieldKeys.includes(fieldKey)) {\n        const parentsField = parentsMergedSchema.fields.find(\n          (f) => f.field === field.field,\n        );\n        if (fieldKey === 'optional' && isFieldOptional(parentsField)) {\n          return {\n            ...carry,\n            [fieldKey]: {\n              $set: updatedFieldValues[fieldKey],\n            },\n          };\n        }\n        return carry;\n      }\n      return {\n        ...carry,\n        [fieldKey]: {\n          $set: updatedFieldValues[fieldKey],\n        },\n      };\n    }, {});\n\n    updatedField = ih(schema.fields[fieldIndex], update);\n    log('updateField', updatedField);\n  } else {\n    updatedField = _.assign({}, field, updatedFieldValues);\n  }\n\n  return ih(schema, {\n    fields: { $splice: [[fieldIndex, 1, updatedField]] },\n  });\n}\n"],"mappings":";;;;;AACA,OAAOA,EAAE,MAAM,qBAAqB;AACpC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,eAAe,QAAQ,0BAA0B;AAC1D,OAAOC,cAAc,MAAM,qBAAqB;AAChD,OAAOC,eAAe,MAAM,sBAAsB;AAElD,MAAMC,GAAG,GAAGJ,KAAK,CAAC,yCAAyC,CAAC;AAE5D,MAAMK,iBAAiB,GAAG,CACxB,SAAS,EACT,KAAK,EACL,KAAK,EACL,WAAW,EACX,QAAQ,EACR,UAAU,EACV,OAAO,EACP,WAAW,EACX,MAAM,EACN,OAAO,EACP,YAAY,EACZ,cAAc,CACf;AAED,eAAe,SAASC,iBAAiBA,CACvCC,MAAM,EACNC,KAAK,EACLC,kBAAkB,EAClBC,mBAAmB,EACnB;EACA,MAAMC,UAAU,GAAGC,UAAA,CAAYL,MAAM,CAACM,MAAM,EAAGC,EAAE,IAC/CZ,cAAc,CAACY,EAAE,EAAEN,KAAK,CAAC,CAAC;EAE5B,IAAIG,UAAU,KAAK,CAAC,CAAC,EAAE;IACrB,MAAM,IAAII,KAAK,CAAC,wCAAwC,CAAC;EAC3D;EAEA,IAAIC,YAAY,GAAGR,KAAK;EAExB,MAAMS,UAAU,GAAGd,eAAe,CAACI,MAAM,CAACM,MAAM,CAACF,UAAU,CAAC,CAAC,KAAK,UAAU;EAE5E,IAAIM,UAAU,EAAE;IAAA,IAAAC,QAAA;IACdd,GAAG,CACD,iEAAiE,EACjEI,KAAK,CAACA,KACR,CAAC;IACDJ,GAAG,CAACY,YAAY,EAAEP,kBAAkB,CAAC;IACrC,MAAMU,MAAM,GAAGC,uBAAA,CAAAF,QAAA,GAAAG,MAAM,CAACC,IAAI,CAACb,kBAAkB,CAAC,EAAAc,IAAA,CAAAL,QAAA,EAAQ,CAACM,KAAK,EAAEC,QAAQ,KAAK;MACzE,IAAIC,yBAAA,CAAArB,iBAAiB,EAAAkB,IAAA,CAAjBlB,iBAAiB,EAAUoB,QAAQ,CAAC,EAAE;QACxC,MAAME,YAAY,GAAGjB,mBAAmB,CAACG,MAAM,CAACe,IAAI,CACjDC,CAAC,IAAKA,CAAC,CAACrB,KAAK,KAAKA,KAAK,CAACA,KAC3B,CAAC;QACD,IAAIiB,QAAQ,KAAK,UAAU,IAAIxB,eAAe,CAAC0B,YAAY,CAAC,EAAE;UAC5D,OAAAG,aAAA,CAAAA,aAAA,KACKN,KAAK;YACR,CAACC,QAAQ,GAAG;cACVM,IAAI,EAAEtB,kBAAkB,CAACgB,QAAQ;YACnC;UAAC;QAEL;QACA,OAAOD,KAAK;MACd;MACA,OAAAM,aAAA,CAAAA,aAAA,KACKN,KAAK;QACR,CAACC,QAAQ,GAAG;UACVM,IAAI,EAAEtB,kBAAkB,CAACgB,QAAQ;QACnC;MAAC;IAEL,CAAC,EAAE,CAAC,CAAC,CAAC;IAENT,YAAY,GAAGjB,EAAE,CAACQ,MAAM,CAACM,MAAM,CAACF,UAAU,CAAC,EAAEQ,MAAM,CAAC;IACpDf,GAAG,CAAC,aAAa,EAAEY,YAAY,CAAC;EAClC,CAAC,MAAM;IACLA,YAAY,GAAGgB,OAAA,CAAS,CAAC,CAAC,EAAExB,KAAK,EAAEC,kBAAkB,CAAC;EACxD;EAEA,OAAOV,EAAE,CAACQ,MAAM,EAAE;IAChBM,MAAM,EAAE;MAAEoB,OAAO,EAAE,CAAC,CAACtB,UAAU,EAAE,CAAC,EAAEK,YAAY,CAAC;IAAE;EACrD,CAAC,CAAC;AACJ","ignoreList":[]}