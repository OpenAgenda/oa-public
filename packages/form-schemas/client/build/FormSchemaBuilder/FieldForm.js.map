{"version":3,"file":"FieldForm.js","names":["Component","passValidator","FormSchemaComponent","merge","flattenLabels","slugFromLabel","fg","Options","unflattenLabels","restrictLabelLanguages","optionsValidator","jsxDEV","_jsxDEV","assignConstraintsToFields","schema","parents","_context","_reduceInstanceProperty","fields","call","carriedSchema","field","push","_objectSpread","constraints","fieldOrder","order","map","f","fieldType","fieldSchemaTypes","labels","_ref","labelLanguages","textLike","_ref2","_parentsField$optiona","parentsField","minMax","min","max","optional","radioLike","_ref3","_parentsField$optiona2","options","customLike","customFieldSchema","_ref4","some","schemas","type","_ref5","_context2","_context3","customFieldConfigurationSchemas","section","_includesInstanceProperty","FieldForm","constructor","props","lang","state","values","length","errors","onChange","bind","_ref6","setState","onSubmit","sanitize","_field$fieldType","initFieldType","stateErrors","item","slug","label","render","_field$fieldType2","_context4","propsField","actionComponent","components","enable","forEach","customs","Object","keys","prev","curr","custom","className","children","stateless","actionComponents","position","_ref7","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["../../src/FormSchemaBuilder/FieldForm.js"],"sourcesContent":["import { Component } from 'react';\nimport passValidator from '@openagenda/validators/pass.js';\nimport FormSchemaComponent from '../index.js';\n\nimport merge from '../iso/merge.js';\nimport flattenLabels from '../lib/flatten.js';\nimport slugFromLabel from './lib/slugFromLabel.js';\nimport fg from './lib/fieldGroups.js';\nimport Options from './Options.js';\nimport unflattenLabels from './lib/unflattenLabels.js';\nimport restrictLabelLanguages from './lib/restrictLabelLanguages.js';\nimport optionsValidator from './lib/optionsValidator.js';\n\nconst assignConstraintsToFields = (schema, parents) =>\n  schema.fields.reduce(\n    (carriedSchema, field) => {\n      carriedSchema.fields.push({\n        ...field,\n        constraints: parents ? parents[field.field] : null,\n      });\n      return carriedSchema;\n    },\n    { ...schema, fields: [] },\n  );\n\nconst fieldOrder = (order) => ({\n  fields: order.map((f) => ({ field: f, fieldType: 'abstract' })),\n});\n\nconst fieldSchemaTypes = {\n  labels: ({ labelLanguages }) => fg.labels({ labelLanguages }),\n  textLike: ({ labelLanguages, parentsField }) =>\n    merge(\n      fg.labels({ labelLanguages }),\n      parentsField ? null : fg.minMax({ min: 0, max: 255 }),\n      !parentsField || (parentsField?.optional ?? true) ? fg.optional() : null,\n      fieldOrder([\n        'label',\n        'optional',\n        'min',\n        'max',\n        'info',\n        'placeholder',\n        'sub',\n      ]),\n    ),\n  radioLike: ({ labelLanguages, parentsField }) =>\n    merge(\n      fg.labels({ labelLanguages }),\n      !parentsField || (parentsField?.optional ?? true) ? fg.optional() : null,\n      parentsField ? null : fg.options({ labelLanguages }),\n      fieldOrder(['label', 'optional', 'options', 'placeholder', 'sub']),\n    ),\n  customLike:\n    (customFieldSchema) =>\n      ({ labelLanguages }) =>\n        merge(\n          customFieldSchema.fields.some((f) => f.field === 'label')\n            ? fg.labels({ labelLanguages })\n            : null,\n          customFieldSchema.fields.some((f) => f.field === 'optional')\n            ? fg.optional()\n            : null,\n          customFieldSchema,\n        ),\n};\n\nconst schemas = (type, { customFieldConfigurationSchemas }) => {\n  if (type === 'section') {\n    return fg.section;\n  }\n  if (\n    [\n      'text',\n      'textarea',\n      'markdown',\n      'link',\n      'boolean',\n      'email',\n      'integer',\n    ].includes(type)\n  ) {\n    return fieldSchemaTypes.textLike;\n  }\n  if (['radio', 'checkbox', 'select', 'multiselect'].includes(type)) {\n    return fieldSchemaTypes.radioLike;\n  }\n  if (\n    customFieldConfigurationSchemas\n    && customFieldConfigurationSchemas[type]\n  ) {\n    return fieldSchemaTypes.customLike(customFieldConfigurationSchemas[type]);\n  }\n  return fieldSchemaTypes.labels;\n};\n\nexport default class FieldForm extends Component {\n  constructor(props) {\n    super(props);\n\n    const { labelLanguages, field, lang } = props;\n\n    this.state = {\n      values: labelLanguages.length\n        ? unflattenLabels(field, labelLanguages)\n        : flattenLabels(field, lang),\n      errors: [],\n    };\n\n    this.onChange = this.onChange.bind(this);\n  }\n\n  onChange({ values, errors }) {\n    this.setState({ errors, values });\n  }\n\n  onSubmit(sanitize) {\n    const { lang, field, initFieldType, labelLanguages, onSubmit } = this.props;\n\n    const { values, errors: stateErrors } = this.state;\n    const { errors } = sanitize(values);\n    const fieldType = field?.fieldType ?? initFieldType;\n\n    if (errors.length) {\n      return this.setState({ errors });\n    }\n\n    if ((stateErrors || []).length) return;\n\n    const item = restrictLabelLanguages(values, labelLanguages);\n\n    if (fieldType === 'section') {\n      item.type = 'section';\n      item.slug = slugFromLabel(values?.label, lang);\n    } else {\n      item.fieldType = fieldType;\n      item.field = field?.field || slugFromLabel(values?.label, lang);\n    }\n\n    onSubmit(item);\n  }\n\n  render() {\n    const {\n      labelLanguages,\n      lang,\n      field: propsField,\n      initFieldType,\n      actionComponent,\n      customFieldConfigurationSchemas, // new\n      components, // new\n      parentsField,\n      enable = true,\n    } = this.props;\n    const { values, errors } = this.state;\n\n    const field = propsField ?? {\n      fieldType: initFieldType,\n    };\n\n    const schema = assignConstraintsToFields(\n      schemas(field.fieldType ?? field.type, {\n        customFieldConfigurationSchemas,\n      })({ labelLanguages, parentsField }),\n      parentsField,\n    );\n\n    if (!enable) {\n      schema.fields.forEach((f) => {\n        f.enable = false;\n      });\n    }\n\n    const customs = components\n      ? Object.keys(components).reduce(\n        (prev, curr) => ({ ...prev, [curr]: passValidator }),\n        {},\n      )\n      : null;\n    schema.custom = {\n      ...customs,\n      options: optionsValidator,\n    };\n\n    return (\n      <div className=\"margin-top-sm\">\n        <FormSchemaComponent\n          stateless\n          values={values}\n          errors={errors}\n          components={{\n            options: Options,\n            ...components,\n          }}\n          onChange={this.onChange}\n          lang={lang}\n          schema={schema}\n          actionComponents={[\n            {\n              position: 'bottom',\n              Component: ({ sanitize }) =>\n                actionComponent({\n                  onSubmit: this.onSubmit.bind(this, sanitize),\n                }),\n            },\n          ]}\n        />\n      </div>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}