{"version":3,"file":"OptionLabelsForm.js","names":["Component","makeLabelGetter","FormSchemaComponent","slugFromLabel","labels","jsxDEV","_jsxDEV","focusOnFirstInput","document","querySelector","focus","e","console","log","getLabel","OptionAdd","constructor","props","state","option","isEdit","label","error","onChange","_ref","values","errors","setState","length","getErrorLabel","_first","code","onSubmit","lang","otherOptions","index","optionLabel","_get","isEmpty","_isString","_keys","filter","k","value","o","errorCode","concat","render","languages","onCancel","stateless","_ref2","globalError","schema","fields","optionEdit","optionAdd","field","fieldType","classNames","bottomErrorsCanvas","actionComponents","position","children","type","className","onClick","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["../../src/FormSchemaBuilder/OptionLabelsForm.js"],"sourcesContent":["import _ from 'lodash';\nimport { Component } from 'react';\n\nimport makeLabelGetter from '@openagenda/labels/makeLabelGetter.js';\nimport FormSchemaComponent from '../index.js';\n\nimport slugFromLabel from './lib/slugFromLabel.js';\nimport labels from './lib/labels.js';\n\nconst focusOnFirstInput = () => {\n  try {\n    document.querySelector('.js_add_option_input textarea').focus();\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nconst getLabel = makeLabelGetter(labels);\n\nexport default class OptionAdd extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      option: this.isEdit()\n        ? {\n          label: props.option.label,\n        }\n        : {},\n      error: null,\n    };\n  }\n\n  onChange({ values, errors }) {\n    this.setState({\n      option: values,\n      error: errors.length ? this.getErrorLabel(_.first(errors).code) : null,\n    });\n  }\n\n  onSubmit() {\n    const { error } = this.state;\n\n    const { lang, otherOptions, onSubmit, index } = this.props;\n\n    if (error) return;\n\n    const optionLabel = _.get(this, 'state.option.label');\n\n    const isEmpty = !optionLabel\n      || (_.isString(optionLabel)\n        ? !optionLabel.length\n        : _.keys(optionLabel).filter(\n          (k) => _.isString(optionLabel[k]) && optionLabel[k].length,\n        ).length !== _.keys(optionLabel).length);\n\n    // add option must be unique\n    const option = isEmpty\n      ? null\n      : {\n        value: slugFromLabel(optionLabel, lang),\n        label: optionLabel,\n      };\n\n    if (isEmpty) {\n      this.setState({\n        error: this.getErrorLabel('optionEmpty'),\n      });\n    } else if (otherOptions.filter((o) => o.value === option.value).length) {\n      this.setState({\n        error: this.getErrorLabel('optionDuplicate'),\n      });\n    } else {\n      onSubmit(index, option);\n\n      this.setState({\n        option: null,\n        error: null,\n      });\n\n      focusOnFirstInput();\n    }\n  }\n\n  getErrorLabel(errorCode) {\n    const { lang } = this.props;\n\n    if (labels[`${errorCode}Error`]) {\n      return getLabel(`${errorCode}Error`, lang);\n    }\n\n    return errorCode;\n  }\n\n  isEdit() {\n    const { option } = this.props;\n    return !!option;\n  }\n\n  render() {\n    const { languages, lang, onCancel } = this.props;\n\n    const { error, option } = this.state;\n\n    return (\n      <FormSchemaComponent\n        stateless\n        onChange={({ values, errors }) => this.onChange({ values, errors })}\n        globalError={error}\n        values={option}\n        lang={this.lang}\n        schema={{\n          fields: [\n            {\n              label: this.isEdit() ? labels.optionEdit : labels.optionAdd,\n              field: 'label',\n              fieldType: 'text',\n              languages,\n            },\n          ],\n        }}\n        classNames={{\n          field: 'js_add_option_input',\n          bottomErrorsCanvas: 'error margin-bottom-sm',\n        }}\n        actionComponents={[\n          {\n            position: 'bottom',\n            Component: () => (\n              <div>\n                <button\n                  type=\"button\"\n                  className=\"btn btn-primary\"\n                  onClick={() => this.onSubmit()}\n                >\n                  {getLabel(\n                    this.isEdit() ? 'optionUpdateAction' : 'optionAddAction',\n                    lang,\n                  )}\n                </button>\n                {onCancel ? (\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-default pull-right\"\n                    onClick={() => onCancel()}\n                  >\n                    {getLabel('optionEditCancel', lang)}\n                  </button>\n                ) : null}\n              </div>\n            ),\n          },\n        ]}\n      />\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}