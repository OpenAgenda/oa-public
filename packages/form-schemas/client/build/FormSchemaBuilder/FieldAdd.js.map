{"version":3,"file":"FieldAdd.js","names":["useState","useCallback","makeLabelGetter","Modal","ChooseFieldType","FieldForm","labels","jsxDEV","_jsxDEV","Fragment","_Fragment","getLabel","Canvas","_ref","children","modal","onClose","title","classNames","overlay","fileName","_jsxFileName","lineNumber","columnNumber","className","isDuplicateLabel","schema","field","_context","type","fieldLabels","label","Object","values","_reduceInstanceProperty","fields","call","existingLabels","schemaField","concat","filter","_includesInstanceProperty","length","ErrorSummary","_ref2","errors","map","e","join","DisabledFieldForm","_ref3","lang","enable","initFieldType","onSubmit","labelLanguages","actionComponent","FieldAdd","_ref4","onAdd","propsOnAdd","fieldType","setFieldType","setErrors","value","onChange","onCancel","_ref5","onClick"],"sources":["../../src/FormSchemaBuilder/FieldAdd.js"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport makeLabelGetter from '@openagenda/labels/makeLabelGetter.js';\nimport { Modal } from '@openagenda/react-shared';\n\nimport ChooseFieldType from './ChooseFieldType.js';\nimport FieldForm from './FieldForm.js';\nimport labels from './lib/labels.js';\n\nconst getLabel = makeLabelGetter(labels);\n\nconst Canvas = ({ children, modal, onClose, title }) =>\n  (modal ? (\n    <Modal\n      classNames={{ overlay: 'popup-overlay big' }}\n      onClose={() => onClose()}\n      title={title}\n    >\n      {children}\n    </Modal>\n  ) : (\n    <>\n      <h3 className=\"margin-v-sm\">{title}</h3>\n      {children}\n    </>\n  ));\n\nconst isDuplicateLabel = (schema, field) => {\n  if (field.type === 'section') {\n    return false;\n  }\n  const fieldLabels = typeof field.label === 'string'\n    ? [field.label]\n    : Object.values(field.label);\n  return !!schema.fields\n    .reduce(\n      (existingLabels, schemaField) =>\n        existingLabels.concat(\n          typeof schemaField.label === 'string'\n            ? [schemaField.label]\n            : Object.values(schemaField.label),\n        ),\n      [],\n    )\n    .filter((label) => fieldLabels.includes(label)).length;\n};\n\nconst ErrorSummary = ({ errors }) => (\n  <div className=\"error-summary boxed margin-top-sm padding-h-sm padding-v-xs\">\n    {errors.map((e) => e.label).join(', ')}\n  </div>\n);\n\nconst DisabledFieldForm = ({ lang }) => (\n  <FieldForm\n    enable={false}\n    initFieldType=\"text\"\n    onSubmit={() => {}}\n    lang={lang}\n    labelLanguages={[]}\n    actionComponent={() => null}\n  />\n);\n\nexport default function FieldAdd({\n  onAdd: propsOnAdd,\n  schema,\n  onClose,\n  lang,\n  modal = true,\n  labelLanguages,\n}) {\n  const [fieldType, setFieldType] = useState(null);\n  const [errors, setErrors] = useState([]);\n\n  const onAdd = useCallback(\n    (field) => {\n      // slug is not defined here: it cannot be used as a basis for duplicate detection\n      if (isDuplicateLabel(schema, field)) {\n        setErrors([\n          {\n            label: getLabel('isLabelDuplicateError', lang),\n          },\n        ]);\n        return;\n      }\n      setErrors([]);\n      propsOnAdd(field);\n    },\n    [schema, propsOnAdd, setErrors, lang],\n  );\n\n  return (\n    <Canvas modal={modal} onClose={onClose} title={getLabel('addField', lang)}>\n      <ChooseFieldType\n        lang={lang}\n        value={fieldType}\n        onChange={setFieldType}\n        onCancel={onClose}\n      />\n      {fieldType ? (\n        <>\n          {errors.length ? <ErrorSummary errors={errors} lang={lang} /> : null}\n          <FieldForm\n            initFieldType={fieldType}\n            onSubmit={onAdd}\n            lang={lang}\n            labelLanguages={labelLanguages}\n            actionComponent={({ onSubmit }) => (\n              <>\n                {errors.length ? (\n                  <div className=\"margin-bottom-md\">\n                    <ErrorSummary errors={errors} lang={lang} />\n                  </div>\n                ) : null}\n                <div>\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-default\"\n                    onClick={() => onClose()}\n                  >\n                    {getLabel('cancelFieldEdit', lang)}\n                  </button>\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-primary pull-right\"\n                    onClick={onSubmit}\n                  >\n                    {getLabel('confirmFieldCreate', lang)}\n                  </button>\n                </div>\n              </>\n            )}\n          />\n        </>\n      ) : (\n        <DisabledFieldForm lang={lang} />\n      )}\n    </Canvas>\n  );\n}\n"],"mappings":"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","ignoreList":[]}