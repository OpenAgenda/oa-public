{"version":3,"file":"index.js","names":["debug","useState","useCallback","useEffect","useMemo","DndContext","closestCenter","KeyboardSensor","PointerSensor","useSensor","useSensors","SortableContext","sortableKeyboardCoordinates","verticalListSortingStrategy","unloadWarning","makeLabelGetter","submit","merge","labels","isOwnField","extractSchemaInfo","insertMissingAbstractFields","reorderSchemaFields","saveStates","updateSchemaField","addSchemaField","removeSchemaField","restrictLabelLanguages","extractSchemaLabelLanguages","monolingualizeSchema","getFormItemSlug","FieldPreview","LabelLanguages","SaveButton","FieldAdd","FieldEdit","jsxDEV","_jsxDEV","modes","DEFAULT","EDITLABELLANGUAGES","ADDFIELD","isObjectWithKeys","obj","Array","isArray","Object","keys","length","getLabel","log","FieldAddButton","_ref","onClick","lang","disabled","block","type","className","concat","children","fileName","_jsxFileName","lineNumber","columnNumber","FormSchemaBuilder","_ref2","schema","initialSchema","useExtendedLabelLanguages","devState","addEnabled","settingsEnabled","editableExtensions","extendedFrom","customFieldConfigurationSchemas","components","displaySidebar","onUpdate","onSuccess","res","sensors","activationConstraint","distance","coordinateGetter","getSchema","schemaState","defaultSchema","fields","getMergedSchema","currentSchema","extensions","merged","map","e","_objectSpread","filter","f","fieldType","parentsMergedSchema","initSchema","mergedInitialSchema","setSchema","labelLanguages","setLabelLanguages","saveState","setSaveState","UNCHANGED","editedField","setEditedField","mode","setMode","activeItemSlug","setActiveItemSlug","addToEnd","setAddToEnd","isDragging","setIsDragging","updateSaveState","newSaveState","schemaUpdate","arguments","undefined","SAVED","unset","set","handleAccordionToggle","field","slug","prev","handleSave","LOADING","values","applyToSchema","then","_ref3","body","_err","ERROR","handleFieldEdit","handleFieldRemove","updatedSchema","CHANGED","handleFieldEditCancel","handleFieldAdd","mergedSchema","schemaWithAbstractFields","handleFieldEditSave","update","handleLabelLanguagesChange","updatedLabelLanguages","wasMonolingualized","isDisabled","actionName","isFieldDisabled","forceDisabled","_get","onSave","onCancel","parentsFields","collisionDetection","onDragStart","onDragEnd","event","active","over","id","mapped","oldIndex","indexOf","newIndex","reorderedSchema","items","strategy","index","ordering","ORDERING","isOwn","schemaInfo","onEdit","onHide","display","onShow","onRemove","onAccordionToggle","onAdd","onClose"],"sources":["../../src/FormSchemaBuilder/index.js"],"sourcesContent":["import _ from 'lodash';\nimport debug from 'debug';\nimport { useState, useCallback, useEffect, useMemo } from 'react';\n\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n} from '@dnd-kit/core';\n\nimport {\n  SortableContext,\n  sortableKeyboardCoordinates,\n  verticalListSortingStrategy,\n} from '@dnd-kit/sortable';\n\nimport { unloadWarning } from '@openagenda/react-shared';\nimport makeLabelGetter from '@openagenda/labels/makeLabelGetter.js';\n\nimport submit from '../lib/submit.js';\nimport merge from '../iso/merge.js';\nimport labels from './lib/labels.js';\n\nimport isOwnField from './lib/isOwnField.js';\n\nimport extractSchemaInfo from './lib/extractSchemaInfo.js';\nimport insertMissingAbstractFields from './lib/insertMissingAbstractFields.js';\nimport reorderSchemaFields from './lib/reorderSchemaFields.js';\nimport saveStates from './lib/saveStates.js';\nimport updateSchemaField from './lib/updateSchemaField.js';\nimport addSchemaField from './lib/addSchemaField.js';\nimport removeSchemaField from './lib/removeSchemaField.js';\nimport restrictLabelLanguages from './lib/restrictLabelLanguages.js';\nimport extractSchemaLabelLanguages from './lib/extractSchemaLabelLanguages.js';\nimport monolingualizeSchema from './lib/monolingualizeSchema.js';\nimport getFormItemSlug from './lib/getFormItemSlug.js';\n\nimport FieldPreview from './FieldPreview/index.js';\nimport LabelLanguages from './LabelLanguages.js';\nimport SaveButton from './SaveButton.js';\nimport FieldAdd from './FieldAdd.js';\nimport FieldEdit from './FieldEdit.js';\n\nconst modes = {\n  DEFAULT: 0,\n  EDITLABELLANGUAGES: 1,\n  ADDFIELD: 2,\n};\n\nfunction isObjectWithKeys(obj) {\n  return (\n    obj !== null\n    && typeof obj === 'object'\n    && !Array.isArray(obj)\n    && Object.keys(obj).length > 0\n  );\n}\n\nconst getLabel = makeLabelGetter(labels);\n\nconst log = debug('FormSchemaBuilder');\n\nconst FieldAddButton = ({ onClick, lang, disabled, block }) => (\n  <button\n    disabled={disabled}\n    type=\"button\"\n    className={`btn btn-primary ${block ? 'btn-block' : ''}`}\n    onClick={onClick}\n  >\n    {getLabel('addField', lang)}\n  </button>\n);\n\nconst FormSchemaBuilder = ({\n  schema: initialSchema,\n  useExtendedLabelLanguages,\n  devState,\n  addEnabled,\n  settingsEnabled,\n  editableExtensions,\n  extendedFrom = [],\n  lang,\n  customFieldConfigurationSchemas,\n  components,\n  displaySidebar = true,\n  onUpdate,\n  onSuccess,\n  res,\n}) => {\n  const sensors = useSensors(\n    useSensor(PointerSensor, {\n      activationConstraint: {\n        distance: 8,\n      },\n    }),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    }),\n  );\n\n  // Helper functions\n  const getSchema = useCallback((schemaState) => {\n    const defaultSchema = { fields: [] };\n    return schemaState === null ? defaultSchema : schemaState || defaultSchema;\n  }, []);\n\n  const getMergedSchema = useCallback(\n    (currentSchema) => {\n      const extensions = extendedFrom;\n      const merged = merge(\n        ...extensions.map((e) => e.schema).concat(currentSchema),\n      );\n\n      return {\n        ...merged,\n        fields: merged.fields.filter((f) => f?.fieldType !== 'abstract'),\n      };\n    },\n    [extendedFrom],\n  );\n\n  const parentsMergedSchema = useMemo(\n    () => merge(...extendedFrom.map((e) => e.schema)),\n    [extendedFrom],\n  );\n\n  // State initialization\n  const initSchema = useMemo(\n    () => (initialSchema?.fields ? initialSchema : { fields: [] }),\n    [initialSchema],\n  );\n\n  const mergedInitialSchema = getMergedSchema(initSchema);\n\n  const [schema, setSchema] = useState(initSchema);\n  const [labelLanguages, setLabelLanguages] = useState(\n    extractSchemaLabelLanguages(\n      useExtendedLabelLanguages ? mergedInitialSchema : initialSchema,\n    ),\n  );\n  const [saveState, setSaveState] = useState(saveStates.UNCHANGED);\n  const [editedField, setEditedField] = useState(null);\n  const [mode, setMode] = useState(null);\n  const [activeItemSlug, setActiveItemSlug] = useState(null);\n  const [addToEnd, setAddToEnd] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n\n  useEffect(() => {\n    if (isObjectWithKeys(devState)) {\n      setSchema(devState.schema || initSchema);\n      setLabelLanguages(devState.labelLanguages || []);\n      setSaveState(devState.saveState || saveStates.UNCHANGED);\n      setEditedField(devState.editedField || null);\n      setMode(devState.mode || null);\n      setActiveItemSlug(devState.activeItemSlug || null);\n    }\n  }, [devState, initSchema]);\n\n  // Save state management\n  const updateSaveState = useCallback(\n    (newSaveState, schemaUpdate = null) => {\n      if (newSaveState === saveStates.SAVED) {\n        unloadWarning.unset();\n      } else {\n        unloadWarning.set();\n      }\n\n      setSaveState(newSaveState);\n      if (schemaUpdate) {\n        setSchema(schemaUpdate);\n        onUpdate(schemaUpdate);\n      }\n    },\n    [onUpdate],\n  );\n\n  // Event handlers\n  const handleAccordionToggle = useCallback(\n    (field) => {\n      if (isDragging) return;\n      const slug = getFormItemSlug(field);\n      setActiveItemSlug((prev) => (prev === slug ? null : slug));\n    },\n    [isDragging],\n  );\n\n  const handleSave = useCallback(() => {\n    if (isDragging) return;\n    updateSaveState(saveStates.LOADING);\n\n    submit({\n      res,\n      values: restrictLabelLanguages.applyToSchema(\n        getSchema(schema),\n        labelLanguages,\n      ),\n    }).then(\n      ({ body }) => {\n        updateSaveState(saveStates.SAVED, body);\n        if (onSuccess) onSuccess();\n      },\n      (_err) => {\n        updateSaveState(saveStates.ERROR);\n      },\n    );\n  }, [\n    schema,\n    labelLanguages,\n    res,\n    onSuccess,\n    getSchema,\n    updateSaveState,\n    isDragging,\n  ]);\n\n  const handleFieldEdit = useCallback(\n    (field) => {\n      if (!isDragging) setEditedField(field);\n    },\n    [isDragging],\n  );\n\n  const handleFieldRemove = useCallback(\n    (field) => {\n      const updatedSchema = removeSchemaField(getSchema(schema), field);\n      updateSaveState(saveStates.CHANGED, updatedSchema);\n    },\n    [schema, getSchema, updateSaveState],\n  );\n\n  const handleFieldEditCancel = useCallback(() => {\n    setEditedField(null);\n  }, []);\n\n  const handleFieldAdd = useCallback(\n    (field) => {\n      const currentSchema = getSchema(schema);\n      const mergedSchema = getMergedSchema(currentSchema);\n      const schemaWithAbstractFields = insertMissingAbstractFields(\n        currentSchema,\n        mergedSchema,\n      );\n\n      log(\n        'adding field on schema of %s fields, %s when merged',\n        currentSchema.fields.length,\n        mergedSchema.fields.length,\n      );\n\n      const updatedSchema = addSchemaField(\n        schemaWithAbstractFields,\n        field,\n        addToEnd,\n      );\n      updateSaveState(saveStates.CHANGED, updatedSchema);\n      setMode(modes.DEFAULT);\n    },\n    [schema, addToEnd, getMergedSchema, getSchema, updateSaveState],\n  );\n\n  const handleFieldEditSave = useCallback(\n    (field, update) => {\n      setEditedField(null);\n\n      const currentSchema = insertMissingAbstractFields(\n        getSchema(schema),\n        getMergedSchema(schema),\n      );\n\n      const updatedSchema = updateSchemaField(\n        currentSchema,\n        field,\n        update,\n        parentsMergedSchema,\n      );\n      updateSaveState(saveStates.CHANGED, updatedSchema);\n    },\n    [schema, getMergedSchema, getSchema, updateSaveState, parentsMergedSchema],\n  );\n\n  const handleLabelLanguagesChange = useCallback(\n    (updatedLabelLanguages) => {\n      const wasMonolingualized = !updatedLabelLanguages.length && labelLanguages.length;\n\n      setLabelLanguages(updatedLabelLanguages);\n      updateSaveState(saveStates.CHANGED);\n\n      if (wasMonolingualized) {\n        const updatedSchema = monolingualizeSchema(getSchema(schema));\n        updateSaveState(saveStates.CHANGED, updatedSchema);\n      }\n    },\n    [labelLanguages, schema, getSchema, updateSaveState],\n  );\n\n  // Helper functions for UI state\n  const isDisabled = useCallback(\n    (actionName) => {\n      if (saveState === saveStates.LOADING) return true;\n      if (mode && mode !== actionName) return true;\n      return false;\n    },\n    [mode, saveState],\n  );\n\n  const isFieldDisabled = useCallback(\n    (field, forceDisabled) => {\n      if (forceDisabled) return true;\n      if (!_.get(field, 'display', true)) return true;\n      return editedField && editedField !== field.field;\n    },\n    [editedField],\n  );\n\n  const mergedSchema = useMemo(\n    () => getMergedSchema(schema),\n    [schema, getMergedSchema],\n  );\n\n  const disabled = saveState === saveStates.LOADING;\n\n  return (\n    <div className=\"form-schema-builder dnd row\">\n      {displaySidebar ? (\n        <div className=\"col-sm-12 padding-bottom-sm\">\n          <div className=\"padding-all-sm\">\n            {settingsEnabled ? (\n              <LabelLanguages\n                disabled={isDisabled(modes.EDITLABELLANGUAGES)}\n                lang={lang}\n                labelLanguages={labelLanguages}\n                onUpdate={handleLabelLanguagesChange}\n              />\n            ) : null}\n            <div className=\"form-inline\">\n              <FieldAddButton\n                disabled={!addEnabled || isDisabled(modes.ADDFIELD)}\n                lang={lang}\n                onClick={() => {\n                  setMode(modes.ADDFIELD);\n                  setAddToEnd(false);\n                }}\n              />\n              <SaveButton\n                disabled={mode}\n                lang={lang}\n                onClick={handleSave}\n                saveState={saveState}\n              />\n            </div>\n          </div>\n        </div>\n      ) : null}\n      <div className=\"col-sm-12\">\n        {editedField ? (\n          <FieldEdit\n            isOwnField={isOwnField(schema, editedField)}\n            field={editedField}\n            labelLanguages={labelLanguages}\n            lang={lang}\n            onSave={(update) => handleFieldEditSave(editedField, update)}\n            onCancel={handleFieldEditCancel}\n            customFieldConfigurationSchemas={customFieldConfigurationSchemas}\n            components={components}\n            parentsFields={parentsMergedSchema}\n          />\n        ) : null}\n        <div\n          className={`margin-h-sm list-group field-preview-canvas dnd${editedField ? ' editing' : ''}`}\n        >\n          <DndContext\n            sensors={sensors}\n            collisionDetection={closestCenter}\n            onDragStart={() => {\n              setIsDragging(true);\n            }}\n            onDragEnd={(event) => {\n              const { active, over } = event;\n              if (active.id !== over.id) {\n                const mapped = (mergedSchema?.fields || []).map(\n                  (f) => f.field || f.slug,\n                );\n                const oldIndex = mapped.indexOf(active.id);\n                const newIndex = mapped.indexOf(over.id);\n                const reorderedSchema = reorderSchemaFields(\n                  getMergedSchema(schema),\n                  oldIndex,\n                  newIndex,\n                );\n                const updatedSchema = insertMissingAbstractFields(\n                  getSchema(schema),\n                  reorderedSchema,\n                );\n                updateSaveState(saveStates.CHANGED, updatedSchema);\n              }\n              setIsDragging(false);\n            }}\n          >\n            <SortableContext\n              items={(mergedSchema?.fields || []).map((f) => f.field || f.slug)}\n              strategy={verticalListSortingStrategy}\n            >\n              {(mergedSchema?.fields || []).map((field, index) => (\n                <FieldPreview\n                  index={index}\n                  disabled={isFieldDisabled(field, disabled)}\n                  ordering={mode === modes.ORDERING}\n                  field={field}\n                  isOwn={isOwnField(schema, field)}\n                  editableExtensions={editableExtensions}\n                  schemaInfo={extractSchemaInfo(field, extendedFrom)}\n                  lang={lang}\n                  labelLanguages={labelLanguages}\n                  onEdit={() => handleFieldEdit(field)}\n                  onHide={() => handleFieldEditSave(field, { display: false })}\n                  onShow={() => handleFieldEditSave(field, { display: true })}\n                  onRemove={() => handleFieldRemove(field)}\n                  onAccordionToggle={() => handleAccordionToggle(field)}\n                  active={activeItemSlug === getFormItemSlug(field)}\n                  schema={mergedSchema}\n                  key={field.field || field.slug}\n                  isDragging={isDragging}\n                />\n              ))}\n            </SortableContext>\n          </DndContext>\n          {addEnabled ? (\n            <div className=\"padding-v-sm\">\n              <FieldAddButton\n                block\n                disabled={isDisabled(modes.ADDFIELD)}\n                lang={lang}\n                onClick={() => {\n                  setMode(modes.ADDFIELD);\n                  setAddToEnd(true);\n                }}\n              />\n            </div>\n          ) : null}\n          {mode === modes.ADDFIELD ? (\n            <FieldAdd\n              schema={mergedSchema}\n              labelLanguages={labelLanguages}\n              lang={lang}\n              onAdd={handleFieldAdd}\n              onClose={() => setMode(modes.DEFAULT)}\n            />\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FormSchemaBuilder;\n"],"mappings":"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","ignoreList":[]}