{"version":3,"file":"middleware.js","names":["wrap","fn","req","res","next","_Promise","resolve","catch","getFormIndex","service","options","namespaces","_merge","entityName","identifier","_get","_toNumber","_isString","status","Error","ability","get","formIndex","send","updateFormIndex","data","_isObject"],"sources":["../../src/service/middleware.js"],"sourcesContent":["import _ from 'lodash';\n// import service from './index';\n\nfunction wrap(fn) {\n  return (req, res, next) => Promise.resolve(fn(req, res, next)).catch(next);\n}\n\nexport function getFormIndex(service, options) {\n  const { namespaces } = _.merge(\n    {\n      namespaces: {\n        entityName: 'query.entityName',\n        identifier: 'query.identifier',\n      },\n    },\n    options,\n  );\n\n  return wrap(async (req, res) => {\n    const entityName = _.get(req, namespaces.entityName, null);\n    const identifier = _.toNumber(_.get(req, namespaces.identifier, null));\n\n    if (!_.isString(entityName)) {\n      res.status(400);\n      throw new Error('entityName should be a string');\n    }\n\n    if (!identifier) {\n      res.status(400);\n      throw new Error('identifier should be a number');\n    }\n\n    const ability = await service.get(entityName, identifier);\n    const formIndex = await ability.getFormIndex();\n\n    res.send(formIndex);\n  });\n}\n\nexport function updateFormIndex(service, options) {\n  const { namespaces } = _.merge(\n    {\n      namespaces: {\n        entityName: 'query.entityName',\n        identifier: 'query.identifier',\n        data: 'body',\n      },\n    },\n    options,\n  );\n\n  return wrap(async (req, res) => {\n    const entityName = _.get(req, namespaces.entityName, null);\n    const identifier = _.toNumber(_.get(req, namespaces.identifier, null));\n    const data = _.get(req, namespaces.data, null);\n\n    if (!_.isString(entityName)) {\n      res.status(400);\n      throw new Error('entityName should be a string');\n    }\n\n    if (!identifier) {\n      res.status(400);\n      throw new Error('identifier should be a number');\n    }\n\n    if (!_.isObject(data)) {\n      res.status(400);\n      throw new Error('data should be an object');\n    }\n\n    const ability = await service.get(entityName, identifier);\n    const formIndex = await ability.updateFormIndex(data);\n\n    res.send(formIndex);\n  });\n}\n"],"mappings":"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","ignoreList":[]}