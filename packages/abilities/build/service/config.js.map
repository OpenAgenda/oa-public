{"version":3,"file":"config.js","names":["path","logs","config","init","c","arguments","length","undefined","logger","setModuleConfig","Object","assign","_pick","knex","migrations","migrate","latest","_objectSpread","tableName","directory","join","import","meta","dirname","e","console","log","options","seed","scenarioName","run","_extend","getConfig"],"sources":["../../src/service/config.js"],"sourcesContent":["import path from 'node:path';\nimport _ from 'lodash';\nimport logs from '@openagenda/logs';\n\nconst config = {};\n\nexport async function init(c = {}) {\n  if (c.logger) {\n    logs.setModuleConfig(c.logger);\n  }\n\n  Object.assign(\n    config,\n    _.pick(c, [\n      'mysql',\n      'schemas',\n      'migrations',\n      'interfaces',\n      'entityMapping',\n      'knex',\n    ]),\n  );\n\n  const { knex } = config;\n\n  if (c.migrations) {\n    try {\n      await knex.migrate.latest({\n        tableName: 'inbox_migrations',\n        ...c.migrations,\n        directory: path.join(import.meta.dirname, '..', '..', 'migrations'),\n      });\n    } catch (e) {\n      console.log(e);\n    }\n  }\n}\n\nexport function migrate(options) {\n  return config.knex.migrate.latest({\n    directory: path.join(import.meta.dirname, '..', '..', 'migrations'),\n    ...options,\n  });\n}\n\nexport function seed(options) {\n  const directory = typeof options === 'string'\n    ? path.join(import.meta.dirname, '..', '..', 'seeds', options)\n    : path.join(\n      import.meta.dirname,\n      '..',\n      '..',\n      'seeds',\n      options && options.scenarioName ? options.scenarioName : '',\n    );\n\n  return config.knex.seed.run({\n    directory,\n    ...options,\n  });\n}\n\n_.extend(config, {\n  init,\n  migrate,\n  seed,\n  getConfig: () => config,\n});\n\nexport default config;\n"],"mappings":";;;;AAAA,OAAOA,IAAI,MAAM,WAAW;AAE5B,OAAOC,IAAI,MAAM,kBAAkB;AAEnC,MAAMC,MAAM,GAAG,CAAC,CAAC;AAEjB,OAAO,eAAeC,IAAIA,CAAA,EAAS;EAAA,IAARC,CAAC,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;EAC/B,IAAID,CAAC,CAACI,MAAM,EAAE;IACZP,IAAI,CAACQ,eAAe,CAACL,CAAC,CAACI,MAAM,CAAC;EAChC;EAEAE,MAAM,CAACC,MAAM,CACXT,MAAM,EACNU,KAAA,CAAOR,CAAC,EAAE,CACR,OAAO,EACP,SAAS,EACT,YAAY,EACZ,YAAY,EACZ,eAAe,EACf,MAAM,CACP,CACH,CAAC;EAED,MAAM;IAAES;EAAK,CAAC,GAAGX,MAAM;EAEvB,IAAIE,CAAC,CAACU,UAAU,EAAE;IAChB,IAAI;MACF,MAAMD,IAAI,CAACE,OAAO,CAACC,MAAM,CAAAC,aAAA,CAAAA,aAAA;QACvBC,SAAS,EAAE;MAAkB,GAC1Bd,CAAC,CAACU,UAAU;QACfK,SAAS,EAAEnB,IAAI,CAACoB,IAAI,CAACC,MAAM,CAACC,IAAI,CAACC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,YAAY;MAAC,EACpE,CAAC;IACJ,CAAC,CAAC,OAAOC,CAAC,EAAE;MACVC,OAAO,CAACC,GAAG,CAACF,CAAC,CAAC;IAChB;EACF;AACF;AAEA,OAAO,SAAST,OAAOA,CAACY,OAAO,EAAE;EAC/B,OAAOzB,MAAM,CAACW,IAAI,CAACE,OAAO,CAACC,MAAM,CAAAC,aAAA;IAC/BE,SAAS,EAAEnB,IAAI,CAACoB,IAAI,CAACC,MAAM,CAACC,IAAI,CAACC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,YAAY;EAAC,GAChEI,OAAO,CACX,CAAC;AACJ;AAEA,OAAO,SAASC,IAAIA,CAACD,OAAO,EAAE;EAC5B,MAAMR,SAAS,GAAG,OAAOQ,OAAO,KAAK,QAAQ,GACzC3B,IAAI,CAACoB,IAAI,CAACC,MAAM,CAACC,IAAI,CAACC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAEI,OAAO,CAAC,GAC5D3B,IAAI,CAACoB,IAAI,CACTC,MAAM,CAACC,IAAI,CAACC,OAAO,EACnB,IAAI,EACJ,IAAI,EACJ,OAAO,EACPI,OAAO,IAAIA,OAAO,CAACE,YAAY,GAAGF,OAAO,CAACE,YAAY,GAAG,EAC3D,CAAC;EAEH,OAAO3B,MAAM,CAACW,IAAI,CAACe,IAAI,CAACE,GAAG,CAAAb,aAAA;IACzBE;EAAS,GACNQ,OAAO,CACX,CAAC;AACJ;AAEAI,OAAA,CAAS7B,MAAM,EAAE;EACfC,IAAI;EACJY,OAAO;EACPa,IAAI;EACJI,SAAS,EAAEA,CAAA,KAAM9B;AACnB,CAAC,CAAC;AAEF,eAAeA,MAAM","ignoreList":[]}