{"version":3,"file":"AbilitiesForm.js","names":["React","Component","useState","useCallback","ky","FormSpy","Collapse","defineMessages","FormattedMessage","useIntl","cn","Fuse","Spinner","RuleCheckbox","isIndeterminate","jsxDEV","_jsxDEV","Fragment","_Fragment","MINLEN_REQUIRED_FOR_SEARCH","saveSubscription","submitting","pristine","submitSucceeded","changeSubscription","values","data","descriptionMessages","firstEntityUser","id","defaultMessage","firstEntityContributor","firstEntityAdminmod","childEntityContributor","childEntityAdminmod","search","newsletterTitle","newsletterDescription","newsletterSubscribe","newsletterSubscribed","getEntityTitle","ability","entityName","entity","fullName","title","agendaTitle","identifier","Newsletter","intl","wasClicked","setWasClicked","subscribe","post","json","then","className","concat","children","formatMessage","fileName","_jsxFileName","lineNumber","columnNumber","disabled","onClick","type","FilterInput","_ref","value","onChange","placeholder","name","SaveButton","_ref2","form","submit","mode","FirstEntityRule","_ref3","ruleName","rules","headerMessage","_upperFirst","_objectSpread","map","rule","key","ChildEntityRule","_ref4","AbilitiesForm","constructor","props","_defineProperty","_debounce","setState","debouncedSearch","e","target","formState","mutators","setFieldData","batch","getFieldState","firstEntityRules","otherRules","_partition","_matches","indeterminates","_reduceInstanceProperty","call","result","relatedRules","_remove","_pick","fieldState","indeterminate","_valuesInstanceProperty","_forEach","state","ruleKeys","firstEntityAbility","childAbilities","getDerivedStateFromProps","nextProps","prevState","searchChildKey","_isEqual","rulesPerEntity","entityProps","found","_find","push","_groupBy","_reject","fuseChildAbilities","_mapValues","childAbility","shouldSort","threshold","location","distance","maxPatternLength","minMatchCharLength","keys","componentDidMount","getState","allValues","_filter","render","handleSubmit","HeaderComponent","filterInputPlaceholder","saveButton","subscription","component","childAbilitiesLength","_reduce","length","createElement","onSubmit","Object","entries","_ref5","handleSearchChange","abilities","entityAbility","Panel","header","_ref6","onFormValueChange"],"sources":["../../src/client/AbilitiesForm.js"],"sourcesContent":["import React, { Component, useState, useCallback } from 'react';\nimport ky from 'ky';\nimport _ from 'lodash';\nimport { FormSpy } from 'react-final-form';\nimport Collapse from 'rc-collapse';\nimport { defineMessages, FormattedMessage, useIntl } from 'react-intl';\nimport cn from 'classnames';\nimport Fuse from 'fuse.js';\nimport { Spinner } from '@openagenda/react-shared';\nimport RuleCheckbox from './RuleCheckbox.js';\nimport isIndeterminate from './isIndeterminate.js';\n\nconst MINLEN_REQUIRED_FOR_SEARCH = 8;\n\nconst saveSubscription = {\n  submitting: true,\n  pristine: true,\n  submitSucceeded: true,\n};\n\nconst changeSubscription = { values: true, data: true };\n\nconst descriptionMessages = defineMessages({\n  firstEntityUser: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.firstEntityUser',\n    defaultMessage: 'Your global settings:',\n  },\n  firstEntityContributor: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.firstEntityContributor',\n    defaultMessage: 'Your contributor settings:',\n  },\n  firstEntityAdminmod: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.firstEntityAdminmod',\n    defaultMessage: 'Your administrator or moderator settings:',\n  },\n  childEntityContributor: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.childEntityContributor',\n    defaultMessage: 'Contributor settings:',\n  },\n  childEntityAdminmod: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.childEntityAdminmod',\n    defaultMessage: 'Administrator or moderator settings:',\n  },\n  search: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.search',\n    defaultMessage: 'Search',\n  },\n  newsletterTitle: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.newsletterTitle',\n    defaultMessage: 'Receive the newsletter',\n  },\n  newsletterDescription: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.newsletterDescription',\n    defaultMessage:\n      'Follow the upcoming evolutions coming up on OpenAgenda! You can unsubscribe at any time.',\n  },\n  newsletterSubscribe: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.newsletterSubscribe',\n    defaultMessage: 'Click here to subscribe',\n  },\n  newsletterSubscribed: {\n    id: 'Abilities.RulesCheckbox.AbilitiesForm.newsletterSubscribed',\n    defaultMessage:\n      'You will now receive the next newsletter! To unsubscribe, just click on the link that will be placed at the bottom of each message.',\n  },\n});\n\nfunction getEntityTitle(ability) {\n  switch (ability.entityName) {\n    case 'user':\n      return ability.entity.fullName;\n    case 'agenda':\n      return ability.entity.title;\n    case 'member':\n      return ability.entity.agendaTitle;\n    default:\n      return ability.identifier;\n  }\n}\n\nconst Newsletter = () => {\n  const intl = useIntl();\n  const [wasClicked, setWasClicked] = useState(false);\n\n  const subscribe = useCallback(() => {\n    ky.post('/newsletter/subscribe', { json: {} }).then(() => {\n      setWasClicked(true);\n    });\n  }, []);\n\n  return (\n    <div\n      className={`info-block-sm margin-bottom-sm${wasClicked ? ' success' : ''}`}\n    >\n      <strong>{intl.formatMessage(descriptionMessages.newsletterTitle)}</strong>\n      <div>\n        {intl.formatMessage(\n          descriptionMessages[\n            wasClicked ? 'newsletterSubscribed' : 'newsletterDescription'\n          ],\n        )}\n      </div>\n      {wasClicked ? null : (\n        <button\n          disabled={wasClicked}\n          onClick={() => subscribe()}\n          type=\"button\"\n          className=\"btn btn-link padding-left-z\"\n        >\n          {intl.formatMessage(descriptionMessages.newsletterSubscribe)}\n        </button>\n      )}\n    </div>\n  );\n};\n\nconst FilterInput = ({ value, onChange, placeholder }) => {\n  const intl = useIntl();\n\n  return (\n    <div className=\"form-group search\">\n      <div className=\"input-icon-right\">\n        <input\n          name=\"filter\"\n          type=\"text\"\n          className=\"form-control\"\n          value={value}\n          onChange={onChange}\n          placeholder={placeholder}\n        />\n        <button type=\"submit\" className=\"btn\">\n          <i\n            className=\"fa fa-search\"\n            aria-hidden=\"true\"\n            aria-label={intl.formatMessage(descriptionMessages.search)}\n          />\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst SaveButton = ({ form, submitting, pristine, submitSucceeded }) => (\n  <button\n    type=\"submit\"\n    onClick={form.submit}\n    className={cn('btn', {\n      'btn-primary': !submitSucceeded,\n      'btn-success': submitSucceeded,\n    })}\n    disabled={submitting || pristine}\n  >\n    <FormattedMessage id=\"Abilities.AbilitiesForm.save\" defaultMessage=\"Save\" />\n\n    {submitting && (\n      <span className=\"margin-h-sm\">\n        <Spinner mode=\"inline\" />\n      </span>\n    )}\n  </button>\n);\n\nconst FirstEntityRule = ({ ruleName, rules }) => {\n  const headerMessage = descriptionMessages[`firstEntity${_.upperFirst(ruleName)}`];\n\n  return (\n    <div>\n      {headerMessage ? (\n        <b>\n          <FormattedMessage {...headerMessage} />\n        </b>\n      ) : null}\n\n      {rules.map((rule) => (\n        <RuleCheckbox key={rule.key} rule={rule} />\n      ))}\n    </div>\n  );\n};\n\nconst ChildEntityRule = ({ ruleName, rules }) => {\n  const headerMessage = descriptionMessages[`childEntity${_.upperFirst(ruleName)}`];\n\n  return (\n    <div>\n      {headerMessage ? (\n        <b>\n          <FormattedMessage {...headerMessage} />\n        </b>\n      ) : null}\n\n      {rules.map((rule) => (\n        <RuleCheckbox key={rule.key} rule={rule} />\n      ))}\n    </div>\n  );\n};\n\nexport default class AbilitiesForm extends Component {\n  static defaultProps = {\n    rules: null,\n    form: null,\n    handleSubmit: null,\n    HeaderComponent: null,\n    searchChildKey: null,\n    filterInputPlaceholder: '',\n  };\n\n  debouncedSearch = _.debounce((value) => {\n    this.setState({ debouncedSearch: value });\n  }, 500);\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      ruleKeys: null,\n      firstEntityAbility: null,\n      childAbilities: null,\n      search: '',\n      debouncedSearch: '',\n    };\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const { entityName, identifier, rules, searchChildKey } = nextProps;\n    const ruleKeys = rules.map((rule) => rule.key);\n\n    if (!_.isEqual(prevState.ruleKeys, ruleKeys)) {\n      const rulesPerEntity = rules.reduce((result, rule) => {\n        const entityProps = _.pick(rule, [\n          'entityName',\n          'identifier',\n          'entity',\n        ]);\n        const found = _.find(result, entityProps);\n\n        if (found) {\n          found.rules.push(rule);\n        } else {\n          result.push({\n            ...entityProps,\n            rules: [rule],\n          });\n        }\n\n        return result;\n      }, []);\n\n      const firstEntityAbility = _.find(rulesPerEntity, {\n        entityName,\n        identifier,\n      });\n      const childAbilities = _.groupBy(\n        _.reject(rulesPerEntity, { entityName, identifier }),\n        'entityName',\n      );\n\n      const fuseChildAbilities = searchChildKey\n        ? _.mapValues(\n          childAbilities,\n          (childAbility) =>\n            new Fuse(childAbility, {\n              shouldSort: true,\n              threshold: 0.3,\n              location: 0,\n              distance: 100,\n              maxPatternLength: 32,\n              minMatchCharLength: 1,\n              keys: [searchChildKey],\n            }),\n        )\n        : null;\n\n      return {\n        ruleKeys,\n        firstEntityAbility,\n        childAbilities,\n        fuseChildAbilities,\n      };\n    }\n\n    return null;\n  }\n\n  componentDidMount() {\n    // calculate `indeterminate` props\n    const { rules, form, entityName, identifier } = this.props;\n\n    const {\n      mutators: { setFieldData },\n      batch,\n    } = form;\n    const formState = form.getState();\n    const allValues = formState.values;\n\n    const [firstEntityRules, otherRules] = _.partition(\n      rules,\n      _.matches({\n        entityName,\n        identifier,\n      }),\n    );\n\n    batch(() => {\n      for (const rule of firstEntityRules) {\n        const relatedRules = _.filter(\n          otherRules,\n          _.matches(_.pick(rule, 'actions', 'subject', 'conditions')),\n        );\n\n        setFieldData(rule.key, {\n          indeterminate: isIndeterminate(allValues, rule, relatedRules),\n        });\n      }\n    });\n  }\n\n  handleSearchChange = (e) => {\n    const { value } = e.target;\n\n    this.setState({ search: value });\n    this.debouncedSearch(value);\n  };\n\n  onFormValueChange = (formState) => {\n    const { entityName, identifier, rules, form } = this.props;\n    const {\n      mutators: { setFieldData },\n      batch,\n      getFieldState,\n    } = form;\n    const [firstEntityRules, otherRules] = _.partition(\n      rules,\n      _.matches({\n        entityName,\n        identifier,\n      }),\n    );\n\n    // calculate indeterminates\n    const indeterminates = firstEntityRules.reduce((result, rule) => {\n      const relatedRules = _.remove(\n        otherRules,\n        _.matches(_.pick(rule, 'actions', 'subject', 'conditions')),\n      );\n      const fieldState = getFieldState(rule.key);\n      const indeterminate = isIndeterminate(\n        formState.values,\n        rule,\n        relatedRules,\n      );\n\n      if (!!fieldState.data.indeterminate !== !!indeterminate) {\n        result[rule.key] = indeterminate;\n      }\n\n      return result;\n    }, {});\n\n    // set indeterminate prop for each field\n    batch(() => {\n      _.forEach(indeterminates, (indeterminate, key) =>\n        setFieldData(key, { indeterminate }));\n    });\n  };\n\n  render() {\n    const {\n      handleSubmit,\n      HeaderComponent,\n      searchChildKey,\n      filterInputPlaceholder,\n    } = this.props;\n    const {\n      firstEntityAbility,\n      childAbilities,\n      fuseChildAbilities,\n      search,\n      debouncedSearch,\n    } = this.state;\n\n    const saveButton = (\n      <FormSpy subscription={saveSubscription} component={SaveButton} />\n    );\n\n    const childAbilitiesLength = _.reduce(\n      childAbilities,\n      (result, value) => result + value.length,\n      0,\n    );\n\n    return (\n      <>\n        {HeaderComponent\n          ? React.createElement(HeaderComponent, { saveButton })\n          : null}\n\n        <Newsletter />\n\n        <form onSubmit={handleSubmit}>\n          {firstEntityAbility && firstEntityAbility.rules.length ? (\n            <div className=\"margin-bottom-sm\">\n              {Object.entries(_.groupBy(firstEntityAbility.rules, 'tag')).map(\n                ([key, rules]) => (\n                  <FirstEntityRule key={key} ruleName={key} rules={rules} />\n                ),\n              )}\n            </div>\n          ) : null}\n          {searchChildKey\n          && childAbilitiesLength >= MINLEN_REQUIRED_FOR_SEARCH ? (\n            <div className=\"margin-v-md\">\n              <FilterInput\n                value={search}\n                onChange={this.handleSearchChange}\n                placeholder={filterInputPlaceholder}\n              />\n            </div>\n            ) : null}\n\n          {Object.keys(childAbilities).map((name) => {\n            const abilities = fuseChildAbilities && debouncedSearch\n              ? fuseChildAbilities[name].search(debouncedSearch)\n              : childAbilities[name];\n\n            return (\n              <Collapse\n                key={name}\n                className=\"margin-bottom-md\"\n                abilities={abilities}\n              >\n                {abilities.map((entityAbility) => (\n                  <Collapse.Panel\n                    rules={entityAbility.rules}\n                    key={`${name}.${entityAbility.identifier}`}\n                    header={<b>{getEntityTitle(entityAbility)}</b>}\n                  >\n                    {Object.entries(_.groupBy(entityAbility.rules, 'tag')).map(\n                      ([key, rules]) => (\n                        <ChildEntityRule\n                          key={key}\n                          ruleName={key}\n                          rules={rules}\n                        />\n                      ),\n                    )}\n                  </Collapse.Panel>\n                ))}\n              </Collapse>\n            );\n          })}\n\n          {saveButton}\n\n          <FormSpy\n            subscription={changeSubscription}\n            onChange={this.onFormValueChange}\n          />\n        </form>\n      </>\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,EAAEC,WAAW,QAAQ,OAAO;AAC/D,OAAOC,EAAE,MAAM,IAAI;AAEnB,SAASC,OAAO,QAAQ,kBAAkB;AAC1C,OAAOC,QAAQ,MAAM,aAAa;AAClC,SAASC,cAAc,EAAEC,gBAAgB,EAAEC,OAAO,QAAQ,YAAY;AACtE,OAAOC,EAAE,MAAM,YAAY;AAC3B,OAAOC,IAAI,MAAM,SAAS;AAC1B,SAASC,OAAO,QAAQ,0BAA0B;AAClD,OAAOC,YAAY,MAAM,mBAAmB;AAC5C,OAAOC,eAAe,MAAM,sBAAsB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAEnD,MAAMC,0BAA0B,GAAG,CAAC;AAEpC,MAAMC,gBAAgB,GAAG;EACvBC,UAAU,EAAE,IAAI;EAChBC,QAAQ,EAAE,IAAI;EACdC,eAAe,EAAE;AACnB,CAAC;AAED,MAAMC,kBAAkB,GAAG;EAAEC,MAAM,EAAE,IAAI;EAAEC,IAAI,EAAE;AAAK,CAAC;AAEvD,MAAMC,mBAAmB,GAAGpB,cAAc,CAAC;EACzCqB,eAAe,EAAE;IACfC,EAAE,EAAE,uDAAuD;IAC3DC,cAAc,EAAE;EAClB,CAAC;EACDC,sBAAsB,EAAE;IACtBF,EAAE,EAAE,8DAA8D;IAClEC,cAAc,EAAE;EAClB,CAAC;EACDE,mBAAmB,EAAE;IACnBH,EAAE,EAAE,2DAA2D;IAC/DC,cAAc,EAAE;EAClB,CAAC;EACDG,sBAAsB,EAAE;IACtBJ,EAAE,EAAE,8DAA8D;IAClEC,cAAc,EAAE;EAClB,CAAC;EACDI,mBAAmB,EAAE;IACnBL,EAAE,EAAE,2DAA2D;IAC/DC,cAAc,EAAE;EAClB,CAAC;EACDK,MAAM,EAAE;IACNN,EAAE,EAAE,8CAA8C;IAClDC,cAAc,EAAE;EAClB,CAAC;EACDM,eAAe,EAAE;IACfP,EAAE,EAAE,uDAAuD;IAC3DC,cAAc,EAAE;EAClB,CAAC;EACDO,qBAAqB,EAAE;IACrBR,EAAE,EAAE,6DAA6D;IACjEC,cAAc,EACZ;EACJ,CAAC;EACDQ,mBAAmB,EAAE;IACnBT,EAAE,EAAE,2DAA2D;IAC/DC,cAAc,EAAE;EAClB,CAAC;EACDS,oBAAoB,EAAE;IACpBV,EAAE,EAAE,4DAA4D;IAChEC,cAAc,EACZ;EACJ;AACF,CAAC,CAAC;AAEF,SAASU,cAAcA,CAACC,OAAO,EAAE;EAC/B,QAAQA,OAAO,CAACC,UAAU;IACxB,KAAK,MAAM;MACT,OAAOD,OAAO,CAACE,MAAM,CAACC,QAAQ;IAChC,KAAK,QAAQ;MACX,OAAOH,OAAO,CAACE,MAAM,CAACE,KAAK;IAC7B,KAAK,QAAQ;MACX,OAAOJ,OAAO,CAACE,MAAM,CAACG,WAAW;IACnC;MACE,OAAOL,OAAO,CAACM,UAAU;EAC7B;AACF;AAEA,MAAMC,UAAU,GAAGA,CAAA,KAAM;EACvB,MAAMC,IAAI,GAAGxC,OAAO,CAAC,CAAC;EACtB,MAAM,CAACyC,UAAU,EAAEC,aAAa,CAAC,GAAGjD,QAAQ,CAAC,KAAK,CAAC;EAEnD,MAAMkD,SAAS,GAAGjD,WAAW,CAAC,MAAM;IAClCC,EAAE,CAACiD,IAAI,CAAC,uBAAuB,EAAE;MAAEC,IAAI,EAAE,CAAC;IAAE,CAAC,CAAC,CAACC,IAAI,CAAC,MAAM;MACxDJ,aAAa,CAAC,IAAI,CAAC;IACrB,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,oBACEnC,OAAA;IACEwC,SAAS,mCAAAC,MAAA,CAAmCP,UAAU,GAAG,UAAU,GAAG,EAAE,CAAG;IAAAQ,QAAA,gBAE3E1C,OAAA;MAAA0C,QAAA,EAAST,IAAI,CAACU,aAAa,CAAChC,mBAAmB,CAACS,eAAe;IAAC;MAAAwB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAS,CAAC,eAC1E/C,OAAA;MAAA0C,QAAA,EACGT,IAAI,CAACU,aAAa,CACjBhC,mBAAmB,CACjBuB,UAAU,GAAG,sBAAsB,GAAG,uBAAuB,CAEjE;IAAC;MAAAU,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC,EACLb,UAAU,GAAG,IAAI,gBAChBlC,OAAA;MACEgD,QAAQ,EAAEd,UAAW;MACrBe,OAAO,EAAEA,CAAA,KAAMb,SAAS,CAAC,CAAE;MAC3Bc,IAAI,EAAC,QAAQ;MACbV,SAAS,EAAC,6BAA6B;MAAAE,QAAA,EAEtCT,IAAI,CAACU,aAAa,CAAChC,mBAAmB,CAACW,mBAAmB;IAAC;MAAAsB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACtD,CACT;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACE,CAAC;AAEV,CAAC;AAED,MAAMI,WAAW,GAAGC,IAAA,IAAsC;EAAA,IAArC;IAAEC,KAAK;IAAEC,QAAQ;IAAEC;EAAY,CAAC,GAAAH,IAAA;EACnD,MAAMnB,IAAI,GAAGxC,OAAO,CAAC,CAAC;EAEtB,oBACEO,OAAA;IAAKwC,SAAS,EAAC,mBAAmB;IAAAE,QAAA,eAChC1C,OAAA;MAAKwC,SAAS,EAAC,kBAAkB;MAAAE,QAAA,gBAC/B1C,OAAA;QACEwD,IAAI,EAAC,QAAQ;QACbN,IAAI,EAAC,MAAM;QACXV,SAAS,EAAC,cAAc;QACxBa,KAAK,EAAEA,KAAM;QACbC,QAAQ,EAAEA,QAAS;QACnBC,WAAW,EAAEA;MAAY;QAAAX,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC1B,CAAC,eACF/C,OAAA;QAAQkD,IAAI,EAAC,QAAQ;QAACV,SAAS,EAAC,KAAK;QAAAE,QAAA,eACnC1C,OAAA;UACEwC,SAAS,EAAC,cAAc;UACxB,eAAY,MAAM;UAClB,cAAYP,IAAI,CAACU,aAAa,CAAChC,mBAAmB,CAACQ,MAAM;QAAE;UAAAyB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC5D;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACI,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAED,MAAMU,UAAU,GAAGC,KAAA;EAAA,IAAC;IAAEC,IAAI;IAAEtD,UAAU;IAAEC,QAAQ;IAAEC;EAAgB,CAAC,GAAAmD,KAAA;EAAA,oBACjE1D,OAAA;IACEkD,IAAI,EAAC,QAAQ;IACbD,OAAO,EAAEU,IAAI,CAACC,MAAO;IACrBpB,SAAS,EAAE9C,EAAE,CAAC,KAAK,EAAE;MACnB,aAAa,EAAE,CAACa,eAAe;MAC/B,aAAa,EAAEA;IACjB,CAAC,CAAE;IACHyC,QAAQ,EAAE3C,UAAU,IAAIC,QAAS;IAAAoC,QAAA,gBAEjC1C,OAAA,CAACR,gBAAgB;MAACqB,EAAE,EAAC,8BAA8B;MAACC,cAAc,EAAC;IAAM;MAAA8B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,EAE3E1C,UAAU,iBACTL,OAAA;MAAMwC,SAAS,EAAC,aAAa;MAAAE,QAAA,eAC3B1C,OAAA,CAACJ,OAAO;QAACiE,IAAI,EAAC;MAAQ;QAAAjB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACrB,CACP;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACK,CAAC;AAAA,CACV;AAED,MAAMe,eAAe,GAAGC,KAAA,IAAyB;EAAA,IAAxB;IAAEC,QAAQ;IAAEC;EAAM,CAAC,GAAAF,KAAA;EAC1C,MAAMG,aAAa,GAAGvD,mBAAmB,eAAA8B,MAAA,CAAe0B,WAAA,CAAaH,QAAQ,CAAC,EAAG;EAEjF,oBACEhE,OAAA;IAAA0C,QAAA,GACGwB,aAAa,gBACZlE,OAAA;MAAA0C,QAAA,eACE1C,OAAA,CAACR,gBAAgB,EAAA4E,aAAA,KAAKF,aAAa;QAAAtB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACtC,CAAC,GACF,IAAI,EAEPkB,KAAK,CAACI,GAAG,CAAEC,IAAI,iBACdtE,OAAA,CAACH,YAAY;MAAgByE,IAAI,EAAEA;IAAK,GAArBA,IAAI,CAACC,GAAG;MAAA3B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAe,CAC3C,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACC,CAAC;AAEV,CAAC;AAED,MAAMyB,eAAe,GAAGC,KAAA,IAAyB;EAAA,IAAxB;IAAET,QAAQ;IAAEC;EAAM,CAAC,GAAAQ,KAAA;EAC1C,MAAMP,aAAa,GAAGvD,mBAAmB,eAAA8B,MAAA,CAAe0B,WAAA,CAAaH,QAAQ,CAAC,EAAG;EAEjF,oBACEhE,OAAA;IAAA0C,QAAA,GACGwB,aAAa,gBACZlE,OAAA;MAAA0C,QAAA,eACE1C,OAAA,CAACR,gBAAgB,EAAA4E,aAAA,KAAKF,aAAa;QAAAtB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACtC,CAAC,GACF,IAAI,EAEPkB,KAAK,CAACI,GAAG,CAAEC,IAAI,iBACdtE,OAAA,CAACH,YAAY;MAAgByE,IAAI,EAAEA;IAAK,GAArBA,IAAI,CAACC,GAAG;MAAA3B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAe,CAC3C,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACC,CAAC;AAEV,CAAC;AAED,eAAe,MAAM2B,aAAa,SAASzF,SAAS,CAAC;EAcnD0F,WAAWA,CAACC,KAAK,EAAE;IACjB,KAAK,CAACA,KAAK,CAAC;IAACC,eAAA,0BALGC,SAAA,CAAYzB,KAAK,IAAK;MACtC,IAAI,CAAC0B,QAAQ,CAAC;QAAEC,eAAe,EAAE3B;MAAM,CAAC,CAAC;IAC3C,CAAC,EAAE,GAAG,CAAC;IAAAwB,eAAA,6BA4GeI,CAAC,IAAK;MAC1B,MAAM;QAAE5B;MAAM,CAAC,GAAG4B,CAAC,CAACC,MAAM;MAE1B,IAAI,CAACH,QAAQ,CAAC;QAAE5D,MAAM,EAAEkC;MAAM,CAAC,CAAC;MAChC,IAAI,CAAC2B,eAAe,CAAC3B,KAAK,CAAC;IAC7B,CAAC;IAAAwB,eAAA,4BAEoBM,SAAS,IAAK;MACjC,MAAM;QAAEzD,UAAU;QAAEK,UAAU;QAAEkC,KAAK;QAAEN;MAAK,CAAC,GAAG,IAAI,CAACiB,KAAK;MAC1D,MAAM;QACJQ,QAAQ,EAAE;UAAEC;QAAa,CAAC;QAC1BC,KAAK;QACLC;MACF,CAAC,GAAG5B,IAAI;MACR,MAAM,CAAC6B,gBAAgB,EAAEC,UAAU,CAAC,GAAGC,UAAA,CACrCzB,KAAK,EACL0B,QAAA,CAAU;QACRjE,UAAU;QACVK;MACF,CAAC,CACH,CAAC;;MAED;MACA,MAAM6D,cAAc,GAAGC,uBAAA,CAAAL,gBAAgB,EAAAM,IAAA,CAAhBN,gBAAgB,EAAQ,CAACO,MAAM,EAAEzB,IAAI,KAAK;QAC/D,MAAM0B,YAAY,GAAGC,OAAA,CACnBR,UAAU,EACVE,QAAA,CAAUO,KAAA,CAAO5B,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,YAAY,CAAC,CAC5D,CAAC;QACD,MAAM6B,UAAU,GAAGZ,aAAa,CAACjB,IAAI,CAACC,GAAG,CAAC;QAC1C,MAAM6B,aAAa,GAAGtG,eAAe,CAAAuG,uBAAA,CACnClB,SAAS,GACTb,IAAI,EACJ0B,YACF,CAAC;QAED,IAAI,CAAC,CAACG,UAAU,CAACzF,IAAI,CAAC0F,aAAa,KAAK,CAAC,CAACA,aAAa,EAAE;UACvDL,MAAM,CAACzB,IAAI,CAACC,GAAG,CAAC,GAAG6B,aAAa;QAClC;QAEA,OAAOL,MAAM;MACf,CAAC,EAAE,CAAC,CAAC,CAAC;;MAEN;MACAT,KAAK,CAAC,MAAM;QACVgB,QAAA,CAAUV,cAAc,EAAE,CAACQ,aAAa,EAAE7B,GAAG,KAC3Cc,YAAY,CAACd,GAAG,EAAE;UAAE6B;QAAc,CAAC,CAAC,CAAC;MACzC,CAAC,CAAC;IACJ,CAAC;IAtJC,IAAI,CAACG,KAAK,GAAG;MACXC,QAAQ,EAAE,IAAI;MACdC,kBAAkB,EAAE,IAAI;MACxBC,cAAc,EAAE,IAAI;MACpBvF,MAAM,EAAE,EAAE;MACV6D,eAAe,EAAE;IACnB,CAAC;EACH;EAEA,OAAO2B,wBAAwBA,CAACC,SAAS,EAAEC,SAAS,EAAE;IACpD,MAAM;MAAEnF,UAAU;MAAEK,UAAU;MAAEkC,KAAK;MAAE6C;IAAe,CAAC,GAAGF,SAAS;IACnE,MAAMJ,QAAQ,GAAGvC,KAAK,CAACI,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,GAAG,CAAC;IAE9C,IAAI,CAACwC,QAAA,CAAUF,SAAS,CAACL,QAAQ,EAAEA,QAAQ,CAAC,EAAE;MAC5C,MAAMQ,cAAc,GAAGnB,uBAAA,CAAA5B,KAAK,EAAA6B,IAAA,CAAL7B,KAAK,EAAQ,CAAC8B,MAAM,EAAEzB,IAAI,KAAK;QACpD,MAAM2C,WAAW,GAAGf,KAAA,CAAO5B,IAAI,EAAE,CAC/B,YAAY,EACZ,YAAY,EACZ,QAAQ,CACT,CAAC;QACF,MAAM4C,KAAK,GAAGC,KAAA,CAAOpB,MAAM,EAAEkB,WAAW,CAAC;QAEzC,IAAIC,KAAK,EAAE;UACTA,KAAK,CAACjD,KAAK,CAACmD,IAAI,CAAC9C,IAAI,CAAC;QACxB,CAAC,MAAM;UACLyB,MAAM,CAACqB,IAAI,CAAAhD,aAAA,CAAAA,aAAA,KACN6C,WAAW;YACdhD,KAAK,EAAE,CAACK,IAAI;UAAC,EACd,CAAC;QACJ;QAEA,OAAOyB,MAAM;MACf,CAAC,EAAE,EAAE,CAAC;MAEN,MAAMU,kBAAkB,GAAGU,KAAA,CAAOH,cAAc,EAAE;QAChDtF,UAAU;QACVK;MACF,CAAC,CAAC;MACF,MAAM2E,cAAc,GAAGW,QAAA,CACrBC,OAAA,CAASN,cAAc,EAAE;QAAEtF,UAAU;QAAEK;MAAW,CAAC,CAAC,EACpD,YACF,CAAC;MAED,MAAMwF,kBAAkB,GAAGT,cAAc,GACrCU,UAAA,CACAd,cAAc,EACbe,YAAY,IACX,IAAI9H,IAAI,CAAC8H,YAAY,EAAE;QACrBC,UAAU,EAAE,IAAI;QAChBC,SAAS,EAAE,GAAG;QACdC,QAAQ,EAAE,CAAC;QACXC,QAAQ,EAAE,GAAG;QACbC,gBAAgB,EAAE,EAAE;QACpBC,kBAAkB,EAAE,CAAC;QACrBC,IAAI,EAAE,CAAClB,cAAc;MACvB,CAAC,CACL,CAAC,GACC,IAAI;MAER,OAAO;QACLN,QAAQ;QACRC,kBAAkB;QAClBC,cAAc;QACda;MACF,CAAC;IACH;IAEA,OAAO,IAAI;EACb;EAEAU,iBAAiBA,CAAA,EAAG;IAClB;IACA,MAAM;MAAEhE,KAAK;MAAEN,IAAI;MAAEjC,UAAU;MAAEK;IAAW,CAAC,GAAG,IAAI,CAAC6C,KAAK;IAE1D,MAAM;MACJQ,QAAQ,EAAE;QAAEC;MAAa,CAAC;MAC1BC;IACF,CAAC,GAAG3B,IAAI;IACR,MAAMwB,SAAS,GAAGxB,IAAI,CAACuE,QAAQ,CAAC,CAAC;IACjC,MAAMC,SAAS,GAAA9B,uBAAA,CAAGlB,SAAS,CAAO;IAElC,MAAM,CAACK,gBAAgB,EAAEC,UAAU,CAAC,GAAGC,UAAA,CACrCzB,KAAK,EACL0B,QAAA,CAAU;MACRjE,UAAU;MACVK;IACF,CAAC,CACH,CAAC;IAEDuD,KAAK,CAAC,MAAM;MACV,KAAK,MAAMhB,IAAI,IAAIkB,gBAAgB,EAAE;QACnC,MAAMQ,YAAY,GAAGoC,OAAA,CACnB3C,UAAU,EACVE,QAAA,CAAUO,KAAA,CAAO5B,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,YAAY,CAAC,CAC5D,CAAC;QAEDe,YAAY,CAACf,IAAI,CAACC,GAAG,EAAE;UACrB6B,aAAa,EAAEtG,eAAe,CAACqI,SAAS,EAAE7D,IAAI,EAAE0B,YAAY;QAC9D,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;EACJ;EAmDAqC,MAAMA,CAAA,EAAG;IACP,MAAM;MACJC,YAAY;MACZC,eAAe;MACfzB,cAAc;MACd0B;IACF,CAAC,GAAG,IAAI,CAAC5D,KAAK;IACd,MAAM;MACJ6B,kBAAkB;MAClBC,cAAc;MACda,kBAAkB;MAClBpG,MAAM;MACN6D;IACF,CAAC,GAAG,IAAI,CAACuB,KAAK;IAEd,MAAMkC,UAAU,gBACdzI,OAAA,CAACX,OAAO;MAACqJ,YAAY,EAAEtI,gBAAiB;MAACuI,SAAS,EAAElF;IAAW;MAAAb,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAClE;IAED,MAAM6F,oBAAoB,GAAGC,OAAA,CAC3BnC,cAAc,EACd,CAACX,MAAM,EAAE1C,KAAK,KAAK0C,MAAM,GAAG1C,KAAK,CAACyF,MAAM,EACxC,CACF,CAAC;IAED,oBACE9I,OAAA,CAAAE,SAAA;MAAAwC,QAAA,GACG6F,eAAe,gBACZvJ,KAAK,CAAC+J,aAAa,CAACR,eAAe,EAAE;QAAEE;MAAW,CAAC,CAAC,GACpD,IAAI,eAERzI,OAAA,CAACgC,UAAU;QAAAY,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eAEd/C,OAAA;QAAMgJ,QAAQ,EAAEV,YAAa;QAAA5F,QAAA,GAC1B+D,kBAAkB,IAAIA,kBAAkB,CAACxC,KAAK,CAAC6E,MAAM,gBACpD9I,OAAA;UAAKwC,SAAS,EAAC,kBAAkB;UAAAE,QAAA,EAC9BuG,MAAM,CAACC,OAAO,CAAC7B,QAAA,CAAUZ,kBAAkB,CAACxC,KAAK,EAAE,KAAK,CAAC,CAAC,CAACI,GAAG,CAC7D8E,KAAA;YAAA,IAAC,CAAC5E,GAAG,EAAEN,KAAK,CAAC,GAAAkF,KAAA;YAAA,oBACXnJ,OAAA,CAAC8D,eAAe;cAAWE,QAAQ,EAAEO,GAAI;cAACN,KAAK,EAAEA;YAAM,GAAjCM,GAAG;cAAA3B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAgC,CAAC;UAAA,CAE9D;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC,GACJ,IAAI,EACP+D,cAAc,IACZ8B,oBAAoB,IAAIzI,0BAA0B,gBACnDH,OAAA;UAAKwC,SAAS,EAAC,aAAa;UAAAE,QAAA,eAC1B1C,OAAA,CAACmD,WAAW;YACVE,KAAK,EAAElC,MAAO;YACdmC,QAAQ,EAAE,IAAI,CAAC8F,kBAAmB;YAClC7F,WAAW,EAAEiF;UAAuB;YAAA5F,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACrC;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACC,CAAC,GACF,IAAI,EAETkG,MAAM,CAACjB,IAAI,CAACtB,cAAc,CAAC,CAACrC,GAAG,CAAEb,IAAI,IAAK;UACzC,MAAM6F,SAAS,GAAG9B,kBAAkB,IAAIvC,eAAe,GACnDuC,kBAAkB,CAAC/D,IAAI,CAAC,CAACrC,MAAM,CAAC6D,eAAe,CAAC,GAChD0B,cAAc,CAAClD,IAAI,CAAC;UAExB,oBACExD,OAAA,CAACV,QAAQ;YAEPkD,SAAS,EAAC,kBAAkB;YAC5B6G,SAAS,EAAEA,SAAU;YAAA3G,QAAA,EAEpB2G,SAAS,CAAChF,GAAG,CAAEiF,aAAa,iBAC3BtJ,OAAA,CAACV,QAAQ,CAACiK,KAAK;cACbtF,KAAK,EAAEqF,aAAa,CAACrF,KAAM;cAE3BuF,MAAM,eAAExJ,OAAA;gBAAA0C,QAAA,EAAIlB,cAAc,CAAC8H,aAAa;cAAC;gBAAA1G,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAAE;cAAAL,QAAA,EAE9CuG,MAAM,CAACC,OAAO,CAAC7B,QAAA,CAAUiC,aAAa,CAACrF,KAAK,EAAE,KAAK,CAAC,CAAC,CAACI,GAAG,CACxDoF,KAAA;gBAAA,IAAC,CAAClF,GAAG,EAAEN,KAAK,CAAC,GAAAwF,KAAA;gBAAA,oBACXzJ,OAAA,CAACwE,eAAe;kBAEdR,QAAQ,EAAEO,GAAI;kBACdN,KAAK,EAAEA;gBAAM,GAFRM,GAAG;kBAAA3B,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAGT,CAAC;cAAA,CAEN;YAAC,MAAAN,MAAA,CAXOe,IAAI,OAAAf,MAAA,CAAI6G,aAAa,CAACvH,UAAU;cAAAa,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAY1B,CACjB;UAAC,GApBGS,IAAI;YAAAZ,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAqBD,CAAC;QAEf,CAAC,CAAC,EAED0F,UAAU,eAEXzI,OAAA,CAACX,OAAO;UACNqJ,YAAY,EAAElI,kBAAmB;UACjC8C,QAAQ,EAAE,IAAI,CAACoG;QAAkB;UAAA9G,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClC,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC;IAAA,eACP,CAAC;EAEP;AACF;AAAC8B,eAAA,CAzQoBH,aAAa,kBACV;EACpBT,KAAK,EAAE,IAAI;EACXN,IAAI,EAAE,IAAI;EACV2E,YAAY,EAAE,IAAI;EAClBC,eAAe,EAAE,IAAI;EACrBzB,cAAc,EAAE,IAAI;EACpB0B,sBAAsB,EAAE;AAC1B,CAAC","ignoreList":[]}