{"version":3,"sources":["../src/components/Events/Selection.js"],"sourcesContent":["import qs from 'qs';\nimport { useEffect, useState, useCallback } from 'react';\nimport { Spinner } from '@openagenda/react-shared';\nimport { useIntl } from 'react-intl';\nimport EventItem from './EventItem.js';\nimport messages from './messages.js';\nimport includeFields from './includeFields.json';\n\nexport default function Selection({ res, value, lang, onChange }) {\n  const [events, setEvents] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [errored, setErrored] = useState(false);\n  const m = useIntl().formatMessage;\n\n  useEffect(() => {\n    const identifiers = [].concat(value).filter((v) => !!v);\n\n    if (!identifiers.length) {\n      return;\n    }\n    setIsLoading(true);\n\n    fetch(\n      `${res}?${qs.stringify({\n        uid: identifiers,\n        state: [0, 1, 2],\n        includeFields,\n      })}`,\n    ).then((r) => {\n      setIsLoading(false);\n      if (!r.ok) {\n        setErrored(true);\n        return;\n      }\n      r.json().then((data) => {\n        setEvents(data.events);\n      });\n    });\n  }, [res, value]);\n\n  const onRemove = useCallback(\n    (uidToRemove) => {\n      const filteredSelection = events.filter((e) => e.uid !== uidToRemove);\n      setEvents(filteredSelection);\n      onChange(filteredSelection.map((e) => e.uid));\n    },\n    [events, onChange],\n  );\n\n  if (isLoading) {\n    return <Spinner />;\n  }\n\n  if (errored) {\n    return <p>{m(messages.loadError)}</p>;\n  }\n\n  if (!events.length) {\n    return (\n      <div className=\"padding-all-md text-center\">\n        {m(messages.emptySelection)}\n      </div>\n    );\n  }\n\n  return (\n    <ul className=\"list-unstyled\">\n      {events.map((event) => (\n        <li className=\"margin-v-sm\" key={`selected-event-${event.uid}`}>\n          <EventItem event={event} lang={lang}>\n            <a\n              href={`/events/${event.slug}`}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"btn btn-link padding-all-z margin-right-sm\"\n            >\n              {m(messages.show)}\n            </a>\n            <button\n              type=\"button\"\n              className=\"btn btn-link padding-all-z text-danger\"\n              onClick={() => onRemove(event.uid)}\n            >\n              {m(messages.remove)}\n            </button>\n          </EventItem>\n        </li>\n      ))}\n    </ul>\n  );\n}\n"],"mappings":";;;;;;;;;;;AAAA,OAAO,QAAQ;AACf,SAAS,WAAW,UAAU,mBAAmB;AACjD,SAAS,eAAe;AACxB,SAAS,eAAe;AA+Cb,cAmBD,YAnBC;AA1CI,SAAR,UAA2B,EAAE,KAAK,OAAO,MAAM,SAAS,GAAG;AAChE,QAAM,CAAC,QAAQ,SAAS,IAAI,SAAS,CAAC,CAAC;AACvC,QAAM,CAAC,WAAW,YAAY,IAAI,SAAS,KAAK;AAChD,QAAM,CAAC,SAAS,UAAU,IAAI,SAAS,KAAK;AAC5C,QAAM,IAAI,QAAQ,EAAE;AAEpB,YAAU,MAAM;AACd,UAAM,cAAc,CAAC,EAAE,OAAO,KAAK,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;AAEtD,QAAI,CAAC,YAAY,QAAQ;AACvB;AAAA,IACF;AACA,iBAAa,IAAI;AAEjB;AAAA,MACE,GAAG,GAAG,IAAI,GAAG,UAAU;AAAA,QACrB,KAAK;AAAA,QACL,OAAO,CAAC,GAAG,GAAG,CAAC;AAAA,QACf;AAAA,MACF,CAAC,CAAC;AAAA,IACJ,EAAE,KAAK,CAAC,MAAM;AACZ,mBAAa,KAAK;AAClB,UAAI,CAAC,EAAE,IAAI;AACT,mBAAW,IAAI;AACf;AAAA,MACF;AACA,QAAE,KAAK,EAAE,KAAK,CAAC,SAAS;AACtB,kBAAU,KAAK,MAAM;AAAA,MACvB,CAAC;AAAA,IACH,CAAC;AAAA,EACH,GAAG,CAAC,KAAK,KAAK,CAAC;AAEf,QAAM,WAAW;AAAA,IACf,CAAC,gBAAgB;AACf,YAAM,oBAAoB,OAAO,OAAO,CAAC,MAAM,EAAE,QAAQ,WAAW;AACpE,gBAAU,iBAAiB;AAC3B,eAAS,kBAAkB,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC;AAAA,IAC9C;AAAA,IACA,CAAC,QAAQ,QAAQ;AAAA,EACnB;AAEA,MAAI,WAAW;AACb,WAAO,oBAAC,WAAQ;AAAA,EAClB;AAEA,MAAI,SAAS;AACX,WAAO,oBAAC,OAAG,YAAE,iBAAS,SAAS,GAAE;AAAA,EACnC;AAEA,MAAI,CAAC,OAAO,QAAQ;AAClB,WACE,oBAAC,SAAI,WAAU,8BACZ,YAAE,iBAAS,cAAc,GAC5B;AAAA,EAEJ;AAEA,SACE,oBAAC,QAAG,WAAU,iBACX,iBAAO,IAAI,CAAC,UACX,oBAAC,QAAG,WAAU,eACZ,+BAAC,aAAU,OAAc,MACvB;AAAA;AAAA,MAAC;AAAA;AAAA,QACC,MAAM,WAAW,MAAM,IAAI;AAAA,QAC3B,QAAO;AAAA,QACP,KAAI;AAAA,QACJ,WAAU;AAAA,QAET,YAAE,iBAAS,IAAI;AAAA;AAAA,IAClB;AAAA,IACA;AAAA,MAAC;AAAA;AAAA,QACC,MAAK;AAAA,QACL,WAAU;AAAA,QACV,SAAS,MAAM,SAAS,MAAM,GAAG;AAAA,QAEhC,YAAE,iBAAS,MAAM;AAAA;AAAA,IACpB;AAAA,KACF,KAjB+B,kBAAkB,MAAM,GAAG,EAkB5D,CACD,GACH;AAEJ;","names":[]}