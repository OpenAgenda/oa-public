{"version":3,"sources":["../src/components/Timings.js"],"sourcesContent":["import _ from 'lodash';\nimport { Component } from 'react';\nimport TimingsPicker, { classNames } from '@openagenda/react-timingspicker';\nimport { convertTimezoneOffset, fZ } from '../utils/time.js';\n\n// safari requires timezone\nfunction safariTimezone({ date, hours, minutes }) {\n  return convertTimezoneOffset(\n    new Date(`${date}T${hours}:${minutes}`).getTimezoneOffset() / 60,\n  );\n}\n\nfunction loadTimings(props) {\n  return (props.value || _.get(props, 'field.default') || []).map((t) => ({\n    begin: new Date(\n      `${t.begin.date}T${t.begin.hours}:${t.begin.minutes}${safariTimezone(t.begin)}`,\n    ),\n    end: new Date(\n      `${t.end.date}T${t.end.hours}:${t.end.minutes}${safariTimezone(t.end)}`,\n    ),\n  }));\n}\n\nfunction extractDateString(d) {\n  return [d.getFullYear(), fZ(d.getMonth() + 1), fZ(d.getDate())].join('-');\n}\n\nexport default class TimingsComponent extends Component {\n  static defaultProps = {\n    value: null,\n    field: {},\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      value: null,\n    };\n  }\n\n  static getDerivedStateFromProps(props) {\n    const partialState = {\n      lang: props.lang,\n    };\n\n    partialState.value = loadTimings(props);\n\n    partialState.allowedTimings = _.get(props, 'field.enabledRanges')\n      ? props.field.enabledRanges.map((v) => ({\n        begin: v.begin,\n        end: v.end.includes('T') ? v.end : `${v.end}T23:59:59.999`,\n      }))\n      : null;\n\n    return partialState;\n  }\n\n  onTimingsChange = (timings = [], beginKey = 'begin') => {\n    this.props.onChange(\n      timings.map((t) => ({\n        begin: {\n          date: extractDateString(t[beginKey]),\n          hours: fZ(t[beginKey].getHours()),\n          minutes: fZ(t[beginKey].getMinutes()),\n        },\n        end: {\n          date: extractDateString(t.end),\n          hours: fZ(t.end.getHours()),\n          minutes: fZ(t.end.getMinutes()),\n        },\n      })),\n    );\n  };\n\n  render() {\n    const { value, lang, allowedTimings } = this.state;\n\n    return (\n      <TimingsPicker\n        onChange={this.onTimingsChange}\n        value={value}\n        locale={lang}\n        weekStartsOn={1}\n        allowedTimings={allowedTimings}\n        classNames={classNames.bootstrap3}\n      />\n    );\n  }\n}\n"],"mappings":";;;;;;AAAA,OAAO,OAAO;AACd,SAAS,iBAAiB;AAC1B,OAAO,iBAAiB,kBAAkB;AA6EpC;AAzEN,SAAS,eAAe,EAAE,MAAM,OAAO,QAAQ,GAAG;AAChD,SAAO;AAAA,KACL,oBAAI,KAAK,GAAG,IAAI,IAAI,KAAK,IAAI,OAAO,EAAE,GAAE,kBAAkB,IAAI;AAAA,EAChE;AACF;AAEA,SAAS,YAAY,OAAO;AAC1B,UAAQ,MAAM,SAAS,EAAE,IAAI,OAAO,eAAe,KAAK,CAAC,GAAG,IAAI,CAAC,OAAO;AAAA,IACtE,OAAO,oBAAI;AAAA,MACT,GAAG,EAAE,MAAM,IAAI,IAAI,EAAE,MAAM,KAAK,IAAI,EAAE,MAAM,OAAO,GAAG,eAAe,EAAE,KAAK,CAAC;AAAA,IAC/E;AAAA,IACA,KAAK,oBAAI;AAAA,MACP,GAAG,EAAE,IAAI,IAAI,IAAI,EAAE,IAAI,KAAK,IAAI,EAAE,IAAI,OAAO,GAAG,eAAe,EAAE,GAAG,CAAC;AAAA,IACvE;AAAA,EACF,EAAE;AACJ;AAEA,SAAS,kBAAkB,GAAG;AAC5B,SAAO,CAAC,EAAE,YAAY,GAAG,GAAG,EAAE,SAAS,IAAI,CAAC,GAAG,GAAG,EAAE,QAAQ,CAAC,CAAC,EAAE,KAAK,GAAG;AAC1E;AAEA,IAAqB,mBAArB,cAA8C,UAAU;AAAA,EACtD,OAAO,eAAe;AAAA,IACpB,OAAO;AAAA,IACP,OAAO,CAAC;AAAA,EACV;AAAA,EAEA,YAAY,OAAO;AACjB,UAAM,KAAK;AAEX,SAAK,QAAQ;AAAA,MACX,OAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEA,OAAO,yBAAyB,OAAO;AACrC,UAAM,eAAe;AAAA,MACnB,MAAM,MAAM;AAAA,IACd;AAEA,iBAAa,QAAQ,YAAY,KAAK;AAEtC,iBAAa,iBAAiB,EAAE,IAAI,OAAO,qBAAqB,IAC5D,MAAM,MAAM,cAAc,IAAI,CAAC,OAAO;AAAA,MACtC,OAAO,EAAE;AAAA,MACT,KAAK,EAAE,IAAI,SAAS,GAAG,IAAI,EAAE,MAAM,GAAG,EAAE,GAAG;AAAA,IAC7C,EAAE,IACA;AAEJ,WAAO;AAAA,EACT;AAAA,EAEA,kBAAkB,CAAC,UAAU,CAAC,GAAG,WAAW,YAAY;AACtD,SAAK,MAAM;AAAA,MACT,QAAQ,IAAI,CAAC,OAAO;AAAA,QAClB,OAAO;AAAA,UACL,MAAM,kBAAkB,EAAE,QAAQ,CAAC;AAAA,UACnC,OAAO,GAAG,EAAE,QAAQ,EAAE,SAAS,CAAC;AAAA,UAChC,SAAS,GAAG,EAAE,QAAQ,EAAE,WAAW,CAAC;AAAA,QACtC;AAAA,QACA,KAAK;AAAA,UACH,MAAM,kBAAkB,EAAE,GAAG;AAAA,UAC7B,OAAO,GAAG,EAAE,IAAI,SAAS,CAAC;AAAA,UAC1B,SAAS,GAAG,EAAE,IAAI,WAAW,CAAC;AAAA,QAChC;AAAA,MACF,EAAE;AAAA,IACJ;AAAA,EACF;AAAA,EAEA,SAAS;AACP,UAAM,EAAE,OAAO,MAAM,eAAe,IAAI,KAAK;AAE7C,WACE;AAAA,MAAC;AAAA;AAAA,QACC,UAAU,KAAK;AAAA,QACf;AAAA,QACA,QAAQ;AAAA,QACR,cAAc;AAAA,QACd;AAAA,QACA,YAAY,WAAW;AAAA;AAAA,IACzB;AAAA,EAEJ;AACF;","names":[]}