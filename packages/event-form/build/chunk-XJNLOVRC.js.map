{"version":3,"sources":["../src/components/Events/Add.js"],"sourcesContent":["import { useCallback, useEffect, useState, createRef } from 'react';\nimport { useDebounce } from 'use-debounce';\nimport cn from 'classnames';\nimport qs from 'qs';\nimport { Spinner } from '@openagenda/react-shared';\nimport { useIntl } from 'react-intl';\nimport EventItem from './EventItem.js';\nimport messages from './messages.js';\nimport includeFields from './includeFields.json';\n\nexport default function Add({ res, value, lang, onChange }) {\n  const [searchString, setSearchString] = useState('');\n  const [userHasSearched, setUserHasSearched] = useState(false);\n  const [searchResult, setSearchResult] = useState(undefined);\n  const [debouncedSearch] = useDebounce(searchString, 1000);\n  const [isLoading, setIsLoading] = useState(false);\n  const [errored, setErrored] = useState(false);\n  const [displayDropdown, setDisplayDropdown] = useState(false);\n  const m = useIntl().formatMessage;\n\n  useEffect(() => {\n    if (!userHasSearched) {\n      return;\n    }\n    setIsLoading(true);\n    fetch(\n      `${res}?${qs.stringify({\n        search: debouncedSearch,\n        state: [0, 1, 2],\n        relative: ['current', 'upcoming'],\n        includeFields,\n      })}`,\n    ).then((response) => {\n      setIsLoading(false);\n      if (!response.ok) {\n        setErrored(true);\n        return;\n      }\n      setDisplayDropdown(true);\n      response.json().then(setSearchResult);\n    });\n  }, [debouncedSearch, res, userHasSearched]);\n\n  const onSearchChange = useCallback(\n    (e) => {\n      setSearchString(e.target.value);\n      if (!userHasSearched && e.target.value?.length) {\n        setUserHasSearched(true);\n      }\n    },\n    [userHasSearched],\n  );\n\n  const ref = createRef();\n\n  useEffect(() => {\n    function handleClickOutside(event) {\n      if (ref.current && !ref.current.contains(event.target)) {\n        setDisplayDropdown(false);\n      }\n    }\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [ref]);\n\n  if (errored) {\n    return <p>{m(messages.loadError)}</p>;\n  }\n\n  return (\n    <div className={cn('dropdown', { open: displayDropdown })}>\n      <div className=\"input-group\">\n        <label className=\"sr-only\" htmlFor=\"search\">\n          {m(messages.searchEvents)}\n        </label>\n        <input\n          id=\"search\"\n          type=\"text\"\n          className=\"form-control\"\n          placeholder={m(messages.searchEvents)}\n          autoComplete=\"off\"\n          onChange={onSearchChange}\n        />\n        <span className=\"input-group-btn\">\n          <button\n            className=\"btn btn-default\"\n            type=\"button\"\n            aria-label={m(messages.search)}\n          >\n            <i\n              className=\"fa fa-search\"\n              aria-hidden=\"true\"\n              style={{ display: 'block', height: '20px', paddingTop: '4px' }}\n            />\n          </button>\n        </span>\n      </div>\n      {isLoading ? <Spinner /> : null}\n      {displayDropdown ? (\n        <ul ref={ref} className=\"dropdown-menu\">\n          {!(searchResult?.events ?? []).length ? (\n            <li className=\"padding-v-sm\" key=\"search-result-empty\">\n              <div className=\"media text-center disabled\">\n                {m(messages.noResult)}\n              </div>\n            </li>\n          ) : null}\n          {(searchResult?.events ?? []).map((event) => (\n            <li className=\"padding-v-sm\" key={`search-result-${event.uid}`}>\n              <div className=\"media\">\n                <button\n                  type=\"button\"\n                  className=\"btn btn-link btn-block\"\n                  onClick={() => {\n                    onChange((value ?? []).concat(event.uid));\n                    setDisplayDropdown(false);\n                  }}\n                  disabled={(value ?? []).includes(event.uid)}\n                >\n                  <EventItem lang={lang} event={event} />\n                </button>\n              </div>\n            </li>\n          ))}\n        </ul>\n      ) : null}\n    </div>\n  );\n}\n"],"mappings":"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","names":[]}