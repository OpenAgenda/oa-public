{"version":3,"sources":["../src/components/Languages.js"],"sourcesContent":["import _ from 'lodash';\nimport { Component } from 'react';\nimport Select from 'react-select';\nimport languages from 'languages';\n\nimport flattenLabels from '@openagenda/labels/flatten.js';\nimport languageLabels from '@openagenda/labels/event/form.js';\nimport { a11yButtonActionHandler } from '@openagenda/react-shared';\n\nimport languageCodesAndLabels from '../utils/languageCodesAndLabels.js';\nimport showRemoveAction from '../utils/showRemoveAction.js';\n\nexport default class Languages extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      adding: false,\n      changing: false,\n    };\n\n    this.onChangeStart = this.onChangeStart.bind(this);\n    this.onAddSelectStart = this.onAddSelectStart.bind(this);\n    this.onAdd = this.onAdd.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.onCancelChange = this.onCancelChange.bind(this);\n  }\n\n  onAddSelectStart() {\n    this.setState({ adding: true });\n  }\n\n  onChangeStart() {\n    const { value } = this.props;\n    if (value.length !== 1) return;\n\n    this.setState({ changing: true });\n  }\n\n  onChange(l) {\n    const { onChange } = this.props;\n\n    onChange([l.value]);\n\n    this.setState({ changing: false });\n  }\n\n  onCancelChange() {\n    this.setState({ changing: false });\n  }\n\n  onRemove(l) {\n    const { onChange, value } = this.props;\n    onChange(value.filter((current) => current !== l));\n  }\n\n  onAdd(l) {\n    const { onChange, value } = this.props;\n    onChange(value.concat(l.value));\n\n    this.setState({ adding: false });\n  }\n\n  getRemainingLanguages() {\n    const { value } = this.props;\n    return languageCodesAndLabels.filter((l) => !value.includes(l.value));\n  }\n\n  render() {\n    const { value, lang, field } = this.props;\n\n    const { changing, adding } = this.state;\n\n    const pickedLanguages = value;\n\n    const labels = flattenLabels(languageLabels, lang);\n\n    const { strict, required } = field;\n\n    return (\n      <div className=\"language-bar\">\n        {!changing ? (\n          <ul>\n            {pickedLanguages.map((l) => (\n              <li\n                key={`language-${l}`}\n                role=\"presentation\"\n                onClick={a11yButtonActionHandler(this.onChangeStart)}\n                onKeyPress={a11yButtonActionHandler(this.onChangeStart)}\n              >\n                <div className=\"language-item\">\n                  <span>{languages.getLanguageInfo(l).nativeName}</span>\n                  {showRemoveAction(\n                    { strict, pickedLanguages, required },\n                    l,\n                  ) ? (\n                    <span\n                      role=\"button\"\n                      tabIndex=\"0\"\n                      className=\"remove\"\n                      onClick={a11yButtonActionHandler(\n                        this.onRemove.bind(this, l),\n                      )}\n                      onKeyPress={a11yButtonActionHandler(\n                        this.onRemove.bind(this, l),\n                      )}\n                    >\n                      &#10005;\n                    </span>\n                    ) : null}\n                  {!strict && pickedLanguages.length === 1 ? (\n                    <span className=\"margin-right-xs\">\n                      <i className=\"fa fa-angle-down\" />\n                    </span>\n                  ) : null}\n                </div>\n              </li>\n            ))}\n          </ul>\n        ) : null}\n        {!strict && !adding && !changing ? (\n          <span className=\"language-add\">\n            {/* eslint-disable-next-line */}\n            <a onClick={this.onAddSelectStart}>{labels.addLanguage}</a>\n          </span>\n        ) : null}\n        {adding && (\n          <span className=\"language-add\">\n            <Select\n              placeholder={labels.selectLanguage}\n              options={this.getRemainingLanguages()}\n              onChange={this.onAdd}\n              classNamePrefix=\"language-select\"\n              clearable={false}\n            />\n          </span>\n        )}\n        {changing && (\n          <Select\n            placeholder={labels.selectLanguage}\n            value={_.first(\n              languageCodesAndLabels.filter(\n                (c) => _.first(pickedLanguages) === c.value,\n              ),\n            )}\n            options={this.getRemainingLanguages()}\n            onChange={this.onChange}\n            className=\"change-select margin-right-sm\"\n            clearable={false}\n          />\n        )}\n        {changing && (\n          <span className=\"change-cancel\">\n            {/* eslint-disable-next-line */}\n            <a onClick={this.onCancelChange}>{labels.cancelLanguageChange}</a>\n          </span>\n        )}\n      </div>\n    );\n  }\n}\n"],"mappings":"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","names":[]}