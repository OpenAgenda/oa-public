{"version":3,"sources":["../../../src/components/configuration/DefaultLocation.js"],"sourcesContent":["import Select from 'react-select';\nimport { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport countries from '@openagenda/countries/labels.js';\nimport defaultLocationLabels from '@openagenda/labels/event/defaultLocation.js';\nimport flattenLabels from '@openagenda/labels/flatten.js';\nimport LocationSelector from '@openagenda/agenda-locations-app/dist/components/LocationSelector.js';\nimport Provider from '@openagenda/agenda-locations-app/dist/decorators/Providers.js';\n\nconst DefaultLocation = ({\n  lang = 'fr',\n  value = null,\n  field,\n  onChange,\n  enabled = true,\n}) => {\n  const labels = flattenLabels(defaultLocationLabels, lang);\n  const extractCountryNames = () =>\n    countries.map((c) => ({\n      value: c.code,\n      label: c[lang],\n    }));\n\n  const options = extractCountryNames();\n  const selectValue = options.find(\n    (option) => option.value === value?.countryCode,\n  );\n  const [mode, setMode] = useState(value?.uid ? 'show' : 'search');\n  const [loc, setLoc] = useState(null);\n\n  useEffect(() => {\n    if (value?.uid) {\n      axios\n        .get(field.res.getLocationDetails.replace(':locationUid', value.uid))\n        .then((r) => setLoc(r.data));\n    }\n  }, []);\n\n  const locationSelectorOnChange = (m, l) => {\n    setMode(m);\n    setLoc(l);\n    if (l.uid) onChange({ ...value, uid: l.uid });\n  };\n\n  return (\n    <>\n      <div className=\"margin-bottom-md\">\n        <label htmlFor=\"DefaultLocation\">{labels.chooseDefaultLocation}</label>\n        <Provider lang={lang}>\n          <LocationSelector\n            enableDetails={false}\n            allowCreate={false}\n            confirmRequired={false}\n            tiles={null}\n            mode={mode}\n            disableChange={false}\n            detailedInfo={null}\n            classNames={{\n              input: '',\n            }}\n            allowRemove\n            onRemove={() => {\n              setLoc(null);\n              setMode('search');\n              onChange((({ uid, ...o }) => o)(value));\n            }}\n            location={loc}\n            lang={lang}\n            settings={null}\n            res={{\n              get: field.res.getLocationDetails,\n              index: field.res.listLocations,\n              staticTiles: field.res.staticTiles,\n            }}\n            onChange={(m, l) => locationSelectorOnChange(m, l)}\n          />\n        </Provider>\n      </div>\n      <div\n        className={\n          enabled ? 'form-group country' : 'form-group country disabled'\n        }\n      >\n        <label htmlFor=\"Country\">{labels.chooseDefaultCountry}</label>\n\n        <Select\n          disabled={!enabled}\n          options={options}\n          value={selectValue}\n          onChange={(val) => {\n            onChange({ ...value, countryCode: val.value });\n          }}\n          clearable={false}\n        />\n      </div>\n    </>\n  );\n};\nexport default DefaultLocation;\n"],"mappings":";;;AAAA,OAAO,YAAY;AACnB,SAAS,UAAU,iBAAiB;AACpC,OAAO,WAAW;AAClB,OAAO,eAAe;AACtB,OAAO,2BAA2B;AAClC,OAAO,mBAAmB;AAC1B,OAAO,sBAAsB;AAC7B,OAAO,cAAc;AAsCjB,mBAEI,KADF,YADF;AApCJ,IAAM,kBAAkB,CAAC;AAAA,EACvB,OAAO;AAAA,EACP,QAAQ;AAAA,EACR;AAAA,EACA;AAAA,EACA,UAAU;AACZ,MAAM;AACJ,QAAM,SAAS,cAAc,uBAAuB,IAAI;AACxD,QAAM,sBAAsB,MAC1B,UAAU,IAAI,CAAC,OAAO;AAAA,IACpB,OAAO,EAAE;AAAA,IACT,OAAO,EAAE,IAAI;AAAA,EACf,EAAE;AAEJ,QAAM,UAAU,oBAAoB;AACpC,QAAM,cAAc,QAAQ;AAAA,IAC1B,CAAC,WAAW,OAAO,WAAU,+BAAO;AAAA,EACtC;AACA,QAAM,CAAC,MAAM,OAAO,IAAI,UAAS,+BAAO,OAAM,SAAS,QAAQ;AAC/D,QAAM,CAAC,KAAK,MAAM,IAAI,SAAS,IAAI;AAEnC,YAAU,MAAM;AACd,QAAI,+BAAO,KAAK;AACd,YACG,IAAI,MAAM,IAAI,mBAAmB,QAAQ,gBAAgB,MAAM,GAAG,CAAC,EACnE,KAAK,CAAC,MAAM,OAAO,EAAE,IAAI,CAAC;AAAA,IAC/B;AAAA,EACF,GAAG,CAAC,CAAC;AAEL,QAAM,2BAA2B,CAAC,GAAG,MAAM;AACzC,YAAQ,CAAC;AACT,WAAO,CAAC;AACR,QAAI,EAAE,IAAK,UAAS,EAAE,GAAG,OAAO,KAAK,EAAE,IAAI,CAAC;AAAA,EAC9C;AAEA,SACE,iCACE;AAAA,yBAAC,SAAI,WAAU,oBACb;AAAA,0BAAC,WAAM,SAAQ,mBAAmB,iBAAO,uBAAsB;AAAA,MAC/D,oBAAC,YAAS,MACR;AAAA,QAAC;AAAA;AAAA,UACC,eAAe;AAAA,UACf,aAAa;AAAA,UACb,iBAAiB;AAAA,UACjB,OAAO;AAAA,UACP;AAAA,UACA,eAAe;AAAA,UACf,cAAc;AAAA,UACd,YAAY;AAAA,YACV,OAAO;AAAA,UACT;AAAA,UACA,aAAW;AAAA,UACX,UAAU,MAAM;AACd,mBAAO,IAAI;AACX,oBAAQ,QAAQ;AAChB,sBAAU,CAAC,EAAE,KAAK,GAAG,EAAE,MAAM,GAAG,KAAK,CAAC;AAAA,UACxC;AAAA,UACA,UAAU;AAAA,UACV;AAAA,UACA,UAAU;AAAA,UACV,KAAK;AAAA,YACH,KAAK,MAAM,IAAI;AAAA,YACf,OAAO,MAAM,IAAI;AAAA,YACjB,aAAa,MAAM,IAAI;AAAA,UACzB;AAAA,UACA,UAAU,CAAC,GAAG,MAAM,yBAAyB,GAAG,CAAC;AAAA;AAAA,MACnD,GACF;AAAA,OACF;AAAA,IACA;AAAA,MAAC;AAAA;AAAA,QACC,WACE,UAAU,uBAAuB;AAAA,QAGnC;AAAA,8BAAC,WAAM,SAAQ,WAAW,iBAAO,sBAAqB;AAAA,UAEtD;AAAA,YAAC;AAAA;AAAA,cACC,UAAU,CAAC;AAAA,cACX;AAAA,cACA,OAAO;AAAA,cACP,UAAU,CAAC,QAAQ;AACjB,yBAAS,EAAE,GAAG,OAAO,aAAa,IAAI,MAAM,CAAC;AAAA,cAC/C;AAAA,cACA,WAAW;AAAA;AAAA,UACb;AAAA;AAAA;AAAA,IACF;AAAA,KACF;AAEJ;AACA,IAAO,0BAAQ;","names":[]}