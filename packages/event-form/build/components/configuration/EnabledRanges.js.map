{"version":3,"sources":["../../../src/components/configuration/EnabledRanges.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport MaskedInputModule from 'react-text-mask';\nimport { format } from 'date-fns';\n\nimport enabledRangesLabels from '@openagenda/labels/event/enabledRanges.js';\nimport flattenLabels from '@openagenda/labels/flatten.js';\n\nimport DateField from '@openagenda/form-schemas/client/build/Components/DateField.js';\n\nconst MaskedInput = MaskedInputModule.default || MaskedInputModule;\n\nconst timeMask = [/\\d/, /\\d/, ':', /\\d/, /\\d/];\n\nconst EnabledRanges = ({ lang = 'fr', value = null, field, onChange }) => {\n  const readValue = (aValue) => (aValue ? aValue[0] : null);\n  const { constraints } = field;\n  const labels = flattenLabels(enabledRangesLabels, lang);\n\n  const [localValue, setLocalValue] = useState(value);\n  const [checked, setChecked] = useState(!!readValue(value));\n  const [constraintError, setConstraintError] = useState(null);\n  const [dateError, setDateError] = useState(null);\n  const [timeError, setTimeError] = useState(null);\n\n  const checkAndOnChange = (newValue) => {\n    setLocalValue(newValue);\n    const beginDate = readValue(newValue) && readValue(newValue).begin\n      ? new Date(readValue(newValue).begin)\n      : null;\n    const endDate = readValue(newValue) && readValue(newValue).end\n      ? new Date(readValue(newValue).end)\n      : null;\n    if (!beginDate || !endDate) {\n      return;\n    }\n    setDateError(null);\n    setConstraintError(null);\n    setTimeError(null);\n    if (\n      beginDate.toString() === 'Invalid Date'\n      || endDate.toString() === 'Invalid Date'\n    ) {\n      if (beginDate.toString() === 'Invalid Date') setTimeError({ begin: true });\n      if (endDate.toString() === 'Invalid Date') setTimeError({ end: true });\n      if (\n        beginDate.toString() === 'Invalid Date'\n        && endDate.toString() === 'Invalid Date'\n      ) setTimeError({ begin: true, end: true });\n      return;\n    }\n    if (!(beginDate < endDate)) {\n      setDateError(true);\n      return;\n    }\n    if (\n      constraints\n      && !(\n        new Date(constraints[0].begin) <= beginDate\n        && new Date(constraints[0].end) >= endDate\n      )\n    ) {\n      setConstraintError(true);\n      return;\n    }\n    onChange(newValue);\n  };\n\n  useEffect(() => {\n    checkAndOnChange(localValue);\n  }, []);\n\n  const getDate = (name) => {\n    if (!readValue(localValue)) return null;\n    if (!readValue(localValue)[name]) return null;\n    if (readValue(localValue)[name].split('T')[0] === 'null') return null;\n    return readValue(localValue)[name].split('T')[0];\n  };\n\n  const getTime = (name) => {\n    if (!readValue(localValue)) return null;\n    if (!readValue(localValue)[name]) return null;\n    if (readValue(localValue)[name].split('T')[1] === 'null') return null;\n    return readValue(localValue)[name].split('T')[1];\n  };\n\n  return (\n    <div className=\"checkbox\">\n      <label htmlFor=\"enabledRanges\">\n        <input\n          id=\"enabledRanges\"\n          type=\"checkbox\"\n          checked={checked}\n          onChange={() => {\n            if (checked) {\n              onChange(undefined);\n            }\n            setChecked(!checked);\n          }}\n        />\n        <strong>{labels.checkboxInfo}</strong>\n        <div className=\"text-muted margin-bottom-sm\">{labels.usefulFor}</div>\n      </label>\n      <div className=\"checkbox-sub-menu\">\n        {checked ? (\n          <>\n            {constraints ? (\n              <div\n                className={`info-block-sm margin-bottom-sm ${constraintError ? 'danger' : ''}`}\n              >\n                <p>{labels.constraintInfo}</p>\n                <p>\n                  {labels.from}:{' '}\n                  {new Date(constraints[0].begin).toLocaleDateString('fr-FR')}{' '}\n                  {labels.at}{' '}\n                  {new Date(constraints[0].begin).toLocaleTimeString('fr-FR', {\n                    hour: '2-digit',\n                    minute: '2-digit',\n                  })}\n                </p>\n                <text>\n                  {labels.to}:{' '}\n                  {new Date(constraints[0].end).toLocaleDateString('fr-FR')}{' '}\n                  {labels.at}{' '}\n                  {new Date(constraints[0].end).toLocaleTimeString('fr-FR', {\n                    hour: '2-digit',\n                    minute: '2-digit',\n                  })}\n                </text>\n              </div>\n            ) : null}\n            <form className=\"form-inline\">\n              <div className=\"form-group\">{labels.from}</div>\n              <div className=\"form-group\">\n                <DateField\n                  className=\"margin-h-sm\"\n                  field={{\n                    field: 'begin',\n                    fieldType: 'date',\n                  }}\n                  value={getDate('begin')}\n                  enabled\n                  lang={lang}\n                  onChange={(v) => {\n                    if (!getTime('begin')) {\n                      checkAndOnChange([\n                        {\n                          ...readValue(localValue),\n                          begin: `${format(v, 'yyyy-MM-dd')}`,\n                        },\n                      ]);\n                      return;\n                    }\n                    checkAndOnChange([\n                      {\n                        ...readValue(localValue),\n                        begin: `${format(v, 'yyyy-MM-dd')}T${getTime('begin')}`,\n                      },\n                    ]);\n                  }}\n                />\n              </div>\n              <div className=\"form-group\">{labels.at}</div>\n              <div\n                className={`form-group ${timeError?.begin ? 'has-error' : ''}`}\n              >\n                <MaskedInput\n                  value={getTime('begin') || ''}\n                  className=\"form-control text-center margin-left-sm\"\n                  mask={timeMask}\n                  placeholder=\"HH:MM\"\n                  keepCharPositions\n                  onBlur={(e) => {\n                    checkAndOnChange([\n                      {\n                        ...readValue(localValue),\n                        begin: `${getDate('begin')}T${e.target.value}`,\n                      },\n                    ]);\n                  }}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter') {\n                      e.preventDefault();\n                      checkAndOnChange([\n                        {\n                          ...readValue(localValue),\n                          begin: `${getDate('begin')}T${e.target.value}`,\n                        },\n                      ]);\n                    }\n                  }}\n                  style={{\n                    width: '75px',\n                  }}\n                />\n              </div>\n            </form>\n            <form className=\"form-inline margin-top-sm\">\n              <div className=\"form-group\">{labels.to}</div>\n              <div className={`form-group ${dateError ? 'has-error' : ''}`}>\n                <DateField\n                  className=\"margin-h-sm\"\n                  field={{\n                    field: 'end',\n                  }}\n                  value={getDate('end')}\n                  enabled\n                  lang={lang}\n                  onChange={(v) => {\n                    if (!getTime('end')) {\n                      checkAndOnChange([\n                        {\n                          ...readValue(localValue),\n                          end: `${format(v, 'yyyy-MM-dd')}`,\n                        },\n                      ]);\n                      return;\n                    }\n                    checkAndOnChange([\n                      {\n                        ...readValue(localValue),\n                        end: `${format(v, 'yyyy-MM-dd')}T${getTime('end')}`,\n                      },\n                    ]);\n                  }}\n                />\n              </div>\n              <div className=\"form-group\">{labels.at}</div>\n              <div\n                className={`form-group ${timeError?.end ? 'has-error' : ''}`}\n              >\n                <MaskedInput\n                  className=\"form-control text-center margin-left-sm\"\n                  value={getTime('end') || ''}\n                  mask={timeMask}\n                  placeholder=\"HH:MM\"\n                  keepCharPositions\n                  onBlur={(e) => {\n                    checkAndOnChange([\n                      {\n                        ...readValue(localValue),\n                        end: `${getDate('end')}T${e.target.value}`,\n                      },\n                    ]);\n                  }}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter') {\n                      e.preventDefault();\n                      checkAndOnChange([\n                        {\n                          ...readValue(localValue),\n                          end: `${getDate('end')}T${e.target.value}`,\n                        },\n                      ]);\n                    }\n                  }}\n                  style={{\n                    width: '75px',\n                  }}\n                />\n              </div>\n            </form>\n            {constraintError || dateError || timeError ? (\n              <div className=\"info-block-sm danger\">\n                {timeError ? labels.timeError : null}\n                {dateError ? labels.dateError : null}\n                {constraintError ? labels.constraintError : null}\n              </div>\n            ) : null}\n          </>\n        ) : null}\n      </div>\n    </div>\n  );\n};\nexport default EnabledRanges;\n"],"mappings":"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","names":[]}