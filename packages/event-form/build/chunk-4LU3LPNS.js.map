{"version":3,"sources":["../src/validators/location.js"],"sourcesContent":["import _ from 'lodash';\nimport schema from '@openagenda/validators/schema/index.js';\nimport textValidator from '@openagenda/validators/text.js';\nimport integerValidator from '@openagenda/validators/integer.js';\nimport latitudeValidator from '@openagenda/validators/latitude.js';\nimport longitudeValidator from '@openagenda/validators/longitude.js';\n\nschema.register({\n  text: textValidator,\n  integer: integerValidator,\n  latitude: latitudeValidator,\n  longitude: longitudeValidator,\n});\n\nconst locationSchema = {\n  uid: {\n    type: 'integer',\n    optional: false,\n  },\n  name: {\n    type: 'text',\n  },\n  address: {\n    type: 'text',\n  },\n  latitude: {\n    type: 'latitude',\n  },\n  longitude: {\n    type: 'longitude',\n  },\n  timezone: {\n    type: 'text',\n  },\n};\n\nconst validate = schema(locationSchema);\nconst validateDraft = schema({\n  ...locationSchema,\n  uid: {\n    type: 'integer',\n  },\n});\n\nexport default (options) => (value) => {\n  const optional = _.get(options, 'optional', true);\n\n  if (optional && value === undefined) {\n    return _.get(options, 'default');\n  }\n\n  if (optional && value === null) {\n    return null;\n  }\n\n  try {\n    return (optional ? validateDraft : validate)(value);\n  } catch (errors) {\n    throw errors.map((e) => ({\n      ...e,\n      field: 'location',\n      code: `location.${e.code}`,\n    }));\n  }\n};\n"],"mappings":";AAAA,OAAO,OAAO;AACd,OAAO,YAAY;AACnB,OAAO,mBAAmB;AAC1B,OAAO,sBAAsB;AAC7B,OAAO,uBAAuB;AAC9B,OAAO,wBAAwB;AAE/B,OAAO,SAAS;AAAA,EACd,MAAM;AAAA,EACN,SAAS;AAAA,EACT,UAAU;AAAA,EACV,WAAW;AACb,CAAC;AAED,IAAM,iBAAiB;AAAA,EACrB,KAAK;AAAA,IACH,MAAM;AAAA,IACN,UAAU;AAAA,EACZ;AAAA,EACA,MAAM;AAAA,IACJ,MAAM;AAAA,EACR;AAAA,EACA,SAAS;AAAA,IACP,MAAM;AAAA,EACR;AAAA,EACA,UAAU;AAAA,IACR,MAAM;AAAA,EACR;AAAA,EACA,WAAW;AAAA,IACT,MAAM;AAAA,EACR;AAAA,EACA,UAAU;AAAA,IACR,MAAM;AAAA,EACR;AACF;AAEA,IAAM,WAAW,OAAO,cAAc;AACtC,IAAM,gBAAgB,OAAO;AAAA,EAC3B,GAAG;AAAA,EACH,KAAK;AAAA,IACH,MAAM;AAAA,EACR;AACF,CAAC;AAED,IAAO,mBAAQ,CAAC,YAAY,CAAC,UAAU;AACrC,QAAM,WAAW,EAAE,IAAI,SAAS,YAAY,IAAI;AAEhD,MAAI,YAAY,UAAU,QAAW;AACnC,WAAO,EAAE,IAAI,SAAS,SAAS;AAAA,EACjC;AAEA,MAAI,YAAY,UAAU,MAAM;AAC9B,WAAO;AAAA,EACT;AAEA,MAAI;AACF,YAAQ,WAAW,gBAAgB,UAAU,KAAK;AAAA,EACpD,SAAS,QAAQ;AACf,UAAM,OAAO,IAAI,CAAC,OAAO;AAAA,MACvB,GAAG;AAAA,MACH,OAAO;AAAA,MACP,MAAM,YAAY,EAAE,IAAI;AAAA,IAC1B,EAAE;AAAA,EACJ;AACF;","names":[]}