{"version":3,"sources":["../src/components/Age.js"],"sourcesContent":["import ih from 'immutability-helper';\nimport { Component } from 'react';\nimport Select from 'react-select';\n\nimport ageLabels from '@openagenda/labels/cibul-templates/age-fields.js';\nimport flattenLabels from '@openagenda/labels/flatten.js';\n\nconst limits = {\n  min: 0,\n  max: 122,\n};\n\nconst defaults = {\n  min: 0,\n  max: 99,\n};\n\nexport default class AgeComponent extends Component {\n  onChange(field, choice) {\n    const { onChange, value } = this.props;\n\n    const clean = parseInt(choice.value, 10);\n\n    onChange(\n      ih(value, {\n        [field]: {\n          $set: Number.isNaN(clean) ? null : clean,\n        },\n      }),\n    );\n  }\n\n  getSelectOptions(minValue) {\n    const { lang } = this.props;\n\n    const labels = flattenLabels(ageLabels, lang);\n    const options = [];\n\n    const min = minValue || limits.min;\n\n    for (let i = 0; i < limits.max; i++) {\n      if (min <= i) {\n        options.push({\n          value: `${i}`,\n          label: `${i} ${i < 2 ? labels.year : labels.years}`,\n        });\n      }\n    }\n\n    return options;\n  }\n\n  isEnabled() {\n    const { value, enabled: enabledFromProps = true } = this.props;\n\n    if (!enabledFromProps) {\n      return false;\n    }\n\n    const min = parseInt(value?.min ?? 'NaN', 10);\n    const max = parseInt(value?.max ?? 'NaN', 10);\n\n    return !Number.isNaN(min) || !Number.isNaN(max);\n  }\n\n  toggleEnabled(enable = null) {\n    const isEnabled = this.isEnabled();\n\n    if (enable === true) {\n      if (!isEnabled) this.initialize();\n    } else if (enable === false) {\n      if (isEnabled) this.disable();\n    } else if (isEnabled) {\n      this.disable();\n    } else {\n      this.initialize();\n    }\n  }\n\n  disable() {\n    const { onChange } = this.props;\n\n    onChange({\n      min: null,\n      max: null,\n    });\n  }\n\n  initialize() {\n    const { onChange } = this.props;\n\n    onChange(defaults);\n  }\n\n  render() {\n    const { lang, value, enabled: enabledFromProps = true } = this.props;\n\n    const labels = flattenLabels(ageLabels, lang);\n\n    const min = `${value?.min ?? ''}`;\n    const max = `${value?.max ?? ''}`;\n\n    const isEnabled = this.isEnabled();\n\n    const minAgeOptions = this.getSelectOptions();\n    const minAgeValue = isEnabled\n      ? minAgeOptions.find((option) => option.value === min)\n      : null;\n\n    const maxAgeOptions = this.getSelectOptions(value ? min : false);\n    const maxAgeValue = isEnabled\n      ? maxAgeOptions.find((option) => option.value === max)\n      : null;\n\n    const selectStyles = {\n      container: (provided) => ({\n        ...provided,\n        width: '150px',\n        display: 'inline-block',\n      }),\n      menu: (provided) => ({\n        ...provided,\n        zIndex: 3,\n      }),\n    };\n\n    return (\n      <div className=\"age\">\n        <input\n          disabled={!enabledFromProps}\n          type=\"checkbox\"\n          name=\"age\"\n          checked={isEnabled}\n          onChange={() => this.toggleEnabled(null)}\n        />\n        <div className=\"age-inputs\">\n          <label htmlFor=\"minage\" className=\"margin-right-sm\">\n            {labels.min}\n          </label>\n          <Select\n            isDisabled={!enabledFromProps}\n            styles={selectStyles}\n            name=\"minage\"\n            value={minAgeValue}\n            options={minAgeOptions}\n            clearable={false}\n            onChange={(choice) => this.onChange('min', choice)}\n            onFocus={() => this.toggleEnabled(true)}\n            placeholder={labels.select}\n          />\n          <label className=\"margin-h-sm\" htmlFor=\"maxage\">\n            {labels.max}\n          </label>\n          <Select\n            isDisabled={!enabledFromProps}\n            styles={selectStyles}\n            name=\"maxage\"\n            value={maxAgeValue}\n            options={maxAgeOptions}\n            clearable={false}\n            onChange={(choice) => this.onChange('max', choice)}\n            onFocus={() => this.toggleEnabled(true)}\n            placeholder={labels.select}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n"],"mappings":";AAAA,OAAO,QAAQ;AACf,SAAS,iBAAiB;AAC1B,OAAO,YAAY;AAEnB,OAAO,eAAe;AACtB,OAAO,mBAAmB;AA2HlB,cAOA,YAPA;AAzHR,IAAM,SAAS;AAAA,EACb,KAAK;AAAA,EACL,KAAK;AACP;AAEA,IAAM,WAAW;AAAA,EACf,KAAK;AAAA,EACL,KAAK;AACP;AAEA,IAAqB,eAArB,cAA0C,UAAU;AAAA,EAClD,SAAS,OAAO,QAAQ;AACtB,UAAM,EAAE,UAAU,MAAM,IAAI,KAAK;AAEjC,UAAM,QAAQ,SAAS,OAAO,OAAO,EAAE;AAEvC;AAAA,MACE,GAAG,OAAO;AAAA,QACR,CAAC,KAAK,GAAG;AAAA,UACP,MAAM,OAAO,MAAM,KAAK,IAAI,OAAO;AAAA,QACrC;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,iBAAiB,UAAU;AACzB,UAAM,EAAE,KAAK,IAAI,KAAK;AAEtB,UAAM,SAAS,cAAc,WAAW,IAAI;AAC5C,UAAM,UAAU,CAAC;AAEjB,UAAM,MAAM,YAAY,OAAO;AAE/B,aAAS,IAAI,GAAG,IAAI,OAAO,KAAK,KAAK;AACnC,UAAI,OAAO,GAAG;AACZ,gBAAQ,KAAK;AAAA,UACX,OAAO,GAAG,CAAC;AAAA,UACX,OAAO,GAAG,CAAC,IAAI,IAAI,IAAI,OAAO,OAAO,OAAO,KAAK;AAAA,QACnD,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,YAAY;AACV,UAAM,EAAE,OAAO,SAAS,mBAAmB,KAAK,IAAI,KAAK;AAEzD,QAAI,CAAC,kBAAkB;AACrB,aAAO;AAAA,IACT;AAEA,UAAM,MAAM,UAAS,+BAAO,QAAO,OAAO,EAAE;AAC5C,UAAM,MAAM,UAAS,+BAAO,QAAO,OAAO,EAAE;AAE5C,WAAO,CAAC,OAAO,MAAM,GAAG,KAAK,CAAC,OAAO,MAAM,GAAG;AAAA,EAChD;AAAA,EAEA,cAAc,SAAS,MAAM;AAC3B,UAAM,YAAY,KAAK,UAAU;AAEjC,QAAI,WAAW,MAAM;AACnB,UAAI,CAAC,UAAW,MAAK,WAAW;AAAA,IAClC,WAAW,WAAW,OAAO;AAC3B,UAAI,UAAW,MAAK,QAAQ;AAAA,IAC9B,WAAW,WAAW;AACpB,WAAK,QAAQ;AAAA,IACf,OAAO;AACL,WAAK,WAAW;AAAA,IAClB;AAAA,EACF;AAAA,EAEA,UAAU;AACR,UAAM,EAAE,SAAS,IAAI,KAAK;AAE1B,aAAS;AAAA,MACP,KAAK;AAAA,MACL,KAAK;AAAA,IACP,CAAC;AAAA,EACH;AAAA,EAEA,aAAa;AACX,UAAM,EAAE,SAAS,IAAI,KAAK;AAE1B,aAAS,QAAQ;AAAA,EACnB;AAAA,EAEA,SAAS;AACP,UAAM,EAAE,MAAM,OAAO,SAAS,mBAAmB,KAAK,IAAI,KAAK;AAE/D,UAAM,SAAS,cAAc,WAAW,IAAI;AAE5C,UAAM,MAAM,IAAG,+BAAO,QAAO,EAAE;AAC/B,UAAM,MAAM,IAAG,+BAAO,QAAO,EAAE;AAE/B,UAAM,YAAY,KAAK,UAAU;AAEjC,UAAM,gBAAgB,KAAK,iBAAiB;AAC5C,UAAM,cAAc,YAChB,cAAc,KAAK,CAAC,WAAW,OAAO,UAAU,GAAG,IACnD;AAEJ,UAAM,gBAAgB,KAAK,iBAAiB,QAAQ,MAAM,KAAK;AAC/D,UAAM,cAAc,YAChB,cAAc,KAAK,CAAC,WAAW,OAAO,UAAU,GAAG,IACnD;AAEJ,UAAM,eAAe;AAAA,MACnB,WAAW,CAAC,cAAc;AAAA,QACxB,GAAG;AAAA,QACH,OAAO;AAAA,QACP,SAAS;AAAA,MACX;AAAA,MACA,MAAM,CAAC,cAAc;AAAA,QACnB,GAAG;AAAA,QACH,QAAQ;AAAA,MACV;AAAA,IACF;AAEA,WACE,qBAAC,SAAI,WAAU,OACb;AAAA;AAAA,QAAC;AAAA;AAAA,UACC,UAAU,CAAC;AAAA,UACX,MAAK;AAAA,UACL,MAAK;AAAA,UACL,SAAS;AAAA,UACT,UAAU,MAAM,KAAK,cAAc,IAAI;AAAA;AAAA,MACzC;AAAA,MACA,qBAAC,SAAI,WAAU,cACb;AAAA,4BAAC,WAAM,SAAQ,UAAS,WAAU,mBAC/B,iBAAO,KACV;AAAA,QACA;AAAA,UAAC;AAAA;AAAA,YACC,YAAY,CAAC;AAAA,YACb,QAAQ;AAAA,YACR,MAAK;AAAA,YACL,OAAO;AAAA,YACP,SAAS;AAAA,YACT,WAAW;AAAA,YACX,UAAU,CAAC,WAAW,KAAK,SAAS,OAAO,MAAM;AAAA,YACjD,SAAS,MAAM,KAAK,cAAc,IAAI;AAAA,YACtC,aAAa,OAAO;AAAA;AAAA,QACtB;AAAA,QACA,oBAAC,WAAM,WAAU,eAAc,SAAQ,UACpC,iBAAO,KACV;AAAA,QACA;AAAA,UAAC;AAAA;AAAA,YACC,YAAY,CAAC;AAAA,YACb,QAAQ;AAAA,YACR,MAAK;AAAA,YACL,OAAO;AAAA,YACP,SAAS;AAAA,YACT,WAAW;AAAA,YACX,UAAU,CAAC,WAAW,KAAK,SAAS,OAAO,MAAM;AAAA,YACjD,SAAS,MAAM,KAAK,cAAc,IAAI;AAAA,YACtC,aAAa,OAAO;AAAA;AAAA,QACtB;AAAA,SACF;AAAA,OACF;AAAA,EAEJ;AACF;","names":[]}