{"version":3,"file":"toEventSchema.js","names":["getLocaleValue","DEFAULT_LANG","getEventAttendanceMode","attendanceMode","_$2$","_attendanceMode$id","id","getEventStatus","status","_$2$3$4$5$","_status$id","imageToUrl","image","type","_image$variants$find","_image$variants","variant","variants","find","img","concat","base","filename","toEventSchema","event","_ref","_event$location","_event$registration","_event$age","_event$age2","url","locale","defaultLocale","formatDate","timings","begin","end","_atInstanceProperty","call","timezone","location","eventSchema","_objectSpread","name","title","description","startDate","endDate","eventAttendanceMode","eventStatus","registration","some","r","offers","value","availability","address","streetAddress","addressLocality","city","addressRegion","region","postalCode","addressCountry","countryCode","geo","latitude","longitude","age","min","max","typicalAgeRange"],"sources":["../../src/schema-org/toEventSchema.js"],"sourcesContent":["import { getLocaleValue, DEFAULT_LANG } from '@openagenda/intl';\n\nfunction getEventAttendanceMode(attendanceMode) {\n  return (\n    {\n      1: 'OfflineEventAttendanceMode',\n      2: 'OnlineEventAttendanceMode',\n      3: 'MixedEventAttendanceMode',\n    }[attendanceMode?.id ?? attendanceMode] ?? 'OfflineEventAttendanceMode'\n  );\n}\n\nfunction getEventStatus(status) {\n  return (\n    {\n      1: 'EventScheduled',\n      2: 'EventRescheduled',\n      3: 'EventMovedOnline',\n      4: 'EventPostponed',\n      5: 'EventScheduled', // but full.\n      6: 'EventCancelled',\n    }[status?.id ?? status] ?? 'EventScheduled'\n  );\n}\n\nfunction imageToUrl(image, type) {\n  if (!image) return;\n\n  const variant = typeof type === 'string'\n    ? image.variants?.find((img) => img.type === type) ?? image\n    : image;\n\n  return `${image.base}${variant.filename}`;\n}\n\nexport default function toEventSchema(\n  event,\n  { url, locale, defaultLocale = DEFAULT_LANG, formatDate },\n) {\n  const { timings } = event;\n\n  const { begin } = timings[0];\n  const { end } = timings.at(-1);\n\n  const timezone = event.timezone || event.location?.timezone;\n\n  const eventSchema = {\n    '@context': 'https://schema.org',\n    '@type': 'Event',\n    name: getLocaleValue(event.title, locale, defaultLocale),\n    description: getLocaleValue(event.description, locale, defaultLocale),\n    startDate: formatDate(begin, timezone),\n    endDate: formatDate(end, timezone),\n    eventAttendanceMode: `https://schema.org/${getEventAttendanceMode(event.attendanceMode)}`,\n    eventStatus: `https://schema.org/${getEventStatus(event.status)}`,\n    ...event.registration?.some((r) => r.type === 'link')\n      ? {\n        offers: {\n          '@type': 'Offer',\n          url: event.registration.find((r) => r.type === 'link').value,\n          availability: `https://schema.org/${event.status === 5 ? 'SoldOut' : 'InStock'}`,\n        },\n      }\n      : {},\n  };\n\n  if (url) {\n    eventSchema['@id'] = url;\n    eventSchema.url = url;\n  }\n\n  if (event.image) {\n    eventSchema.image = imageToUrl(event.image);\n  }\n\n  if (event.location) {\n    eventSchema.location = {\n      '@type': 'Place',\n      name: event.location.name,\n      address: {\n        '@type': 'PostalAddress',\n        streetAddress: event.location.address,\n        addressLocality: event.location.city,\n        addressRegion: event.location.region,\n        postalCode: event.location.postalCode,\n        addressCountry: event.location.countryCode,\n      },\n      geo: {\n        '@type': 'GeoCoordinates',\n        latitude: event.location.latitude,\n        longitude: event.location.longitude,\n      },\n    };\n  }\n\n  if (event.age?.min || event.age?.max) {\n    eventSchema.typicalAgeRange = `${event.age.min || ''}-${event.age.max || ''}`;\n  }\n\n  return eventSchema;\n}\n"],"mappings":"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","ignoreList":[]}