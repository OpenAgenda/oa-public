{"version":3,"sources":["../../src/components/FavoriteToggle.js","../../src/utils/updateCustomFilter.js","../../src/utils/updateFormValues.js","../../src/hooks/useFavoriteState.js","../../src/hooks/index.js"],"sourcesContent":["import isEqual from 'lodash/isEqual.js';\nimport { useEffect, useRef, useCallback, useMemo } from 'react';\nimport useLatestModule from 'react-use/lib/useLatest.js';\nimport { useForm } from 'react-final-form';\nimport a11yButtonActionHandler from '@openagenda/react-shared/dist/utils/a11yButtonActionHandler.js';\nimport updateCustomFilter from '../utils/updateCustomFilter.js';\nimport updateFormValues from '../utils/updateFormValues.js';\nimport { useFavoriteState } from '../hooks/index.js';\n\nconst useLatest = useLatestModule.default || useLatestModule;\n\nexport default function FavoriteToggle({ agendaUid, eventUid, widget }) {\n  const form = useForm();\n  const [value, setValue] = useFavoriteState(widget.agendaUid || agendaUid);\n  const firstRender = useRef(true);\n\n  const latestValue = useLatest(value);\n\n  const eventUidStr = String(eventUid);\n\n  const updateForm = useCallback(\n    (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const active = latestValue.current?.includes(eventUidStr);\n      const newValue = active\n        ? latestValue.current.filter((v) => v !== eventUidStr)\n        : [...latestValue.current || [], eventUidStr].filter(\n          (v) => v !== '-1',\n        );\n\n      setValue(newValue.length ? newValue : undefined);\n    },\n    [eventUidStr, latestValue, setValue],\n  );\n\n  const onChange = useMemo(\n    () => a11yButtonActionHandler(updateForm),\n    [updateForm],\n  );\n\n  // Add & remove click listener\n  useEffect(() => {\n    if (firstRender.current) {\n      firstRender.current = false;\n\n      if (latestValue.current?.includes(eventUidStr)) {\n        updateCustomFilter(widget, true);\n      }\n    }\n\n    const handlerElem = widget.handlerElem || widget.elem;\n    const innerCheckboxes = handlerElem.querySelectorAll(\n      'input[type=\"checkbox\"]',\n    );\n\n    const handlerIsLabelWithCheckbox = innerCheckboxes.length === 1\n      && handlerElem.tagName === 'LABEL'\n      && handlerElem.contains(innerCheckboxes[0]);\n\n    if (\n      innerCheckboxes.length === 1\n      && (!widget.handlerElem || handlerIsLabelWithCheckbox)\n    ) {\n      innerCheckboxes[0].addEventListener('change', updateForm, false);\n    } else {\n      handlerElem.addEventListener('click', onChange, false);\n    }\n\n    handlerElem.addEventListener('keydown', onChange, false);\n\n    return () => {\n      if (\n        innerCheckboxes.length === 1\n        && (!widget.handlerElem || handlerIsLabelWithCheckbox)\n      ) {\n        innerCheckboxes[0].removeEventListener('change', updateForm, false);\n      } else {\n        handlerElem.removeEventListener('click', onChange, false);\n      }\n\n      handlerElem.removeEventListener('keydown', onChange, false);\n    };\n  }, [eventUidStr, widget, latestValue, onChange]);\n\n  // Watch value change\n  useEffect(() => {\n    const active = value?.includes(eventUidStr);\n\n    updateCustomFilter(widget, active);\n\n    const formValues = form.getState().values;\n\n    // if favorties filter checked\n    if (formValues.favorites && !isEqual(formValues.uid, value)) {\n      updateFormValues(form, {\n        uid: value || ['-1'],\n      });\n    }\n  }, [form, eventUidStr, value, widget]);\n\n  return null;\n}\n","export default function updateCustomFilter(filter, active) {\n  const activeClass = filter.activeClass || 'active';\n  const inactiveClass = filter.inactiveClass || 'inactive';\n  const { classList } = filter.activeTargetElem || filter.elem;\n\n  const handlerElem = filter.handlerElem || filter.elem;\n  const innerCheckboxes = handlerElem.querySelectorAll(\n    'input[type=\"checkbox\"]',\n  );\n  const checkbox = innerCheckboxes.length === 1 ? innerCheckboxes[0] : null;\n\n  if (active) {\n    if (classList.contains(inactiveClass)) classList.remove(inactiveClass);\n    if (!classList.contains(activeClass)) classList.add(activeClass);\n    if (checkbox && !checkbox.checked) checkbox.checked = true;\n  } else {\n    if (classList.contains(activeClass)) classList.remove(activeClass);\n    if (!classList.contains(inactiveClass)) classList.add(inactiveClass);\n    if (checkbox && checkbox.checked) checkbox.checked = false;\n  }\n}\n","export default function updateFormValues(form, query, active = true) {\n  form.batch(() => {\n    for (const key in query) {\n      if (Object.prototype.hasOwnProperty.call(query, key)) {\n        if (active) {\n          form.change(key, query[key]);\n        } else {\n          form.change(key, undefined);\n        }\n      }\n    }\n  });\n}\n","import { useCallback } from 'react';\nimport { createLocalStorageStateHook } from 'use-local-storage-state';\n\nconst useFavoriteLocalStorageState = createLocalStorageStateHook('favorite-events');\n\nexport default function useFavoriteState(agendaUid) {\n  const [value, setValue] = useFavoriteLocalStorageState();\n\n  const setAgendaValue = useCallback(\n    (fnOrValue) => {\n      if (typeof fnOrValue === 'function') {\n        setValue((prev) => ({\n          ...prev,\n          [agendaUid]: fnOrValue(prev?.[agendaUid]),\n        }));\n      } else {\n        setValue((prev) => ({\n          ...prev,\n          [agendaUid]: fnOrValue,\n        }));\n      }\n    },\n    [setValue, agendaUid],\n  );\n\n  return [value?.[agendaUid], setAgendaValue];\n}\n","export { default as useActiveFilters } from './useActiveFilters.js';\nexport { default as useChoiceState } from './useChoiceState.js';\nexport { default as useFavoritesOnChange } from './useFavoritesOnChange.js';\nexport { default as useFavoriteState } from './useFavoriteState.js';\nexport { default as useFilters } from './useFilters.js';\nexport { default as useFilterTitle } from './useFilterTitle.js';\nexport { default as useGetFilterOptions } from './useGetFilterOptions.js';\nexport { default as useGetTotal } from './useGetTotal.js';\nexport { default as useLoadGeoData } from './useLoadGeoData.js';\nexport { default as useLoadTimingsData } from './useLoadTimingsData.js';\n\nexport { useField, useForm } from 'react-final-form';\n"],"mappings":"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","names":["import_react","import_react_final_form","useLatestModule","a11yButtonActionHandler","isEqual"]}