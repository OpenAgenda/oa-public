{"version":3,"sources":["../../../src/components/fields/ChoiceField.js"],"sourcesContent":["import React, { useMemo, useRef } from 'react';\nimport { useUIDSeed } from 'react-uid';\nimport { useIntl } from 'react-intl';\nimport cn from 'classnames';\nimport { getLocaleValue } from '@openagenda/intl';\nimport a11yButtonActionHandler from '@openagenda/react-shared/dist/utils/a11yButtonActionHandler.js';\n\nfunction useOnChoiceChange(input, preventDefault) {\n  const inputRef = useRef();\n\n  const onChange = useMemo(\n    () =>\n      a11yButtonActionHandler((e) => {\n        if (e.target === inputRef.current) {\n          return;\n        }\n\n        if (preventDefault) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n\n        if (e.currentTarget.getAttribute('aria-disabled') === 'true') {\n          return;\n        }\n\n        if (e.currentTarget.getAttribute('aria-checked') === 'true') {\n          input.onChange({\n            target: {\n              type: input.type,\n              value: input.value,\n              checked: false,\n            },\n          });\n          return;\n        }\n\n        input.onChange({\n          target: {\n            type: input.type,\n            value: input.value,\n            checked: true,\n          },\n        });\n      }),\n    [input.onChange, input.type, input.value, preventDefault],\n  );\n\n  return {\n    inputRef,\n    onChange,\n  };\n}\n\nconst ChoiceField = React.forwardRef(function ChoiceField(\n  {\n    input,\n    getTotal,\n    filter,\n    option,\n    disabled,\n    tag: Tag = 'div',\n    preventDefault = true,\n  },\n  ref,\n) {\n  const intl = useIntl();\n  const seed = useUIDSeed();\n  const total = useMemo(\n    () => getTotal?.(filter, option),\n    [filter, getTotal, option],\n  );\n\n  const { inputRef, onChange } = useOnChoiceChange(input, preventDefault);\n\n  // option, onChange, input, total, disabled\n\n  return (\n    <Tag\n      className={cn(input.type, {\n        disabled,\n        active: input.checked,\n        inactive: !input.checked,\n      })}\n    >\n      <span\n        ref={ref}\n        className=\"oa-choice-option-label\"\n        role=\"checkbox\"\n        tabIndex=\"0\"\n        aria-checked={input.checked}\n        aria-disabled={disabled}\n        onClick={onChange}\n        onKeyPress={onChange}\n      >\n        <input\n          ref={inputRef}\n          tabIndex=\"-1\"\n          type={input.type}\n          id={seed(input)}\n          disabled={disabled}\n          {...input}\n        />\n        {getLocaleValue(option.label, intl.locale) || <>&nbsp;</>}\n        {Number.isInteger(total) && total !== 0 ? (\n          <span className=\"oa-filter-total\">{total}</span>\n        ) : null}\n      </span>\n    </Tag>\n  );\n});\n\nexport default ChoiceField;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAuC;AACvC,uBAA2B;AAC3B,wBAAwB;AACxB,wBAAe;AACf,kBAA+B;AAC/B,qCAAoC;AAgF9B;AA9EN,SAAS,kBAAkB,OAAO,gBAAgB;AAChD,QAAM,eAAW,qBAAO;AAExB,QAAM,eAAW;AAAA,IACf,UACE,+BAAAA,SAAwB,CAAC,MAAM;AAC7B,UAAI,EAAE,WAAW,SAAS,SAAS;AACjC;AAAA,MACF;AAEA,UAAI,gBAAgB;AAClB,UAAE,eAAe;AACjB,UAAE,gBAAgB;AAAA,MACpB;AAEA,UAAI,EAAE,cAAc,aAAa,eAAe,MAAM,QAAQ;AAC5D;AAAA,MACF;AAEA,UAAI,EAAE,cAAc,aAAa,cAAc,MAAM,QAAQ;AAC3D,cAAM,SAAS;AAAA,UACb,QAAQ;AAAA,YACN,MAAM,MAAM;AAAA,YACZ,OAAO,MAAM;AAAA,YACb,SAAS;AAAA,UACX;AAAA,QACF,CAAC;AACD;AAAA,MACF;AAEA,YAAM,SAAS;AAAA,QACb,QAAQ;AAAA,UACN,MAAM,MAAM;AAAA,UACZ,OAAO,MAAM;AAAA,UACb,SAAS;AAAA,QACX;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAAA,IACH,CAAC,MAAM,UAAU,MAAM,MAAM,MAAM,OAAO,cAAc;AAAA,EAC1D;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,EACF;AACF;AAEA,IAAM,cAAc,aAAAC,QAAM,WAAW,SAASC,aAC5C;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,KAAK,MAAM;AAAA,EACX,iBAAiB;AACnB,GACA,KACA;AACA,QAAM,WAAO,2BAAQ;AACrB,QAAM,WAAO,6BAAW;AACxB,QAAM,YAAQ;AAAA,IACZ,MAAM,qCAAW,QAAQ;AAAA,IACzB,CAAC,QAAQ,UAAU,MAAM;AAAA,EAC3B;AAEA,QAAM,EAAE,UAAU,SAAS,IAAI,kBAAkB,OAAO,cAAc;AAItE,SACE;AAAA,IAAC;AAAA;AAAA,MACC,eAAW,kBAAAC,SAAG,MAAM,MAAM;AAAA,QACxB;AAAA,QACA,QAAQ,MAAM;AAAA,QACd,UAAU,CAAC,MAAM;AAAA,MACnB,CAAC;AAAA,MAED;AAAA,QAAC;AAAA;AAAA,UACC;AAAA,UACA,WAAU;AAAA,UACV,MAAK;AAAA,UACL,UAAS;AAAA,UACT,gBAAc,MAAM;AAAA,UACpB,iBAAe;AAAA,UACf,SAAS;AAAA,UACT,YAAY;AAAA,UAEZ;AAAA;AAAA,cAAC;AAAA;AAAA,gBACC,KAAK;AAAA,gBACL,UAAS;AAAA,gBACT,MAAM,MAAM;AAAA,gBACZ,IAAI,KAAK,KAAK;AAAA,gBACd;AAAA,gBACC,GAAG;AAAA;AAAA,YACN;AAAA,gBACC,4BAAe,OAAO,OAAO,KAAK,MAAM,KAAK,2EAAE,kBAAM;AAAA,YACrD,OAAO,UAAU,KAAK,KAAK,UAAU,IACpC,4CAAC,UAAK,WAAU,mBAAmB,iBAAM,IACvC;AAAA;AAAA;AAAA,MACN;AAAA;AAAA,EACF;AAEJ,CAAC;AAED,IAAO,sBAAQ;","names":["a11yButtonActionHandler","React","ChoiceField","cn"]}