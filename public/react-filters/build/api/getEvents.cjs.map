{"version":3,"sources":["../../src/api/getEvents.js","../../src/utils/minimizeAggregation.js","../../src/utils/filtersToAggregations.js","../../src/utils/getQuerySeparator.js"],"sourcesContent":["import qs from 'qs';\nimport filtersToAggregations from '../utils/filtersToAggregations.js';\nimport getQuerySeparator from '../utils/getQuerySeparator.js';\n\nexport default async function getEvents(\n  _apiClient,\n  jsonExportRes,\n  agenda,\n  filters,\n  query,\n  pageParam,\n  filtersBase,\n  pageSize = 20,\n  searchMethod = 'get',\n) {\n  const params = {\n    aggsSizeLimit: 1500,\n    aggs: filtersToAggregations(filters, filtersBase),\n    from: pageParam > 1 ? (pageParam - 1) * pageSize : undefined,\n    ...query,\n  };\n\n  const url = jsonExportRes\n    .replace(':slug', agenda.slug)\n    .replace(':uid', agenda.uid);\n\n  const p = searchMethod === 'get'\n    ? fetch(\n      `${url}${getQuerySeparator(url)}${qs.stringify(params, {\n        skipNulls: true,\n      })}`,\n    )\n    : fetch(url, {\n      method: 'post',\n      body: JSON.stringify(params),\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    });\n\n  return p.then((r) => {\n    if (r.ok) return r.json();\n    throw new Error(\"Can't list events\");\n  });\n}\n","const shortKeys = [\n  {\n    short: 'm',\n    key: 'missing',\n  },\n  {\n    short: 's',\n    key: 'size',\n  },\n  {\n    short: 't',\n    key: 'type',\n  },\n  {\n    short: 'k',\n    key: 'key',\n  },\n  {\n    short: 'f',\n    key: 'field',\n  },\n];\n\nconst shortValues = [\n  {\n    key: 'type',\n    short: 'af',\n    value: 'additionalFields',\n  },\n];\n\nexport default function minimizeAggregation(aggregation) {\n  if (typeof aggregation === 'string') {\n    return aggregation;\n  }\n\n  return Object.keys(aggregation).reduce(\n    (carry, key) => ({\n      ...carry,\n      [shortKeys.find((shortKey) => shortKey.key === key)?.short ?? key]:\n        shortValues.find(\n          (shortValue) =>\n            shortValue.key === key && aggregation[key] === shortValue.value,\n        )?.short ?? aggregation[key],\n    }),\n    {},\n  );\n}\n","import minimizeAggregation from './minimizeAggregation.js';\n\nexport default function filtersToAggregations(filters, base = false) {\n  const usedFilters = base\n    ? filters.filter(\n      (filter) =>\n        filter.type === 'choice' && (!filter.options || filter.missingValue),\n    )\n    : filters;\n\n  const aggregations = usedFilters\n    .map((filter) => {\n      if (filter.aggregation === null) {\n        return false;\n      }\n\n      return {\n        key: filter.name,\n        type: filter.name,\n        missing: filter.missingValue,\n        ...filter.aggregation,\n      };\n    })\n    .filter((filter) => filter?.key);\n\n  const needViewport = usedFilters.some((filter) => filter.type === 'map');\n\n  if (needViewport) {\n    aggregations.unshift({\n      key: 'viewport',\n      type: 'viewport',\n    });\n  }\n\n  return aggregations.map(minimizeAggregation);\n}\n","export default function getQuerySeparator(url) {\n  try {\n    const urlObj = new URL(url, 'http://n');\n    return urlObj.search ? '&' : '?';\n  } catch (error) {\n    console.error('Invalid URL:', error);\n    return '?';\n  }\n}\n"],"mappings":"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","names":["qs"]}