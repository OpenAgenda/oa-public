{"version":3,"sources":["../src/render.js"],"sourcesContent":["import omit from 'lodash/omit.js';\nimport React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport qs from 'qs';\nimport * as dateFnsLocales from 'date-fns/locale/index.js';\nimport { prepareClientPortals } from '@openagenda/react-portal-ssr';\nimport Provider from './components/FiltersProvider.js';\nimport IntlProvider from './components/IntlProvider.js';\nimport FiltersManager from './components/FiltersManager.js';\nimport { extractFiltersFromDom, extractWidgetsFromDom } from './utils/index.js';\n\nfunction createContainer() {\n  const container = document.createElement('div');\n  container.setAttribute('data-oa-filters-root', '');\n  return container;\n}\n\nfunction defaultFilterChange(values, aggregations, ref, form) {\n  console.log('Filters changed, but there is no onFilterChange !');\n  console.log(values, aggregations, ref, form);\n}\n\nexport default function renderFiltersAndWidgets({\n  ref = React.createRef(),\n  res = '/events',\n  locale = 'en',\n  locales: userLocales,\n  aggregations,\n  total,\n  query,\n  defaultViewport,\n  onFilterChange = defaultFilterChange,\n  missingValue = 'null',\n  onLoad,\n  filtersBase,\n  apiClient,\n  manualSubmit,\n  ...rest\n} = {}) {\n  const container = createContainer();\n  document.body.appendChild(container);\n\n  const filters = extractFiltersFromDom();\n  const widgets = extractWidgetsFromDom();\n\n  // Empty divs when there is a server-side rendering\n  prepareClientPortals();\n\n  const initialValues = typeof query === 'string'\n    ? qs.parse(query, { ignoreQueryPrefix: true })\n    : query;\n\n  function bindRef() {\n    return Object.keys(ref.current).reduce(\n      (accu, key) => ({\n        ...accu,\n        [key]: (...args) => ref.current[key](...args),\n      }),\n      {},\n    );\n  }\n\n  function wrapCallback(fn) {\n    if (typeof fn !== 'function') {\n      return fn;\n    }\n\n    return (values, aggs, form) => fn(values, aggs, bindRef(), form);\n  }\n\n  const root = ReactDOM.createRoot(container);\n\n  root.render(\n    <IntlProvider locale={locale} userLocales={userLocales}>\n      <Provider\n        filters={filters}\n        widgets={widgets}\n        onSubmit={wrapCallback(onFilterChange)}\n        initialValues={omit(initialValues, 'sort')}\n        apiClient={apiClient}\n        res={res}\n        dateFnsLocale={dateFnsLocales[locale]}\n        missingValue={missingValue}\n        manualSubmit={manualSubmit}\n      >\n        <FiltersManager\n          ref={ref}\n          aggregations={aggregations}\n          total={total}\n          query={initialValues}\n          defaultViewport={defaultViewport}\n          filtersBase={filtersBase}\n          onLoad={wrapCallback(onLoad)}\n          {...rest}\n        />\n      </Provider>\n    </IntlProvider>,\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;AAAA,OAAO,UAAU;AACjB,OAAO,WAAW;AAClB,OAAO,cAAc;AACrB,OAAO,QAAQ;AACf,YAAY,oBAAoB;AAChC,SAAS,4BAA4B;AAgF7B;AA1ER,SAAS,kBAAkB;AACzB,QAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,YAAU,aAAa,wBAAwB,EAAE;AACjD,SAAO;AACT;AAEA,SAAS,oBAAoB,QAAQ,cAAc,KAAK,MAAM;AAC5D,UAAQ,IAAI,mDAAmD;AAC/D,UAAQ,IAAI,QAAQ,cAAc,KAAK,IAAI;AAC7C;AAEe,SAAR,wBAAyC;AAAA,EAC9C,MAAM,MAAM,UAAU;AAAA,EACtB,MAAM;AAAA,EACN,SAAS;AAAA,EACT,SAAS;AAAA,EACT;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,iBAAiB;AAAA,EACjB,eAAe;AAAA,EACf;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,GAAG;AACL,IAAI,CAAC,GAAG;AACN,QAAM,YAAY,gBAAgB;AAClC,WAAS,KAAK,YAAY,SAAS;AAEnC,QAAM,UAAU,sBAAsB;AACtC,QAAM,UAAU,sBAAsB;AAGtC,uBAAqB;AAErB,QAAM,gBAAgB,OAAO,UAAU,WACnC,GAAG,MAAM,OAAO,EAAE,mBAAmB,KAAK,CAAC,IAC3C;AAEJ,WAAS,UAAU;AACjB,WAAO,OAAO,KAAK,IAAI,OAAO,EAAE;AAAA,MAC9B,CAAC,MAAM,SAAS;AAAA,QACd,GAAG;AAAA,QACH,CAAC,GAAG,GAAG,IAAI,SAAS,IAAI,QAAQ,GAAG,EAAE,GAAG,IAAI;AAAA,MAC9C;AAAA,MACA,CAAC;AAAA,IACH;AAAA,EACF;AAEA,WAAS,aAAa,IAAI;AACxB,QAAI,OAAO,OAAO,YAAY;AAC5B,aAAO;AAAA,IACT;AAEA,WAAO,CAAC,QAAQ,MAAM,SAAS,GAAG,QAAQ,MAAM,QAAQ,GAAG,IAAI;AAAA,EACjE;AAEA,QAAM,OAAO,SAAS,WAAW,SAAS;AAE1C,OAAK;AAAA,IACH,oBAAC,gBAAa,QAAgB,aAC5B;AAAA,MAAC;AAAA;AAAA,QACC;AAAA,QACA;AAAA,QACA,UAAU,aAAa,cAAc;AAAA,QACrC,eAAe,KAAK,eAAe,MAAM;AAAA,QACzC;AAAA,QACA;AAAA,QACA,eAAe,eAAe,MAAM;AAAA,QACpC;AAAA,QACA;AAAA,QAEA;AAAA,UAAC;AAAA;AAAA,YACC;AAAA,YACA;AAAA,YACA;AAAA,YACA,OAAO;AAAA,YACP;AAAA,YACA;AAAA,YACA,QAAQ,aAAa,MAAM;AAAA,YAC1B,GAAG;AAAA;AAAA,QACN;AAAA;AAAA,IACF,GACF;AAAA,EACF;AACF;","names":[]}