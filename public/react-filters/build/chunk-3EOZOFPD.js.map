{"version":3,"sources":["../src/utils/withDefaultFilterConfig.js"],"sourcesContent":["import defaults from 'lodash/defaults.js';\nimport { getLocaleValue } from '@openagenda/intl';\nimport relativeOptions from '../messages/relative.js';\nimport attendanceModeOptions from '../messages/attendanceMode.js';\nimport provenanceMessages from '../messages/provenance.js';\nimport featuredMessages from '../messages/featured.js';\nimport stateMessages from '../messages/state.js';\nimport statusMessages from '../messages/status.js';\nimport booleanMessages from '../messages/boolean.js';\nimport accessibilitiesMessages from '../messages/accessibilities.js';\nimport dateRanges from './dateRanges.js';\n\nfunction assignDateRanges(filter, intl, dataFnsLocale) {\n  if (filter.type === 'definedRange') {\n    Object.assign(\n      filter,\n      dateRanges(intl, {\n        dataFnsLocale,\n        staticRanges: filter.staticRanges,\n        inputRanges: filter.inputRanges,\n      }),\n    );\n  }\n}\n\nexport default function withDefaultFilterConfig(filter, intl, opts = {}) {\n  const { missingValue, dataFnsLocale } = opts;\n\n  switch (filter.name) {\n    case 'viewport':\n      defaults(filter, {\n        type: 'none',\n      });\n      break;\n    case 'geo':\n      defaults(filter, {\n        type: 'map',\n        aggregation: null,\n        // props for MapFilter\n        tileAttribution:\n          '&copy; <a href=\"https://osm.org/copyright\">OpenStreetMap</a> contributors',\n        tileUrl:\n          opts.mapTiles ?? 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n      });\n      break;\n    case 'addMethod':\n      defaults(filter, {\n        type: 'choice',\n        options: [\n          {\n            label: intl.formatMessage(provenanceMessages.contribution),\n            value: 'contribution',\n          },\n          {\n            label: intl.formatMessage(provenanceMessages.aggregation),\n            value: 'aggregation',\n          },\n          {\n            label: intl.formatMessage(provenanceMessages.share),\n            value: 'share',\n          },\n        ],\n        aggregation: {\n          type: 'addMethods',\n        },\n      });\n      break;\n    case 'accessibility':\n      defaults(filter, {\n        type: 'choice',\n        options: [\n          {\n            label: intl.formatMessage(accessibilitiesMessages.hi),\n            value: 'hi',\n          },\n          {\n            label: intl.formatMessage(accessibilitiesMessages.vi),\n            value: 'vi',\n          },\n          {\n            label: intl.formatMessage(accessibilitiesMessages.pi),\n            value: 'pi',\n          },\n          {\n            label: intl.formatMessage(accessibilitiesMessages.mi),\n            value: 'mi',\n          },\n          {\n            label: intl.formatMessage(accessibilitiesMessages.ii),\n            value: 'ii',\n          },\n        ],\n        aggregation: {\n          type: 'accessibilities',\n        },\n      });\n      break;\n    case 'languages':\n      defaults(filter, {\n        type: 'choice',\n        options: null,\n      });\n      break;\n    case 'memberUid':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        labelKey: 'member.name',\n        aggregation: {\n          type: 'members',\n        },\n      });\n      break;\n    case 'timings':\n      defaults(filter, {\n        type: 'dateRange',\n        aggregation: null,\n      });\n      assignDateRanges(filter, intl, dataFnsLocale);\n      break;\n    case 'createdAt':\n      defaults(filter, {\n        type: 'dateRange',\n        aggregation: null,\n      });\n      assignDateRanges(filter, intl, dataFnsLocale);\n      break;\n    case 'updatedAt':\n      defaults(filter, {\n        type: 'dateRange',\n        aggregation: null,\n      });\n      assignDateRanges(filter, intl, dataFnsLocale);\n      break;\n    case 'state':\n      defaults(filter, {\n        type: 'choice',\n        options: [\n          {\n            label: intl.formatMessage(stateMessages.refused),\n            value: '-1',\n          },\n          {\n            label: intl.formatMessage(stateMessages.toModerate),\n            value: '0',\n          },\n          {\n            label: intl.formatMessage(stateMessages.controlled),\n            value: '1',\n          },\n          {\n            label: intl.formatMessage(stateMessages.published),\n            value: '2',\n          },\n        ],\n        aggregation: {\n          type: 'states',\n        },\n      });\n      break;\n    case 'search':\n      defaults(filter, {\n        type: 'search',\n        aggregation: null,\n      });\n      break;\n    case 'locationUid':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        labelKey: 'location.name',\n        aggregation: {\n          type: 'locations',\n        },\n      });\n      break;\n    case 'sourceAgendaUid':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        labelKey: 'agenda.title',\n        aggregation: {\n          type: 'sourceAgendas',\n        },\n      });\n      break;\n    case 'originAgendaUid':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        labelKey: 'agenda.title',\n        aggregation: {\n          type: 'originAgendas',\n        },\n      });\n      break;\n    case 'featured':\n      defaults(filter, {\n        type: 'choice',\n        options: [\n          {\n            label: intl.formatMessage(featuredMessages.featured),\n            value: 'true',\n          },\n        ],\n        aggregation: null,\n      });\n      break;\n    case 'relative':\n      defaults(filter, {\n        type: 'choice',\n        options: [\n          {\n            label: intl.formatMessage(relativeOptions.passed),\n            value: 'passed',\n          },\n          {\n            label: intl.formatMessage(relativeOptions.current),\n            value: 'current',\n          },\n          {\n            label: intl.formatMessage(relativeOptions.upcoming),\n            value: 'upcoming',\n          },\n        ],\n      });\n      break;\n    case 'attendanceMode':\n      defaults(filter, {\n        type: 'choice',\n        aggregation: {\n          type: 'attendanceModes',\n        },\n        options: [\n          {\n            label: intl.formatMessage(attendanceModeOptions.offline),\n            value: '1',\n          },\n          {\n            label: intl.formatMessage(attendanceModeOptions.online),\n            value: '2',\n          },\n          {\n            label: intl.formatMessage(attendanceModeOptions.mixed),\n            value: '3',\n          },\n        ],\n      });\n      break;\n    case 'region':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        missingValue,\n        aggregation: {\n          type: 'regions',\n        },\n      });\n      break;\n    case 'department':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        missingValue,\n        aggregation: {\n          type: 'departments',\n        },\n      });\n      break;\n    case 'city':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        missingValue,\n        aggregation: {\n          type: 'cities',\n        },\n      });\n      break;\n    case 'countryCode':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        missingValue,\n        aggregation: {\n          type: 'countryCodes',\n        },\n      });\n      break;\n    case 'adminLevel3':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        missingValue,\n        aggregation: {\n          type: 'adminLevels3',\n        },\n      });\n      break;\n    case 'district':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        missingValue,\n        aggregation: {\n          type: 'districts',\n        },\n      });\n      break;\n    case 'keyword':\n      defaults(filter, {\n        type: 'choice',\n        options: null, // from the aggregation\n        aggregation: {\n          type: 'keywords',\n        },\n      });\n      break;\n    case 'status':\n      defaults(filter, {\n        type: 'choice',\n        options: [\n          {\n            label: intl.formatMessage(statusMessages.programmed),\n            value: '1',\n          },\n          {\n            label: intl.formatMessage(statusMessages.rescheduled),\n            value: '2',\n          },\n          {\n            label: intl.formatMessage(statusMessages.movedOnline),\n            value: '3',\n          },\n          {\n            label: intl.formatMessage(statusMessages.postponed),\n            value: '4',\n          },\n          {\n            label: intl.formatMessage(statusMessages.full),\n            value: '5',\n          },\n          {\n            label: intl.formatMessage(statusMessages.cancelled),\n            value: '6',\n          },\n        ],\n        aggregation: {\n          type: 'status',\n        },\n      });\n      break;\n    case 'favorites':\n      defaults(filter, {\n        type: 'favorites',\n        aggregation: null,\n      });\n      break;\n    default:\n      break;\n  }\n\n  const { fieldSchema } = filter;\n\n  // additional boolean field\n  if (fieldSchema?.fieldType === 'boolean') {\n    defaults(filter, {\n      name: fieldSchema.field,\n      type: 'choice',\n      fieldSchema,\n      options: [\n        {\n          label: intl.formatMessage(booleanMessages.selected),\n          value: 'true',\n        },\n        {\n          label: intl.formatMessage(booleanMessages.notSelected),\n          value: 'false',\n        },\n      ],\n      missingValue,\n      aggregation: {\n        type: 'additionalFields',\n        field: fieldSchema.field,\n      },\n    });\n\n    // additional number field\n  } else if (['number', 'integer'].includes(fieldSchema?.fieldType)) {\n    defaults(filter, {\n      type: 'numberRange',\n      name: fieldSchema.field,\n      fieldSchema,\n      aggregation: null,\n    });\n\n    // additional optioned field\n  } else if (fieldSchema) {\n    defaults(filter, {\n      name: fieldSchema.field,\n      type: 'choice',\n      fieldSchema,\n      options: !filter.aggregationOnly\n        ? fieldSchema.options.map((option) => ({\n          ...option,\n          label: getLocaleValue(option.label, intl.locale),\n          value: String(option.id),\n        }))\n        : null,\n      missingValue,\n      aggregation: {\n        type: 'additionalFields',\n        field: fieldSchema.field,\n      },\n      labelKey: 'label',\n    });\n  }\n\n  return filter;\n}\n"],"mappings":"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","names":[]}